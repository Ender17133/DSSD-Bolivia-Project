(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8505],{54336:(e,t,r)=>{"use strict";r.d(t,{L:()=>u,P:()=>l});var o=r(98744),n=r(26056),i=r(19133),a=r(71267),s=r(65661),c=r(66753);const l="local-dockerfile",u=e=>{const{dispatch:t,getState:r}=e.store,u=r().user.is_anonymous,d=e.store.getState().config.enabledFeatures.includes(o.L.LOCAL_DOCKERFILE),p=!r().project.environment_id||r().project.environment_id===l||d,h={async fetchCustomEnvironments(){const e=r().project.id,o=await fetch(`/api/project/${e}/environments`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!o.ok)return c.Z.error({message:"Failed to fetch list of available environments for the project. Please try again later or contact our support."}),void(0,n.D)(new Error(`[/api/project/${e}]/environments] failed with ${o.statusText}`),"error");const i=[...(await o.json()).environments,...p?[{name:"Local ./Dockerfile",id:l,link:"./Dockerfile",is_public:!0}]:[]];t({type:"SET_ENVIRONMENTS",list:i})},async changeProjectEnvironment(o){if(u)return void e.modalApi.openModal({newModal:s.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});const d=r().project.id;t({type:"SET_ENV_LOADING",value:!0});const p=await fetch(`/api/project/${d}/environment`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({environment_id:o===l?null:o})});if(!p.ok)return c.Z.error({message:"Failed to change project's environment. Please try again later or contact our support."}),void(0,n.D)(new Error(`[/api/${d}]/environment/${o}] failed with ${p.statusText}`),"error");if(o===l){const t=r().filesystem.entities[i.oH];if(!(t&&(0,a.zE)(t)))try{await e.fileApi.generateDockerfile()}catch(e){c.Z.error({message:"Failed to generate Dockerfile. Please try again later or contact our support."}),(0,n.D)(e,"error")}e.projectFocusApi.focusDockerfile()}t({type:"SET_ENV_LOADING",value:!1}),o!==l&&t({type:"SET_IMAGE_IMPORTING",value:!0}),await e.projectApi.restartHardware(),await e.projectApi.refetchProject()},async deleteCustomEnvironment(e){const t=r().project.team_id,o=await fetch(`/api/environments/${e}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:t})});if(!o.ok){const e=(await o.json()).error;return c.Z.error({message:null!=e?e:"We failed to delete the custom environment. Please try again later or contact our support."}),void(0,n.D)(new Error(`[/api/environments] failed with ${o.statusText}`),"error")}await h.fetchCustomEnvironments()},async createCustomEnvironment({link:e,name:t}){const o=r().project.team_id,i=await fetch("/api/environments",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:o,name:t||void 0,link:e||void 0})});if(!i.ok)throw c.Z.error({message:"We failed to create a custom environment. Please try again later or contact our support."}),(0,n.D)(new Error(`[/api/environments] failed with ${i.statusText}`),"error"),new Error("Failed to create a custom environment");await h.fetchCustomEnvironments();return await i.json()},async updateCustomEnvironment({id:e,link:t,name:r}){const o=await fetch(`/api/environments/${e}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r||void 0,link:t||void 0})});if(!o.ok)return c.Z.error({message:"We failed to update a custom environment. Please try again later or contact our support."}),void(0,n.D)(new Error(`[/api/environments] failed with ${o.statusText}`),"error");await h.fetchCustomEnvironments()},setImageImporting(e){t({type:"SET_IMAGE_IMPORTING",value:e})}};return h}},23074:(e,t,r)=>{"use strict";r.d(t,{BO:()=>E,D:()=>I,KX:()=>S,Lu:()=>L,N4:()=>b,QK:()=>j,S6:()=>f,Vl:()=>g,Z2:()=>T,Z8:()=>v,d:()=>k,dG:()=>A,fA:()=>P,fT:()=>F,lH:()=>y,qC:()=>C,sb:()=>m,xR:()=>N});var o=r(3766),n=r(8550),i=r(26056),a=r(55236),s=r(9897),c=r(17555),l=r(85780),u=r(26076);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){var t,r,o;const n=null!==(t=e.existingCellCounts.sql)&&void 0!==t?t:0;return{cell_type:"sql",source:null!==(r=e.source)&&void 0!==r?r:`SELECT *\nFROM ${null!==(o=e.variableName)&&void 0!==o?o:"<dataframe variable name or path to a csv file>"}`,metadata:p(p({deepnote_variable_name:`df_${n+1}`},e.integrationId?{sql_integration_id:e.integrationId}:{}),{},{cell_id:e.id}),outputs:[],execution_count:null}}function g(e){return e&&(t=e)===(0,o.mk)(t)?e:null;var t}function m(e){return e[e.length-1]}function y(e,t){if("code"===t){return{id:e.id,type:"code",version:e.version,sorting_key:e.sorting_key,metadata:"code"===e.type?e.metadata:{cell_id:e.id},state:"code"===e.type?e.state:{execution_count:null},children:(0,s.J2)(e)?e.children:[{text:a.NB.string(e)}]}}if("markdown"===t){return{id:e.id,type:"markdown",version:e.version,sorting_key:e.sorting_key,metadata:"markdown"===e.type?e.metadata:{cell_id:e.id},children:(0,s.J2)(e)?e.children:[{text:a.NB.string(e)}]}}if((0,n.UX)(t)){return{id:e.id,type:t,version:e.version,sorting_key:e.sorting_key,metadata:e.type===t?e.metadata:{cell_id:e.id,is_collapsed:!1},children:e.children}}throw(0,o.UT)(t),new Error(`Invalid argument newType: ${t}`)}function v(e,t){var r;const o=null!==(r=null==t?void 0:t.getBoundingClientRect().height)&&void 0!==r?r:120,n=Math.max(0,Math.ceil(o/l.RA));switch(e){case"input-text":case"input-select":case"input-slider":case"input-date":return{x:0,y:0,w:8,h:4};case"text-cell-p":case"text-cell-bullet":case"text-cell-number":case"text-cell-todo":case"text-cell-callout":return{x:0,y:0,w:8,h:2};case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"markdown":case"code":case"visualization":case"sql":return{x:0,y:0,w:12,h:n};default:return{x:0,y:0,w:12,h:4}}}function b(e,t){if(!t)return c.F;const r=e[t];return 0===(null==r?void 0:r.length)?c.F:r}function E(e){return!e||0===e.length}const S=(e,t)=>"leading"===t?e.replace(/^(\r\n|\n|\r)/,""):"trailing"===t?e.replace(/(\r\n|\n|\r)$/,""):(0,o.UT)(t);function C(e,t){return e.concat().sort(((e,r)=>t.indexOf(e)-t.indexOf(r)))}const w=e=>"notebook-focused-cell-"+e,T=(e,t)=>{const r=w(e);t?(0,u.p)(r,t):(0,u.u)(r)},I=e=>{const t=w(e);try{return localStorage.getItem(t)}catch(e){return(0,i.D)(e),null}},_=e=>"project-focus-"+e,A=(e,t)=>{const r=_(e);(0,u.p)(r,t)},k=e=>{const t=_(e);try{return localStorage.getItem(t)}catch(e){return(0,i.D)(e),null}},O=e=>`scroll-${e}`,D=e=>`scroll-target-${e}`,P=(e,t)=>{const r=O(e);try{var o;const e=Math.max(t,0);null===(o=sessionStorage)||void 0===o||o.setItem(r,e.toString())}catch(e){(0,i.D)(e)}},j=(e,t,r)=>{const o=D(e);try{if(t){var n;const e=[t.type,t.id,r].join(",");null===(n=sessionStorage)||void 0===n||n.setItem(o,e)}else{var a;null===(a=sessionStorage)||void 0===a||a.removeItem(o)}}catch(e){(0,i.D)(e)}},N=e=>{const t=O(e);try{var r,o;const e=parseInt(null!==(r=null===(o=sessionStorage)||void 0===o?void 0:o.getItem(t))&&void 0!==r?r:"",10),n=Math.max(e,0);return Number.isNaN(e)?null:n}catch(e){return(0,i.D)(e),null}},L=e=>{const t=D(e);try{var r,o;const e=null!==(r=null===(o=sessionStorage)||void 0===o?void 0:o.getItem(t))&&void 0!==r?r:null;if(!e)return null;const[n,i,a]=e.split(",");return{target:{type:n,id:i},offset:parseInt(a,10)||0}}catch(e){return(0,i.D)(e),null}},F=e=>!((0,s.EA)(e)||(0,s.xV)(e)||(0,s.FZ)(e))&&(!(!(0,s.eb)(e)&&!(0,s.Q2)(e))||void(0,o.vE)(e))},39297:(e,t,r)=>{"use strict";r.d(t,{h:()=>l});var o=r(3474),n=r(78563),i=r(39981);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const l=({trigger:e,isLazy:t,searchBar:r,placement:a,menuProps:c,menuWrapper:l,children:u})=>{const d=null!=l?l:e=>(0,i.tZ)(i.HY,{children:e});return(0,i.tZ)(o.v2,{placement:a,isLazy:t,lazyBehavior:"keepMounted",children:({onClose:t})=>(0,i.BX)(i.HY,{children:[e,d((0,i.BX)(o.qy,s(s({px:2},c),{},{children:[r,(0,i.tZ)(n.xu,{onClick:()=>t(),children:u})]})))]})})}},85780:(e,t,r)=>{"use strict";r.d(t,{RA:()=>a,h7:()=>o,mX:()=>n,xl:()=>i});const o=1240,n=24,i=o/n,a=o/n/2},95592:(e,t,r)=>{"use strict";r.d(t,{TJ:()=>h,Xp:()=>C,Xw:()=>E,gD:()=>b,im:()=>p,ug:()=>v});var o=r(3766),n=r(76674),i=r(79675),a=r.n(i),s=r(9897),c=r(65282);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){var r,o;const{block:n}=null!==(r=(0,s.cP)(e,t))&&void 0!==r?r:{};return n&&(0,s.xV)(n)&&null!==(o=n.metadata.deepnote_chart_filter)&&void 0!==o?o:null}const h=e=>`${e}_filtered`,f=({values:e})=>`.isin([${e.map((e=>"string"==typeof e?'"'+e.replaceAll('"','\\"')+'"':e)).join(",")}])`,g=e=>"string"==typeof e?`pd.to_datetime(${(0,c._J)(e)}, unit='ms')`:e,m=(e,t)=>{const r=("values"===t.selectionType?[t]:t.axes).map((e=>{if("values"===e.selectionType)return{column:e.field,selectionFunction:f(e)};if("range"===e.selectionType){const r=y(e),o=`.between(${g((t=e).start)}, ${g(t.end)})`;return{column:e.field,selectionFunction:r?`.dt.tz_localize(None)${o}`:o}}return(0,o.vE)(e);var t})).map((t=>`${e}["${t.column}"]${t.selectionFunction}`));return"exclude"===t.filterType?((e,t)=>t?`~(${e})`:`~${e}`)(r.join(" & "),r.length>1):r.join(" & ")},y=e=>"range"===e.selectionType&&("string"==typeof e.start||"string"==typeof e.start),v=(e,t,{filter:r})=>{if(0===r.length)return`${t}=${e}\n${t}`;const o=r.map(((r,o)=>{const n=0===o?e:t;return`${t} = ${n}[${m(n,r)}]`})).join("\n");return`${r.some((e=>"data"===e.selectionType&&e.axes.some(y)))?"import pandas as pd\n\n":""}${o}\n${t}`};function b(e,t,r){var o;const{block:n}=null!==(o=(0,s.cP)(e,t))&&void 0!==o?o:{};n&&(0,s.xV)(n)&&(0,s.HT)(e,t,{deepnote_chart_filter:null!=r?r:void 0})}function E(e,t){return(0,n.ZP)(t,(t=>{t.filter.filter((t=>{var r,o;return!("field"in t&&((null==e||null===(r=e.encoding.color)||void 0===r?void 0:r.field)===t.field||(null==e||null===(o=e.encoding.size)||void 0===o?void 0:o.field)===t.field))}))}))}const S=(e,t)=>u(u({},e),{},{source:t}),C=(e,t,r,o)=>{const n=[e?S(e,"color_legend"):null,t?S(t,"size_legend"):null,r?S(r,"data"):null];return a()(n).map((e=>u(u({},e),{},{filterType:o})))}},65282:(e,t,r)=>{"use strict";r.d(t,{GO:()=>b,Yy:()=>v,_J:()=>g,rl:()=>d,sQ:()=>p});var o=r(3766),n=r(76674),i=r(79675),a=r.n(i),s=r(18166),c=r.n(s),l=r(60775);const u={E:"values",R:"range"},d=e=>(t,r)=>{if(!r||"object"!=typeof r)return;if(!("fields"in r)||!("values"in r))return;if(!Array.isArray(r.fields)||!Array.isArray(r.values))return;if(0===r.fields.length)return void(null==e||e("data",null));const{fields:n,values:i}=r,s=n.map(((e,t)=>{if(!e||"object"!=typeof e||!("field"in e)||"string"!=typeof e.field)return null;const r=e.field,n=u[e.type];if("values"===n)return{selectionType:"values",field:r,values:i[t]};if("range"===n){const e=i[t].sort(((e,t)=>((0,l.isDate)(e)?e.getTime():e)-((0,l.isDate)(t)?t.getTime():t))).map((e=>(0,l.isDate)(e)?f(e):e));return{selectionType:"range",field:r,start:e[0],end:e[1]}}return(0,o.vE)(n)}));e("data",{selectionType:"data",axes:a()(s)})},p=(e,t)=>(r,o)=>{if(!o||"object"!=typeof o)return;const n="vlPoint"in o?c()(o,"vlPoint"):o;if(0===Object.keys(n).length)return void t(e,null);const[i,a]=Object.entries(n)[0];i&&a&&t(e,{selectionType:"values",field:i,values:a})},h=(e,t)=>({field:e,oneOf:t}),f=e=>new Date(e).toISOString(),g=e=>new Date(e).getTime(),m=(e,t,r)=>({field:e,range:[t,r].map((e=>"string"==typeof e?(e=>{const t=new Date(e);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,date:t.getUTCDate(),hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds(),milliseconds:t.getUTCMilliseconds()}})(e):e))}),y=e=>{var t;return"values"===e.selectionType?h(e.field,null!==(t=e.values)&&void 0!==t?t:[]):m(e.field,e.start,e.end)};function v(e){return{and:e.filter.map((e=>{var t;const r="values"===e.selectionType?h(e.field,null!==(t=e.values)&&void 0!==t?t:[]):{and:(Array.isArray(e.axes)?e.axes:[]).map(y)};return"exclude"===e.filterType?{not:r}:r}))}}function b(e,t){return(0,n.ZP)(e,(e=>{Object.keys(t).length>0&&(e.transform=[{filter:t}])}))}},95559:(e,t,r)=>{"use strict";r.d(t,{AI:()=>v,B2:()=>b,B6:()=>P,Ji:()=>F,K0:()=>B,KJ:()=>S,LK:()=>M,Rk:()=>C,VA:()=>_,dk:()=>j,dt:()=>E,kp:()=>H,p_:()=>O,qd:()=>D,wp:()=>y,y_:()=>N,z6:()=>A});var o=r(72790),n=r(8550),i=r(67665),a=r(76674),s=r(93834),c=r.n(s),l=r(72008),u=r.n(l),d=r(79675),p=r.n(d),h=r(95592),f=r(65282);const g=[],m=["x","y","color"];class y extends o.GU{}function v(){return{$schema:"https://vega.github.io/schema/vega-lite/v5.json",mark:{type:"bar",tooltip:!0},encoding:Object.fromEntries(m.map((e=>[e,{field:"",type:"nominal",sort:null,scale:{type:"linear"},format:{type:"default",decimals:null}}]))),width:"container",height:"container",config:{customFormatTypes:!0}}}function b(e,t){var r,o,n,i;const a=t[e];if("DataFrame"!==(null==a?void 0:a.varType))return g;const s=null!==(r=null===(o=t[e])||void 0===o?void 0:o.varColumns)&&void 0!==r?r:g,c=null!==(n=null===(i=t[e])||void 0===i?void 0:i.varColumnTypes)&&void 0!==n?n:g;return s.map(((e,t)=>({name:e,type:c[t]})))}function E(e){return Object.entries(e).filter((([,e])=>"DataFrame"===e.varType)).map((([e])=>e))}function S(e,t,r){const o=v();t.editCellVariableName(r,e),t.editVisualizationCellSpec(r,o),t.clearCellOutputsById([r])}function C(e,t){return`legend_${e}_${t}`}const w=(e,t)=>{var r,o,n;return null!==(r=null===(o=e.encoding)||void 0===o||null===(n=o[t])||void 0===n?void 0:n.timeUnit)&&void 0!==r?r:null};function T(e,t){const r=[{name:C("size",e),select:{type:"point",encodings:["size"],toggle:"true"},bind:"legend"},{name:C("color",e),select:{type:"point",encodings:["color"],toggle:"true"},bind:"legend"}],o="0"===e||"0_0"===e,n=p()(["x","y"].filter((e=>t&&O(t)&&!w(t,e))));return[...r,...o&&n.length>0?[{name:"interval_selection",select:{type:"interval",encodings:n}}]:[]]}function I(e,t){const r="point"===t||"circle"===t||"bar"===t;return{condition:{test:{and:[{param:C("size",e)},{param:C("color",e)},...r?[{param:"interval_selection"}]:[]]},value:1},value:.2}}function _(e){var t,r;return null!==(t=null===(r=e.layer)||void 0===r?void 0:r.map((e=>A(e))))&&void 0!==t?t:[]}function A(e){if(O(e))return e;if(P(e))return e.layer[0];throw new y(`Unexpected layer spec: ${JSON.stringify(e)}`)}function k(e){const{mark:t}="mark"in e?e:e.layer[0];return"string"==typeof t?t:t.type}function O(e){return!("layer"in e)&&(("string"!=typeof e.mark||"text"!==e.mark)&&("string"==typeof e.mark||"text"!==e.mark.type))}function D(e){const t="string"==typeof e.mark&&"text"===e.mark,r="string"!=typeof e.mark&&"text"===e.mark.type;return t||r}function P(e){if(!("layer"in e&&e.layer.length>0))return!1;const t=e.layer[0].mark;return"string"!=typeof t&&"text"!==t.type}function j(e){return(0,a.ZP)(e,(t=>{var r;if(t.layer)t.layer.forEach(((e,t)=>{(function(e){if(O(e))return[e];if(P(e))return e.layer;throw new y(`Invalid layer: ${JSON.stringify(e)}`)})(e).forEach(((e,r)=>{e.params=T(`${t}_${r}`,null)}));const r=A(e),o=`${t}`;r.params=T(o,r);const n=k(r);r.encoding.opacity=I(o,n)}));else if(t.encoding){t.params=T("0",t);const e=k(t);t.encoding.opacity=I("0",e)}t.height="container",t.width="container",t.padding=null!==(r=e.padding)&&void 0!==r?r:32,t.autosize={type:"fit"},t.config||(t.config={}),t.config.legend||(t.config.legend={}),t.config.legend.labelFont="Inter, sans-serif",t.config.legend.labelFontSize=12,t.config.legend.titleFont="Inter, sans-serif",t.config.legend.titleFontSize=12,t.config.legend.titleFontWeight="bold",t.config.title={anchor:"start",color:"#40566C",font:"Inter, sans-serif",fontSize:16,fontWeight:"normal",dy:-16},t.config.axis={labelFont:"Inter, sans-serif",labelFontSize:12,labelFontWeight:"normal",titleFont:"Inter, sans-serif",titleFontSize:12,titleFontWeight:"bold",labelOverlap:"parity"},t.config.customFormatTypes=!0}))}function N(e){return void 0!==e.metadata.deepnote_visualization_spec&&void 0!==e.metadata.deepnote_variable_name}const L=e=>{var t,r,o;const n=null!==(t=e.metadata.deepnote_visualization_spec)&&void 0!==t?t:v(),i=null!==(r=e.metadata.deepnote_chart_height)&&void 0!==r?r:null,a=null!==(o=e.metadata.deepnote_chart_filter)&&void 0!==o?o:null,s=a&&(0,h.Xw)(n,a),c=s&&(0,f.Yy)(s),l=j(c?(0,f.GO)(n,c):n),d=u()(l);return d.height=M(i),d};function F(e){var t;const r=null!==(t=e.metadata.deepnote_variable_name)&&void 0!==t?t:"df",o=function(e){const t=e=>`%%%${e}%%%`,r=JSON.stringify(e,((e,r)=>"boolean"==typeof r?t(r?"True":"False"):null===r?t("None"):r),2);return r.replaceAll(/"%%%(.+?)%%%"/g,"$1")}(L(e));return n.G5.executeVisualizationWithSpecDict(r,o)}const R=440,U=280,x=1e3,M=e=>e?c()(e,U,x):R,B=e=>{var t;const r=(0,i.Pd)(e)?e.data:null;return r&&(null!==(t=r["application/vnd.vegalite.v4+json"])&&void 0!==t?t:r["application/vnd.vegalite.v5+json"])};function H(e){return(0,a.ZP)(e,(e=>{e.layer&&(e.layer=e.layer.filter((e=>{var t,r;const o=A(e);return(null===(t=o.encoding.x)||void 0===t?void 0:t.field)||(null===(r=o.encoding.y)||void 0===r?void 0:r.field)})))}))}},67014:(e,t,r)=>{"use strict";r.d(t,{Uh:()=>a,c_:()=>s,k0:()=>n,nn:()=>i,pv:()=>o});const o=e=>"object"==typeof e&&"new-output"===e.type&&"data"in e&&"metadata"in e&&"cellId"in e&&"outputIndex"in e,n=e=>"object"==typeof e&&"output-dimension"===e.type&&"outputIndex"in e&&"cellId"in e&&"offsetY"in e,i=e=>"object"==typeof e&&"output-initialized"===e.type&&e.payload&&["one-iframe-canvas","fill-iframe"].includes(e.payload.type),a=e=>"object"==typeof e&&"layout-updated"===e.type&&"height"in e&&"cellId"in e&&"outputIndex"in e,s=e=>o(e)||i(e)||(e=>"object"==typeof e&&"init-output"===e.type&&"cellId"in e&&"outputIndex"in e)(e)||a(e)||n(e)},11098:(e,t,r)=>{"use strict";r.d(t,{DI:()=>c,Aq:()=>l});const o=e=>"application/zip"===e||"application/x-zip-compressed"===e,n=e=>!!e&&["application/gzip","application/x-gzip","application/tar","application/tar+gzip","application/x-gtar","application/x-tgz"].includes(e);var i=r(24822),a=r(48271);const s=[".txt",".gitignore",".json",".bowerrc",".jshintrc",".jscsrc",".eslintrc",".babelrc",".har",".abap",".cls",".azcli",".bat",".cmd",".mligo",".clj",".cljs",".cljc",".edn",".coffee",".c",".h",".cpp",".cc",".cxx",".hpp",".hh",".hxx",".cs",".csx",".cake",".css",".dockerfile",".fs",".fsi",".ml",".mli",".fsx",".fsscript",".go",".graphql",".gql",".handlebars",".hbs",".html",".htm",".shtml",".xhtml",".mdoc",".jsp",".asp",".aspx",".jshtm",".ini",".properties",".gitconfig",".java",".jav",".js",".es6",".jsx",".kt",".less",".lua",".md",".markdown",".mdown",".mkdn",".mkd",".mdwn",".mdtxt",".mdtext",".s",".dax",".msdax",".m",".pas",".p",".pp",".ligo",".pl",".php",".php4",".php5",".phtml",".ctp",".dats",".sats",".hats",".pq",".pqm",".ps1",".psm1",".psd1",".jade",".pug",".py",".rpy",".pyw",".cpy",".gyp",".gypi",".r",".rhistory",".rprofile",".rt",".cshtml",".redis",".rst",".rb",".rbx",".rjs",".gemspec",".pp",".rs",".rlib",".sb",".scm",".ss",".sch",".rkt",".scss",".sh",".bash",".sol",".aes",".sql",".st",".iecst",".iecplc",".lc3lib",".swift",".tcl",".twig",".ts",".tsx",".vb",".xml",".dtd",".ascx",".csproj",".config",".wxi",".wxl",".wxs",".xaml",".svg",".svgz",".opf",".xsl",".yaml",".yml",".scala",".sbt"];i.define({"notebook/ipynb":["ipynb"]},!0),i.define({"text/python":["py"]},!0);let c=function(e){return e[e.IMG=0]="IMG",e[e.EDITOR=1]="EDITOR",e[e.UNSUPPORTED=2]="UNSUPPORTED",e[e.PDF=3]="PDF",e[e.ARCHIVE=4]="ARCHIVE",e[e.CSV=5]="CSV",e}({});function l(e){const t=(0,a.UO)(e),r=function(e){const t=i.getType(e);return null==t?{type:"unknown",subtype:"unknown"}:{type:t.split("/")[0],subtype:t.split("/")[1]}}(t);return function(e){if(!e)return!1;if(e.startsWith(".")&&e.length>1)return!0;const t="."+(0,a.mD)(e);return s.some((e=>e===t))}(t)||"text"===r.type||"Dockerfile"===t?c.EDITOR:"image"===r.type?c.IMG:"notebook"===r.type?c.EDITOR:"application"===r.type&&"pdf"===r.subtype?c.PDF:"application"===r.type&&n("application/"+r.subtype)||"application"===r.type&&o("application/"+r.subtype)?c.ARCHIVE:c.UNSUPPORTED}},27809:(e,t,r)=>{"use strict";async function o(e){return new Promise(((t,r)=>{e(((e,o)=>{if(e)return r(e);t(o)}))}))}function n(e,t){return(r,o)=>{let n=!1;for(const t of r)if(e.every(((e,r)=>t.p[r]===e))){n=!0;break}n&&t(r,o)}}function i(e){return!!e&&"string"==typeof e.data}r.d(t,{EM:()=>o,Hz:()=>i,z3:()=>n})},33419:(e,t,r)=>{"use strict";r.d(t,{k:()=>i,q:()=>n});var o=r(64119);const n=o.Ps`
  fragment FullBlockFragment on Block {
    id
    version
    sorting_key
    type
    content
    metadata
    state {
      output_cleared
      execution_start
      execution_millis
      source_hash
      deepnote_to_be_reexecuted
      execution_count
      deepnote_table_state {
        pageSize
        pageIndex
        filters {
          ... on TableOutputColumnContainsFilter {
            id
            value
          }
        }
        sortBy {
          id
          type
        }
      }
      deepnote_table_loading
      deepnote_table_invalid
    }
  }
`,i=o.Ps`
  fragment BlockAmendFragment on Block {
    id
    version
    sorting_key
    state {
      output_cleared
      execution_start
      execution_millis
      source_hash
      deepnote_to_be_reexecuted
      execution_count
      deepnote_table_state {
        pageSize
        pageIndex
        filters {
          ... on TableOutputColumnContainsFilter {
            id
            value
          }
        }
        sortBy {
          id
          type
        }
      }
      deepnote_table_loading
      deepnote_table_invalid
    }
  }
`},96106:(e,t,r)=>{"use strict";r.d(t,{ex:()=>w,TK:()=>T,lM:()=>C,DK:()=>S});var o=r(8550),n=r(26056),i=r(18237),a=r(86649);new i.n2({name:"Date",description:"Date custom scalar type",serialize(e){if(e instanceof Date)return e.getTime();throw Error("GraphQL Date Scalar serializer expected a `Date` object")},parseValue:e=>"number"==typeof e?new Date(e):((0,n.D)(new Error("GraphQL Date Scalar parser expected a `number`"),"error"),new Date(0)),parseLiteral:e=>e.kind===a.h.INT?new Date(parseInt(e.value,10)):null});const s=new i.n2({name:"Double",description:"Large integer (over 32 bits)",serialize(e){if("number"==typeof e)return[e%2**32,Math.floor(e/2**32)];throw Error("GraphQL Date Scalar serializer expected a `Date` object")},parseValue:e=>Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]?e[0]+e[1]*2**32:((0,n.D)(new Error("GraphQL Date Scalar parser expected a `[number, number]` tuple"),"error"),0),parseLiteral:e=>e.kind===a.h.INT&&"string"==typeof e.value?parseInt(e.value,10):0});var c=r(3766),l=r(10356),u=r(40207),d=r(9897),p=r(83964);const h=["formattedRanges"],f=["state"],g=["__typename","deepnote_table_state","execution_millis","execution_count"],m=["__typename"];function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function S(e,t){return{type:"notebook",notebookId:e,children:t.map((e=>C(e)))}}function C(e){const t=(0,l.Tu)(e.type)?e.type:null;if(!t)throw new Error(`Unknown block type: ${e.type}`);if((0,o.UX)(e.type)){const t=e.metadata,{formattedRanges:r}=t,o=E(t,h),n=(0,u.D0)(e.content,null!=r?r:[]);return{id:e.id,version:e.version,type:e.type,sorting_key:e.sorting_key,metadata:v(v({},o),{},{cell_id:e.id}),children:n}}if((0,d.US)(t)){e.state||(0,n.D)(new Error("Missing state in executable block from the Block API"),"error",{blockId:e.id,blockType:t});const r=I(e.state);return{id:e.id,version:e.version,type:t,sorting_key:e.sorting_key,metadata:v(v({},e.metadata),{},{cell_id:e.id}),state:r,children:[{text:e.content}]}}return{id:e.id,version:e.version,type:t,sorting_key:e.sorting_key,metadata:v(v({},e.metadata),{},{cell_id:e.id}),children:[{text:e.content}]}}function w(e,t){if((0,d.Uo)(e)){t.state||(0,n.D)(new Error("Missing state in executable block from the Block API"),"error",{blockId:e.id,blockType:e.type});const r=I(t.state);return v(v(v({},e),t),{},{state:r})}{const{state:r}=t,o=E(t,f);return r&&(0,n.D)(new Error("Unexpected state in non-executable block from the Block API"),"error",{blockId:e.id,blockType:e.type,state:r}),v(v({},e),o)}}function T(e){if((0,d.EA)(e)){const{source:t,formattedRanges:r}=(0,u.oP)(e.children);return{type:e.type,content:t,metadata:v(v({},e.metadata),{},{cell_id:e.id,formattedRanges:r})}}return{type:e.type,content:(0,p.y)(e),metadata:v(v({},e.metadata),{},{cell_id:e.id})}}function I(e){const t=null!=e?e:{},{__typename:r,deepnote_table_state:o,execution_millis:n,execution_count:i}=t,a=E(t,g),l=o?function(e){var t,r;return(0,c.Q9)({pageSize:e.pageSize,pageIndex:e.pageIndex,sortBy:e.sortBy,filters:null!==(t=null===(r=e.filters)||void 0===r?void 0:r.map((e=>function(e){switch(e.__typename){case"TableOutputColumnContainsFilter":{const{__typename:t}=e;return v({type:"contains"},E(e,m))}case void 0:throw new Error("Missing __typename in table filter");default:(0,c.vE)(e.__typename)}}(e))))&&void 0!==t?t:null})}(o):null,u=n?s.parseValue(n):null;return v(v({},(0,c.Q9)(v(v({},a),{},{deepnote_table_state:l,execution_millis:u}))),{},{execution_count:null!=i?i:null})}},10356:(e,t,r)=>{"use strict";r.d(t,{$W:()=>m,CU:()=>f,Tu:()=>y,Wj:()=>i,gn:()=>h,hI:()=>a,lO:()=>p,wv:()=>u,yf:()=>d,zR:()=>l,zS:()=>g});var o=r(32902),n=r.n(o);const i=["text-cell-h1","text-cell-h2","text-cell-h3"],a=["code","sql"],s=[...a,"markdown"],c=["text-cell-bullet","text-cell-number","text-cell-todo"],l=[...c,"text-cell-callout"],u=["text-cell-p","text-cell-callout",...i,...c],d=["input-text","input-select","input-slider","input-date"],p=["visualization",...s,...d],h=["sql",...d],f=["visualization",...a,...d],g=["visualization","code","sql"],m=n()([...f,...s,...u]);function y(e){return m.includes(e)}},40207:(e,t,r)=>{"use strict";r.d(t,{D0:()=>p,oP:()=>d});var o=r(79675),n=r.n(o),i=r(62840);const a=["text"];function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function d(e){return e.reduce(((e,t)=>(0,i.L_)(t)?function(e,t){const r=d(t.children),o={type:"link",url:t.url,fromCodePoint:e.codePointLength,toCodePoint:e.codePointLength+r.codePointLength,ranges:r.formattedRanges};return{codePointLength:e.codePointLength+r.codePointLength,source:e.source+r.source,formattedRanges:[...e.formattedRanges,o]}}(e,t):function(e,t){const r=t,{text:o}=r,n=u(r,a),i=function(e){return[...e].length}(o),s=Object.keys(n).length>0;return{codePointLength:e.codePointLength+i,source:`${e.source}${o}`,formattedRanges:s?e.formattedRanges.concat({type:"marks",fromCodePoint:e.codePointLength,toCodePoint:e.codePointLength+i,marks:n}):e.formattedRanges}}(e,t)),{codePointLength:0,source:"",formattedRanges:[]})}function p(e,t){const r=[...e],o=function(e,t){return t.every((t=>function(e,t){return e.fromCodePoint>=0&&e.fromCodePoint<t.length&&e.toCodePoint>=0&&e.toCodePoint<=t.length&&e.fromCodePoint<=e.toCodePoint}(t,e)))}(r,t),n={type:"marks",fromCodePoint:0,toCodePoint:r.length,marks:{}},i=o?function(e,t){return t.reduce(((e,t)=>{const r=e.at(-1);return r?[...e.slice(0,-1),...h(r,t)]:e}),[e])}(n,t):[n];return i.flatMap(((e,t)=>{if("link"===e.type){const a=i[t-1],s=a&&"link"===a.type&&a.toCodePoint===e.fromCodePoint;return[...0===e.fromCodePoint||s?[{text:""}]:[],(o=r,n=e,{type:"inline-link",url:n.url,children:p(f(o,n),n.ranges)}),...e.toCodePoint===r.length?[{text:""}]:[]]}return function(e,t){return c({text:f(e,t)},t.marks)}(r,e);var o,n}))}function h(e,t){const r=e.fromCodePoint<t.fromCodePoint?c(c({},e),{},{toCodePoint:t.fromCodePoint}):null,o=e.toCodePoint>t.toCodePoint?c(c({},e),{},{fromCodePoint:t.toCodePoint}):null;return n()([r,t,o])}function f(e,t){return e.slice(t.fromCodePoint,t.toCodePoint).join("")}},34:(e,t,r)=>{"use strict";r.d(t,{MO:()=>i});new WeakMap;const o=new WeakMap,n=new WeakMap,i={isMerging:e=>n.get(e),isSaving:e=>o.get(e),redo(e){e.redoEdit()},undo(e){e.undoEdit()},withoutMerging(e,t){const r=i.isMerging(e);n.set(e,!1),t(),n.set(e,r)},withoutSaving(e,t){const r=i.isSaving(e);o.set(e,!1),t(),o.set(e,r)}}},62840:(e,t,r)=>{"use strict";r.d(t,{Ij:()=>c,L_:()=>a,Pz:()=>d,V7:()=>u,tr:()=>l,yI:()=>s});var o=r(11564),n=r(6307),i=r(55236);function a(e){return i.W_.isElement(e)&&"inline-link"===e.type}function s(e,t){if(!t)return!1;const r=[...i.ML.nodes(e,{at:t,match:a})];if(1!==r.length)return!1;const[,o]=r[0];return i.y$.isAncestor(o,t.anchor.path)&&i.y$.isAncestor(o,t.focus.path)}function c(e,t){if(!t)return!1;const[r]=i.ML.nodes(e,{at:t,match:a});return!!r}function l(e="",t){return{type:"inline-link",url:e,children:null!=t?[{text:t}]:[]}}function u(e){e.selection&&(c(e,e.selection)?i.YR.unwrapNodes(e,{match:a}):i.YR.wrapNodes(e,l(),{split:!0}))}function d(e,t,r){(0,n.ZP)("mod+shift+u",t)&&(u(e),(0,o.W)("Text formatting applied",{type:"hyperlink",origin:"shortcut",workspaceId:r}))}},17961:(e,t,r)=>{"use strict";r.d(t,{HD:()=>S,Jt:()=>E,SS:()=>b});var o=r(46419),n=r(3766),i=r(40207),a=r(83964);const s=["formattedRanges"],c=["execution_count"],l=["execution_count"],u=["execution_count"],d=["execution_count"],p=["execution_count"],h=["execution_count"],f=["execution_count"];function g(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t,r){const o=r.map(((r,o)=>{const n=t[r];if(!n)throw new Error(`The notebook data has been corrupted (missing cell data). [notebookId=${e}; cellId=${r}]`);return E(r,n,{sortingKey:""})}));return{type:"notebook",notebookId:e,children:o}}function E(e,t,r){switch(t.cell_type){case"code":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"code",id:e,version:0,sorting_key:r.sortingKey,children:[{text:t.source}],metadata:i,state:n}}case"sql":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"sql",id:e,version:0,sorting_key:r.sortingKey,children:[{text:t.source}],metadata:i,state:n}}case"markdown":return{children:[{text:t.source}],type:"markdown",id:e,version:0,sorting_key:r.sortingKey,metadata:y(y({},t.metadata),{},{cell_id:e})};case"visualization":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"visualization",id:e,version:0,sorting_key:r.sortingKey,children:[{text:t.source}],metadata:i,state:n}}case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"text-cell-p":case"text-cell-bullet":case"text-cell-number":case"text-cell-todo":case"text-cell-callout":{const o=t.metadata,{formattedRanges:n}=o,a=g(o,s);return{children:(0,i.D0)(t.source,null!=n?n:[]),type:t.cell_type,id:e,version:0,sorting_key:r.sortingKey,metadata:y(y({},a),{},{cell_id:e})}}case"input-text":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"input-text",children:[{text:t.source}],id:e,version:0,sorting_key:r.sortingKey,metadata:i,state:n}}case"input-select":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"input-select",children:[{text:t.source}],id:e,version:0,sorting_key:r.sortingKey,metadata:i,state:n}}case"input-slider":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"input-slider",children:[{text:t.source}],id:e,version:0,sorting_key:r.sortingKey,metadata:i,state:n}}case"input-date":{const{state:n,metadata:i}=(0,o.Q)({id:e,metadata:t.metadata,execution_count:t.execution_count});return{type:"input-date",children:[{text:t.source}],id:e,version:0,sorting_key:r.sortingKey,metadata:i,state:n}}default:return(0,n.vE)(t)}}function S(e){switch(e.type){case"code":{const t=e.state,{execution_count:r}=t,o=g(t,c);return{cell_type:"code",source:(0,a.y)(e),metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),outputs:[],execution_count:r}}case"sql":{const t=e.state,{execution_count:r}=t,o=g(t,l);return{cell_type:"sql",source:(0,a.y)(e),metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),outputs:[],execution_count:r}}case"markdown":return{cell_type:"markdown",source:(0,a.y)(e),metadata:y(y({},e.metadata),{},{cell_id:e.id})};case"visualization":{const t=e.state,{execution_count:r}=t,o=g(t,u);return{cell_type:"visualization",metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),outputs:[],execution_count:r,source:""}}case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"text-cell-p":case"text-cell-bullet":case"text-cell-number":case"text-cell-todo":case"text-cell-callout":{const{source:t,formattedRanges:r}=(0,i.oP)(e.children);return{cell_type:e.type,source:t,metadata:y(y({},e.metadata),{},{cell_id:e.id,formattedRanges:r})}}case"input-text":{const t=e.state,{execution_count:r}=t,o=g(t,d);return{cell_type:"input-text",metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),source:"",outputs:[],execution_count:r}}case"input-select":{const t=e.state,{execution_count:r}=t,o=g(t,p);return{cell_type:"input-select",metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),source:"",outputs:[],execution_count:r}}case"input-slider":{const t=e.state,{execution_count:r}=t,o=g(t,h);return{cell_type:"input-slider",metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),source:"",outputs:[],execution_count:r}}case"input-date":{const t=e.state,{execution_count:r}=t,o=g(t,f);return{cell_type:"input-date",metadata:y(y(y({},e.metadata),o),{},{cell_id:e.id}),source:"",outputs:[],execution_count:r}}default:return(0,n.vE)(e)}}},44791:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var o=r(26056),n=r(55236),i=r(62840);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r,n={}){var i;(0,o.D)(t,r,s({slateState:e?(i=e,{children:i.children.map((e=>u(e))),selection:i.selection,marks:i.marks}):null},n))}function u(e){return n.xv.isText(e)?s(s({},e),{},{text:"<redacted>",length:e.text.length}):(0,i.L_)(e)?s(s({},e),{},{url:"<redacted>",children:e.children.map((e=>u(e)))}):s(s({},e),{},{children:e.children.map((e=>u(e)))})}},9897:(e,t,r)=>{"use strict";r.d(t,{Bu:()=>W,Dr:()=>pe,Qi:()=>ue,am:()=>Z,zB:()=>G,$R:()=>ge,Sd:()=>le,UA:()=>Q,nt:()=>z,VR:()=>Y,bo:()=>K,cP:()=>V,ER:()=>$,Su:()=>he,iW:()=>Ee,gz:()=>ve,qk:()=>q,ku:()=>X,JU:()=>U,GI:()=>me,_C:()=>re,hv:()=>fe,LY:()=>w,my:()=>H,Kl:()=>D,pk:()=>O,DS:()=>x,Uo:()=>k,US:()=>A,Q2:()=>I,wz:()=>j,VM:()=>P,bO:()=>te,FZ:()=>_,eb:()=>N,m3:()=>ee,xi:()=>M,Le:()=>ne,x$:()=>ie,EA:()=>oe,eT:()=>B,xV:()=>L,J2:()=>T,jM:()=>ye,GW:()=>J,NK:()=>be,qe:()=>de,NR:()=>se,HT:()=>ae});var o=r(36047),n=r(8550),i=r(76674),a=r(72008),s=r.n(a),c=r(79675),l=r.n(c),u=r(85508),d=r.n(u),p=r(55236),h=r(83184);function f(e,t){const r=e.split(t),o=r[r.length-1],n=parseInt(o,10);if(1===r.length||isNaN(n))return e+t+"2";return r.slice(0,-1).join(t)+t+(n+1||2)}var g=r(10356),m=r(34);const y=["at","match"],v=["at","match"];function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function w(e){return g.$W.includes(e)}function T(e){return t=e.type,g.lO.includes(t);var t}function I(e){return g.hI.includes(e.type)}function _(e){return g.yf.includes(e.type)}function A(e){return g.CU.includes(e)}function k(e){return I(e)||_(e)||L(e)}function O(e){return g.zS.includes(e)}function D(e){return O(e.type)}function P(e){return g.Wj.includes(e)}function j(e){return P(e.type)}function N(e){return"markdown"===e.type}function L(e){return"visualization"===e.type}function F(e){return g.gn.includes(e.type)}function R(e){if(!T(e))return!1;return p.NB.string(e)===o.gA}function U(e){const[t]=Z(e),[r]=null!=t?t:[];if(r&&R(r))return r.id}function x(e){const[t,r]=Z(e),[o]=null!=t?t:[],[n]=null!=r?r:[];return!o||!n&&R(o)}function M(e){return"text-cell-number"===e.type}function B(e){return"text-cell-todo"===e.type}function H(e){return"text-cell-callout"===e.type}function $(e,t){const r={},o=new Set([...Object.keys(e),...Object.keys(t)]);for(const n of o)d()(e[n],t[n])||(r[n]=t[n]);return Object.keys(r).length>0?r:null}function q(e,t){const r={};for(const o of Object.keys(e))r[o]=t[o];return r}function W(e){return{block:e[0],path:e[1]}}function G(e){if(0===e.children.length)return null;return p.ML.node(e,[0])[0]}function Z(e,t){const r=null!=t?t:{},{at:o,match:n}=r,i=C(r,y);return p.ML.nodes(e,E(E({},i),{},{at:e.children.length>0?null!=o?o:pe([]):[],match:e=>re(e)&&(!n||n(e))}))}function J(e,t){const{at:r,match:o}=t,n=C(t,v);return p.YR.moveNodes(e,E(E({},n),{},{at:null!=r?r:pe([]),match:e=>re(e)&&(!o||o(e))}))}function V(e,t){var r;const o=null!==(r=[...Z(e,{match:e=>e.id===t})][0])&&void 0!==r?r:null;return o?W(o):null}function z(e,t){try{const r=p.ML.node(e,pe([t]));return re(r[0])?W(r):null}catch{return null}}function Y(e,t){let r=p.ML.node(e,t);for(;r&&!("id"in r[0])&&r[1].length>0;)r=p.ML.parent(e,r[1]);return r&&"id"in r[0]?r[0]:null}function Q(e){const t=e.selection;if(!t)return null;console.debug("getBlockElementAtCurrentSelection",{selection:t});const r=K(e,t);return console.debug("getBlockElementAtCurrentSelection",{blockPathPair:r}),r}function K(e,t){const r=[...Z(e,{at:t})],o=1===r.length?r[0]:null;return o?W(o):null}function X(e,t){var r;const o=K(e,t);return null!==(r=null==o?void 0:o.block.id)&&void 0!==r?r:null}function ee(e){return p.W_.isElement(e)&&"notebook"===e.type}function te(e){return!("text"in e)&&!("id"in e)}function re(e){return"id"in e}function oe(e){return(0,n.UX)(e.type)}function ne(e){return g.zR.includes(e.type)}function ie(e,t){const r=he(t)-1;if(r<0)return!1;const o=z(e,r);return Boolean(o&&oe(o.block)&&p.ML.isEmpty(e,o.block))}function ae(e,t,r){const o=V(e,t);o&&ce(e,o,r)}function se(e,t,r){const o=h.F3.findPath(e,t);if(!o)return;ce(e,{block:t,path:o},r)}function ce(e,t,r){const o=t.block.metadata,n="function"==typeof r?(0,i.Uy)(o,r):E(E({},o),r);d()(o,n)||p.YR.setNodes(e,{metadata:n},{at:t.path})}function le(e){const t={};for(const[o]of Z(e)){var r;const e=o.type;t[e]=(null!==(r=t[e])&&void 0!==r?r:0)+1}return t}function ue(e,t,r){const o=s()(e);if(o.id=t,o.metadata.cell_id=t,o.sorting_key=null,k(o)&&(o.state={execution_count:null},o.metadata.allow_embed=!1),F(o)){const e=o.metadata.deepnote_variable_name;if(e){let t=e;for(;r.existingVariableNames.has(t);)t=f(t,"_");o.metadata.deepnote_variable_name=t}}return o}function de(e,t){return p.y$.isCommon(t,e.anchor.path)&&p.y$.isCommon(t,e.focus.path)?{anchorOffset:e.anchor.offset,focusOffset:e.focus.offset}:null}function pe(e){return[0,...e]}function he(e){return e[1]}function fe(e){return e.length>pe([]).length}function ge(e){var t;const r=null===(t=Q(e))||void 0===t?void 0:t.block;r&&e.isVoid(r)||h.F3.focus(e)}function me(e){return 0===e.offset&&e.path.every((e=>0===e))}function ye(e,t){const r=s()(e);for(const[e,o]of p.NB.nodes(r))if(re(e)){const n=t(e);if(n!==e){p.NB.parent(r,o).children[o[o.length-1]]=n}}return r}function ve(e){const t=[...Z(e,{at:pe([]),match:F})],r=l()(t.map((e=>e[0].metadata.deepnote_variable_name)));return new Set(r)}function be(e,t){m.MO.withoutSaving(e,(()=>{const r=G(e);r?e.apply({type:"set_node",path:pe([]),properties:r,newProperties:t,remote:!0,isMergeable:!1}):e.apply({type:"insert_node",path:pe([]),node:t,remote:!0,isMergeable:!1})}))}function Ee(e,t){const r=t.sorting_key;if(!r)return pe([0]);const o=Z(e);let n=0;for(const[e]of o){if(e.id===t.id)break;if(e.sorting_key&&e.sorting_key>=r)break;n+=1}return pe([n])}},83964:(e,t,r)=>{"use strict";function o(e){var t,r;return null!==(t=null===(r=e.children[0])||void 0===r?void 0:r.text)&&void 0!==t?t:""}function n(e){return[...e,0]}r.d(t,{v:()=>n,y:()=>o})},19764:(e,t,r)=>{"use strict";function o(){return"undefined"!=typeof window&&window.navigator.platform.includes("Mac")}r.d(t,{C0:()=>u,OJ:()=>i,QU:()=>n,Rx:()=>d,V5:()=>o,aJ:()=>s,eS:()=>p,kQ:()=>c,q9:()=>l,yl:()=>a});const n=e=>t=>{t.preventDefault&&t.preventDefault(),e()};function i(e){return"ready"===e}function a(e){return"submitted"===e||"scaling-up"===e}function s(e){return"stopping"===e}function c(e){return"not-exist"===e}function l(e){return u(e)||"not-exist"===e}function u(e){return e.includes("error")}function d(e){var t;const r=null===(t=e.data)||void 0===t?void 0:t.kernelStatus;return"idle"===r||"busy"===r}const p=e=>e.startsWith("int")||e.startsWith("short")||e.startsWith("long")||e.startsWith("float")||e.startsWith("half")||e.startsWith("single")||e.startsWith("double")||e.startsWith("byte")||e.startsWith("uint")||e.startsWith("ushort")||e.startsWith("ulong")||e.startsWith("ubyte")},77582:(e,t,r)=>{"use strict";r.d(t,{Is:()=>l,Kw:()=>d,Sx:()=>p,kd:()=>u});var o=r(69461),n=r(11506),i=r.n(n),a=r(86008),s=r(66753),c=r(39981);function l(e){const t=decodeURIComponent(e.split(/#|\?/)[0]).split("/").pop();return null!=t?t:"url-uploaded-file"}const u=e=>{s.Z.error({message:(0,c.BX)("div",{children:['A file "',i()(e,{length:25}),"\" you're trying to upload exceeds the maximum size limit of ",a.Zi/1e9,"GB.",(0,c.BX)("a",{href:o._.docsPage("deepnote-shared-datasets"),target:"_blank",rel:"noreferrer",style:{cursor:"pointer"},children:[" ","Upload it as a ",(0,c.tZ)("strong",{children:"Shared dataset"})," instead."]})]}),duration:5*a.Ln})},d=e=>e.size>a.Zi;function p(e){return Math.floor(e.loaded/e.total*100)}},17555:(e,t,r)=>{"use strict";r.d(t,{F:()=>o});const o=[]},38514:(e,t,r)=>{"use strict";r.d(t,{GS:()=>Ge,gs:()=>Je,h_:()=>Ze});var o=r(26375),n=r(91987),i=r(53407),a=r(3766),s=r(26056),c=r(72008),l=r.n(c),u=r(33161),d=r(85675),p=r(66753);const h=e=>{const{controllerRef:t,store:r,notebookApi:o}=e,n={async getCommentsState(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==r?void 0:r.getCommentState()},async getMentionableCollaborators(){const t=r.getState().project,o=t.collaborationProperties,n=[o.owner,...o.collaborators].filter((e=>e.name)).map((e=>e)),i=t.owner;if((0,a.Ul)(t.owner.teamAccessType))return new Set(n);const c=await e.commonApi.getTeamMembersBySlug(i.slug).then((e=>e.filter((e=>e.name)).map((e=>({email:e.email,name:e.name,avatar:e.avatar}))))).catch((e=>((0,s.D)(e,"error"),[])));return new Set([...n,...c])},async addComment(e,o,a){var s;const c=null===(s=t.current)||void 0===s?void 0:s.getControlChannelApi(),l=i.B.utc().format(),h=r.getState().project.focusedItem;if(!(0,d.hE)(h))throw new Error("Comments can be added only when file is focused.");const f={commentId:(0,u.Z)(),threadId:a,userId:r.getState().user.id,content:o,createdAt:l,editedAt:l};return null==c?void 0:c.addComment(f,e,h.id).then((()=>{n.closeNewCommentEditor(e)}),(e=>(p.Z.error({message:"Failed to post your comment. Please, try again."}),Promise.reject(e))))},async editComment(e,o,i){var a;const s=null===(a=t.current)||void 0===a?void 0:a.getControlChannelApi(),c=l()(r.getState().commentsState.comments[o]);return c.content=i,null==s?void 0:s.editComment(c).then((()=>n.closeCommentEditMode(e,o)),(e=>(p.Z.error({message:"Failed to edit your comment. Please, try again."}),Promise.reject(e))))},deleteComment(e,r){var o;const n=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi();null==n||n.deleteComment(e,r).catch((e=>{(0,s.D)(e,"warning"),p.Z.error({message:"Failed to delete your comment. Please, try again."})}))},resolveThread(e,r){var o;const a=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi(),s=i.B.utc().format();null==a||a.resolveThread(e,r,s).then((()=>{n.closeCommentContainer(r)})).catch((()=>{p.Z.error({message:"Failed to resolve this thread. Please, try again."})}))},unresolveThread(e,r){var o;const n=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi();null==n||n.unresolveThread(e,r).catch((()=>{p.Z.error({message:"Failed to unresolve this thread. Please, try again."})}))},showResolvedComments(e){r.dispatch({type:"SET_SHOW_RESOLVED_COMMENTS",isShown:e})},openCommentContainer(e){const t=null!=e?e:o.getFocusedCellId();t&&r.dispatch({type:"OPEN_COMMENT_CONTAINER",cellId:t})},closeCommentContainer(e){r.dispatch({type:"CLOSE_COMMENT_CONTAINER",cellId:e})},closeAllCommentContainers(){r.dispatch({type:"CLOSE_ALL_COMMENT_EDITORS"})},openCommentEditMode(e,t){r.dispatch({type:"OPEN_COMMENT_EDIT_MODE",cellId:e,commentId:t})},closeCommentEditMode(e,t){r.dispatch({type:"CLOSE_COMMENT_EDIT_MODE",cellId:e,commentId:t})},openNewCommentEditor(e){const t=null!=e?e:o.getFocusedCellId();t&&r.dispatch({type:"OPEN_NEW_COMMENT_EDITOR",cellId:t})},closeNewCommentEditor(e){r.dispatch({type:"CLOSE_NEW_COMMENT_EDITOR",cellId:e})}};return n};var f=r(26129);const g=e=>{const{store:t}=e,r=[f.TD.EDIT_NOTEBOOK,f.TD.NEW_FILE,f.TD.DELETE_FILE],o={async setCommentsNotificationPreferences(e){const{isSetByUser:r}=e;if(t.getState().user.is_anonymous)return;const o=t.getState().project.id,n=t.getState().config.commentsNotificationPreferences.preference;if(!t.getState().config.commentsNotificationPreferences.isSetByUser||r){t.dispatch({type:"SET_COMMENT_NOTIFICATION_PREFERENCE",preferences:e});try{const t=await fetch(`/api/project/${o}/notifications`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok)throw new Error(t.statusText)}catch(e){p.Z.error({message:"There was an error setting notification preference"}),(0,s.D)(e,"error"),t.dispatch({type:"SET_COMMENT_NOTIFICATION_PREFERENCE",preferences:{preference:n,isSetByUser:!1}})}}},setCommentsNotificationPreferencesForFirstEdit(){null===(()=>{var e;const o=t.getState().history.projectLogs,n=t.getState().user.id;return null!==(e=null==o?void 0:o.find((e=>r.includes(e.type)&&e.userId===n)))&&void 0!==e?e:null})()&&"all_threads"!==t.getState().config.commentsNotificationPreferences.preference&&o.setCommentsNotificationPreferences({preference:"all_threads",isSetByUser:!1}).catch((e=>{(0,s.D)(e,"warning")}))},setCommentsDisplayPreferences(e){t.dispatch({type:"SET_COMMENT_DISPLAY_PREFERENCES",option:e})}};return o};var m=r(62593),y=r(10356),v=r(83964),b=r(51416),E=r(25825),S=r(27809),C=r(19764);const w=e=>{const{blockTransforms:t,controllerRef:r,slateRef:o,store:n}=e,i={async submitOpsToUndoStackAndCurrentFile(e,t=!0){var o,n;const i=null===(o=r.current)||void 0===o?void 0:o.getFocusedFileUndoStack(),a=null===(n=r.current)||void 0===n?void 0:n.getFocusedDoc();return new Promise(((r,o)=>{if(i&&i.addOps(e),null==a||!a.type){const e=new Error("Trying to submit ops, but there is no doc");return a?(0,s.D)(e,"fatal",{doc:{type:a.type,id:a.id,collection:a.collection,version:a.version}}):(0,s.D)(e,"fatal"),void o(e)}a.submitOp(e,{source:!0},(e=>{if(e)return t&&p.Z.error({message:"The operation could not be performed"}),o(e);r()}))}))},triggerEditorHoverCallback(e,t){var o;const n=null===(o=r.current)||void 0===o?void 0:o.editorRefs[t];null!=n&&n.current&&n.current.onHover(e)},async requestSharedbAutocomplete(e,o){if(!r.current)return;const i=r.current.getNotebookDoc(o),a=E.q.selectHardwareStatus(n.getState());if(!i||!(0,C.OJ)(a))return[];await(0,S.EM)((e=>i.whenNothingPending(e)));if(!t.getBlockById(e.cellId))return void(0,s.D)(new Error(`Tried to request autocomplete for cell ${e.cellId} that isn't present in the notebook`),"error");const c=r.current.getControlChannelApi();return null==c?void 0:c.requestSharedbAutocomplete(e,o)},async requestSharedbHover(e,t){const o=E.q.selectHardwareStatus(n.getState());if((0,C.OJ)(o)&&r.current){const o=r.current.getControlChannelApi();return null==o?void 0:o.requestSharedbHover(e,t)}},async requestSharedbDefinition(e,t){const o=E.q.selectHardwareStatus(n.getState());if((0,C.OJ)(o)&&r.current){const o=r.current.getControlChannelApi();return null==o?void 0:o.requestSharedbDefinition(e,t)}},async requestSharedbSignatureHelp(e,t){const o=b.W.selectIsConnected(n.getState()),i=E.q.selectHardwareStatus(n.getState());if(o&&(0,C.OJ)(i)&&r.current){const o=r.current.getControlChannelApi();return null==o?void 0:o.requestSharedbSignatureHelp(e,t)}},async requestBlockApiAutocomplete(e,o){if(!r.current)return;if(!t.getBlockById(e.cellId))return void(0,s.D)(new Error(`Tried to request autocomplete for cell ${e.cellId} that isn't present in the notebook`),"error");const n=r.current.getControlChannelApi(),i=this._getAutocompleteBlocks();return i?null==n?void 0:n.requestAutocomplete(e,o,i):void 0},async requestBlockApiHover(e,t){const o=E.q.selectHardwareStatus(n.getState());if((0,C.OJ)(o)&&r.current){const o=r.current.getControlChannelApi(),n=this._getAutocompleteBlocks();if(!n)return;return null==o?void 0:o.requestHover(e,t,n)}},async requestBlockApiDefinition(e,t){const o=E.q.selectHardwareStatus(n.getState());if((0,C.OJ)(o)&&r.current){const o=r.current.getControlChannelApi(),n=this._getAutocompleteBlocks();if(!n)return;return null==o?void 0:o.requestDefinition(e,t,n)}},async requestBlockApiSignatureHelp(e,t){const o=b.W.selectIsConnected(n.getState()),i=E.q.selectHardwareStatus(n.getState());if(o&&(0,C.OJ)(i)&&r.current){const o=r.current.getControlChannelApi(),n=this._getAutocompleteBlocks();if(!n)return;return null==o?void 0:o.requestSignatureHelp(e,t,n)}},_getAutocompleteBlocks(){const e=t.getCodeBlocks({excludeShellBlocks:!0});if(e)return e.map((e=>({id:e.id,source:(0,v.y)(e)})));{const e=new Error("Cannot collect code blocks, missing Slate instance");(0,s.D)(e,"error")}},getBlocksForInlineCodeCompletion(){const e=t.getBlocksByTypes(["code","markdown",...y.wv]);if(!e){const e=new Error("Cannot collect blocks for code completion, missing Slate instance");return(0,s.D)(e,"error"),null}return e},setFileEditorPosition(t,r){var o,n,i;const a=null===(o=e.notebookApi.getEditorRef("file-editor"))||void 0===o||null===(n=o.current)||void 0===n?void 0:n.editorInstance,s=null==a||null===(i=a.getModel())||void 0===i?void 0:i.getPositionAt(t);s&&(null==a||a.setPosition(s),null!=r&&r.alsoScrollEditor&&(null==a||a.revealLine(s.lineNumber)))},undo(){var e;if(o.current)return void o.current.undoEdit();const t=null===(e=r.current)||void 0===e?void 0:e.getFocusedFileUndoStack();if(!t)return(0,s.D)(new Error("Trying to undo but there is no undostack"),"warning");const n=t.undo();null!==n&&i.setFileEditorPosition(n,{alsoScrollEditor:!0})},redo(){var e;if(o.current)return void o.current.redoEdit();const t=null===(e=r.current)||void 0===e?void 0:e.getFocusedFileUndoStack();if(!t)return(0,s.D)(new Error("Trying to redo but there is no undostack"),"warning");const n=t.redo();null!==n&&i.setFileEditorPosition(n,{alsoScrollEditor:!0})}};return i};var T=r(54336),I=r(32037);var _=r(71267),A=r(95781),k=r(32902),O=r.n(k),D=r(66648),P=r.n(D),j=r(8097),N=r(65661),L=r(48271),F=r(90763),R=r(77582),U=r(15455);const x=e=>{const{controllerRef:t,store:r,notebooksFetcher:o,gettingStartedMutator:n}=e,i=r.dispatch,c=async o=>{e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{var n;const e=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),i=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(i,f.EJ.MANIPULATE_FILES))return await Promise.reject(new Error("Not enough permissions"));if(!e)throw new Error("The controlChannelApi is not available in createNewNotebookInDB()");return await e.createNotebookInDB(o)}catch(e){throw(0,s.D)(e,"fatal"),new Error("Failed to create notebook")}},l={decompressFile:async e=>{var o;const n=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi(),i=r.getState().project.collaborationProperties.currentUserAccessType;if((0,a.C5)(i,f.EJ.MANIPULATE_FILES))return await(null==n?void 0:n.decompressContents(e).catch((()=>p.Z.error({message:"Not able to decompress the file"})))),p.Z.success({message:"File was successfully decompressed"})},deleteFile:o=>{var n;const i=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),s=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(s,f.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const c=r.getState().project.focusedItem;((0,d.rN)(c)||(0,d.JF)(c))&&c.relativePath===o&&r.dispatch((0,N.Kz)()),null==i||i.deleteItem(o).catch((()=>{p.Z.error({message:"File could not be deleted"})}))},deleteNotebookInDb:async o=>{var n;const i=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(i,f.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const s=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi();try{await(null==s?void 0:s.deleteNotebookInDB(o))}catch(e){p.Z.error({message:"Unable to delete a notebook. Please contact support."})}},createNewItem:async(o,n)=>{var s;const c=null===(s=t.current)||void 0===s?void 0:s.getControlChannelApi(),l=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(l,f.EJ.MANIPULATE_FILES))return Promise.reject(new Error("Not enough permissions"));e.layoutApi.switchRightSidebarTab("project");const u=r.getState().project.focusedItem,d="file"===(null==u?void 0:u.type)&&u.relativePath,h=null!=n?n:d?P().dirname(d):"/";let g=h;const m=[];for(;"/"!==g;)m.push(g),g=P().dirname(g);const y=P().join(null!=h?h:"/","untitled");e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{const e=await(null==c?void 0:c.createNewItem(y,o));return i({type:N.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e}),i({type:N.xg.SET_LATEST_CREATED_FILE_PATH,latestCreatedFilePath:e}),i({type:N.xg.SET_EXPANDED_DIRS,expandedDirPaths:O()([...r.getState().filesystem.expandedDirPaths,...m])}),await Promise.resolve(e)}catch(e){return p.Z.error({message:`Unable to create a new ${"directory"===o?"folder":o}`}),Promise.reject(e)}},createNewNotebookInDB:c,createNewNotebookInDBWithUniqueName:async()=>{const e=await o.fetchNotebooks(r.getState().project.id),t=(0,I.js)(e,"Notebook",{separator:" ",startWithNumber:!0});return c(t)},duplicateItem:async o=>{var n;const s=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),c=r.getState().project.collaborationProperties.currentUserAccessType;if((0,a.C5)(c,f.EJ.MANIPULATE_FILES)){e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{const e=await(null==s?void 0:s.duplicateItem(o));return i({type:N.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e}),await Promise.resolve(e)}catch(e){return p.Z.error({message:"Unable to duplicate a file"}),Promise.reject(e)}}},duplicateNotebookInDb:async o=>{var n;const i=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(i,f.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const s=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi();try{return await(null==s?void 0:s.duplicateNotebookInDB(o))}catch(e){p.Z.error({message:"Unable to duplicate a notebook. Please contact support."})}},getDownloadLink(e){const t=((e,t)=>{let r=e.replace(/^~/,"/root");if(t.isAbsolute(r)){const e=/^\/root\/work\/|^\/work\//;r=r.replace(e,""),r=t.normalize(r)}return r})(e,P());return`/api/project/${r.getState().project.id}/download-file?path=${encodeURIComponent(t)}`},getExportLink:()=>`/api/project/${r.getState().project.id}/export`,cancelFileRename(){const e=r.getState().project.collaborationProperties.currentUserAccessType;(0,a.C5)(e,f.EJ.MANIPULATE_FILES)&&i({type:N.xg.SET_RENAMING_FILE_PATH})},startFileRename(e){const t=r.getState().project.collaborationProperties.currentUserAccessType;(0,a.C5)(t,f.EJ.MANIPULATE_FILES)&&i({type:N.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e})},async renameFile(o,n){const c=r.getState().filesystem.latestCreatedFilePath,l=c===o;c&&i({type:N.xg.SET_LATEST_CREATED_FILE_PATH});const u=r.getState().filesystem.entities,h=Object.values(u).find((e=>e.relativePath===o));if(!h){const e="File you are trying to rename no longer exist.";return p.Z.error({message:e}),i({type:N.xg.SET_RENAMING_FILE_PATH}),void(0,s.D)(new Error(e),"error")}if(o!==n){const e=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(e,f.EJ.MANIPULATE_FILES)){const e="You do not have an authorization to rename this file.";return p.Z.error({message:e}),i({type:N.xg.SET_RENAMING_FILE_PATH}),void(0,s.D)(new Error(e),"error")}try{var g;const e=null===(g=t.current)||void 0===g?void 0:g.getControlChannelApi();await(null==e?void 0:e.renameItem(o,n))}catch(e){const t="Error while renaming or moving file.";return p.Z.error({message:t}),i({type:N.xg.SET_RENAMING_FILE_PATH}),void(0,s.D)(e,"error")}}const m=r.getState().project.focusedItem,y=(0,d.rN)(m)||(0,d.JF)(m)?m:null;h.relativePath===(null==y?void 0:y.relativePath)&&i({type:N.Vm.UPDATE_FOCUSED_ITEM,item:{relativePath:n}}),l&&(0,_.zE)(h)&&(i({type:N.xg.CHANGE_PATH,oldPath:o,newPath:n}),e.projectFocusApi.setActiveFile(n).catch((e=>(0,s.D)(e,"warning")))),i({type:N.xg.SET_RENAMING_FILE_PATH})},async renameNotebookInDb(e,o,n,i){const c=r.getState().project.collaborationProperties.currentUserAccessType;if((0,a.C5)(c,f.EJ.MANIPULATE_FILES))try{var l;const r=null===(l=t.current)||void 0===l?void 0:l.getControlChannelApi();await(null==r?void 0:r.renameNotebookInDB(e,o,n,i))}catch(e){const t="Error while renaming or moving notebook.";p.Z.error({message:t}),(0,s.D)(e,"error")}},async refreshFilesystem(){var e;await(null===(e=t.current)||void 0===e?void 0:e.refreshFilesystem())},isFilePathEmpty:e=>!r.getState().filesystem.entities[e],async cloneGitRepo(e,t,o,n){const i=r.getState().config.collaborationServiceUrl,a=r.getState().project.id;return fetch(`${i}/project/${a}/upload-file-from-url`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({downloadUrl:e,targetFolderPath:t,oauthToken:o,type:n})})},async uploadItemFromUrl(e,t,o,n){const a=r.getState().config.collaborationServiceUrl,s=r.getState().project.id,c=l.addUploadingItem(n,t),u=await fetch(`${a}/project/${s}/upload-file-from-url`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({downloadUrl:e,targetFolderPath:o})});if(u.ok)r.getState().modalManager.openedModal!==N.Qi.FILE_UPLOAD_MODAL?(p.Z.success({message:`${t} has been uploaded successfully!`}),i({type:N.xg.REMOVE_UPLOADING_ITEMS,uuids:[c]})):l.updateUploadingItemStatus(c,F.D.DONE);else{if(507===u.status)(0,R.kd)(e);else{const e=406===u.status?"Your URL is badly formed or contains invalid characters":"An error ocurred while uploading the file.";p.Z.error({message:e})}l.updateUploadingItemStatus(c,F.D.ERROR)}},async readMissingPaths(e){var o;const n=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi(),a=e.map((e=>r.getState().filesystem.entities[e])).filter((e=>e&&"directory"===e.type&&(void 0===e.children||0===e.children.length))).map((e=>e.relativePath));await(null==n?void 0:n.fetchFilesystemEntities(a).then((e=>{i({type:N.xg.ENTITIES_LOADED,entities:e,partial:!0})})).catch((()=>{i({type:N.xg.SET_FILESYSTEM_UNAVAILABLE,isUnavailable:!0})})))},async uploadLocalFile(o,s,c,u=!1){const d=r.getState().project.collaborationProperties.currentUserAccessType;if((0,a.C5)(d,f.EJ.MANIPULATE_FILES)){if(!(0,R.Kw)(o))return new Promise(((a,d)=>{var h,f;const g=l.addUploadingItem(F.A.LOCAL,null!==(h=o.path)&&void 0!==h?h:o.name,o.size),m=r.getState().project.id,y=new FormData,v=null!=s?s:"/",b=P().join(v,P().dirname(null!==(f=o.path)&&void 0!==f?f:""));y.append("targetFolderPath",b),y.append("file",o,o.name),c&&y.append("uploadNotebooksToDb","true");const E=e=>{u||p.Z.error({message:"An error occurred while uploading the files."}),l.updateUploadingItemStatus(g,F.D.ERROR),d(new Error("An error occurred while uploading the files."))},S=new XMLHttpRequest;S.upload.addEventListener("progress",(e=>{e.lengthComputable&&l.updateUploadingItemProgress(g,(0,R.Sx)(e))}),!1),S.addEventListener("load",(s=>{var c;if(S.status>=400)return void E();r.getState().modalManager.openedModal===N.Qi.FILE_UPLOAD_MODAL||u?l.updateUploadingItemStatus(g,F.D.DONE):p.Z.success({message:`${o.name} has been uploaded successfully!`}),null===(c=t.current)||void 0===c||c.refreshFilesystem().then((()=>{i({type:N.xg.REMOVE_UPLOADING_ITEMS,uuids:[g]})}));try{const e=S.responseText,t=JSON.parse(e);a({uploadedFilePath:t.uploadedFilePath,uploadedNotebookId:t.uploadedNotebookId})}catch(e){a(void 0)}const d=r.getState().filesystem.entities,h=2===Object.keys(d).filter((e=>e.includes(".ipynb"))).length;o.name.includes(".ipynb")&&h&&e.projectFocusApi.setActiveFile(P().join(b,o.name)).catch(console.error);const f=Object.keys(d).filter((e=>e.includes(".csv"))).length<1;if(o.name.includes(".csv")&&f){const e=r.getState().project.team_id;n.updateGettingStartedStepCompletionData(e,A.R.DATA_CONNECTION_SUBSTEP_CSV_UPLOADED)}}),!1),S.addEventListener("error",(e=>{E()}),!1),S.open("POST",`/api/project/${m}/upload-file`),S.withCredentials=!0,S.send(y)}));(0,R.kd)(o.name)}else p.Z.warning({message:"You need at least Edit-level access to upload files"})},async saveFile(t){await(0,j.V)(e.fileSaver.saveFile(t),5e3)},async saveActiveFile(){const t=r.getState().project.focusedItem;(0,d.rN)(t)&&await e.fileSaver.forceSave(t.id).catch((e=>(0,s.D)(e,"warning")))},async generateInitNotebook(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==r?void 0:r.generateInitNotebook()},async generateDockerfile(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==r?void 0:r.generateDockerfile()},addUploadingItem(e,t,r){const o=(0,u.Z)();return i({type:N.xg.ADD_UPLOADING_ITEM,source:e,name:t,size:r,uuid:o}),o},setIsTooltipOpen(e){i({type:N.xg.SET_IS_TOOLTIP_OPEN,isOpen:e})},updateUploadingItemStatus(e,t){i({type:N.xg.UPDATE_UPLOADING_ITEM_STATUS,uuid:e,status:t})},updateUploadingItemProgress(e,t){i({type:N.xg.UPDATE_UPLOADING_ITEM_PROGRESS,uuid:e,progress:t})},removeUploadedItems(){const e=[];for(const[t,o]of Object.entries(r.getState().filesystem.uploadingItems))o.status===F.D.DONE&&e.push(t);i({type:N.xg.REMOVE_UPLOADING_ITEMS,uuids:e})},removeUploadedItemsById(e){i({type:N.xg.REMOVE_UPLOADING_ITEMS,uuids:e})},collapseDirectory(e){const{expandedDirPaths:t}=r.getState().filesystem;t.includes(e.relativePath)&&(0,_.IQ)(e)&&i({type:N.xg.SET_EXPANDED_DIRS,expandedDirPaths:t.filter((t=>t!==e.relativePath))})},async expandDirectory(e){const{expandedDirPaths:t}=r.getState().filesystem,o=t.includes(e.relativePath),n=[...t,e.relativePath];if(!o&&(0,_.IQ)(e))return i({type:N.xg.SET_EXPANDED_DIRS,expandedDirPaths:n}),l.readMissingPaths(n)},setDraggedId(e){i({type:N.xg.SET_DRAGGED_ID,id:e})},setDraggedOverId(e){i({type:N.xg.SET_DRAGGED_OVER_ID,id:e})},async handleDrop(e,t){const{entities:o}=r.getState().filesystem,n=o[t];if(!(0,L._U)(e.relativePath,n.relativePath))return;if(t===e.relativePath||!n)return;const i=(0,L.Zg)(n,e);return l.renameFile(t,i)},resetDrag(){l.setDraggedId(""),l.setDraggedOverId("")},async appendTextToFile(o,n){var i;const s=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(s,f.EJ.MANIPULATE_FILES))return;const c=null===(i=t.current)||void 0===i?void 0:i.getControlChannelApi();l.isFilePathEmpty(o)&&await(null==c?void 0:c.createNewItem(o,"file"));const u=await(null==c?void 0:c.loadItem(o));if(!u||!t.current)throw new Error("A file we just ensured exists could not be loaded");const d=await e.itemFocusApi.loadDocAndSubscribe(u.id,o);if(!d)throw new Error("The doc of a file we just ensured exists could not be loaded");const p=d.data,h=p.length;let g=n;h>0&&"\n"!==p.charAt(h-1)&&(g="\n"+n),await(0,S.EM)((e=>d.submitOp([{p:[h],si:g}],void 0,e)))},openFileInNewTab(e){const t=r.getState().project,o=(0,U.g)({project:t,filePath:e.relativePath});window.open(o.fullUrlWithFile)},async selectFile(t){const{filesystem:o}=r.getState(),n=o.renamingFilePath===t.relativePath,i=o.expandedDirPaths.includes(t.relativePath),a=o.loadingFilePath===t.relativePath;if(!n){if(!i&&(0,_.IQ)(t))return l.expandDirectory(t);if(i&&(0,_.IQ)(t)&&l.collapseDirectory(t),!(n||(0,_.IQ)(t)||a))return e.projectFocusApi.setActiveFile(t.relativePath)}},showRawCsv(){i({type:"SHOW_RAW_CSV"})},hideRawCsv(){i({type:"HIDE_RAW_CSV"})},async loadReadOnlyDocument(e){try{const t=this.getDownloadLink(e),r=await fetch(t,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`loadReadOnlyDocument() failed, status: ${r.status}`);const o=await r.text();i({type:N.xg.SET_READONLY_DOCUMENT,path:e,content:o})}catch(e){throw(0,s.D)(e,"error"),new Error("Failed to load readonly document")}}};return l};var M=r(45409);function B(e){const{fileApi:t,store:r}=e,o={async connectIntegrationWithConfirmation(e,t){const n=r.getState().connection.hardwareStatus,i=(0,C.OJ)(n),a=r.getState().integrationsState.integrations.find((t=>t.id===e));if(!a)return!1;if(a.state===M.ws.ALWAYS_ON)return!0;if(i&&M.is.includes(a.type))return new Promise(((r,n)=>{t({title:"Connect integration to project?",content:"Your machine will be restarted, and your notebook variables will be cleared.",confirmText:"Connect integration",onConfirm:()=>{o.connectAndRefetchIntegration(e).then((()=>r(!0))).catch(n)}})}));const s=await o.connectAndRefetchIntegration(e);return!s.ok&&s.forcible?new Promise(((r,n)=>{t({title:"Interrupt running notebook to connect integration?",content:"We need to interrupt your notebook's execution in order to connect this integration now or you can connect the integration after the execution is finished",confirmText:"Interrupt and connect",onConfirm:()=>{o.connectAndRefetchIntegration(e,{force:!0}).then((()=>r(!0))).catch(n)}})})):s.ok},async disconnectIntegrationWithConfirmation(e,t){const o=r.getState().connection.hardwareStatus,i=(0,C.OJ)(o),a=r.getState().integrationsState.integrations.find((t=>t.id===e));if(!a)return;if(a.state===M.ws.ALWAYS_ON)return!0;if(i&&M.is.includes(a.type))return new Promise(((r,o)=>{t({title:"Disconnect integration?",content:"Your machine will be restarted, and your notebook variables will be cleared.",confirmText:"Disconnect integration",onConfirm:()=>{n(e).then((()=>r(!0))).catch(o)}})}));const s=await n(e);return!s.ok&&s.forcible?new Promise(((r,o)=>{t({title:"Interrupt running notebook to disconnect integration?",content:"We need to interrupt your notebook's execution in order to disconnect this integration now, or you can disconnect the integration after the execution is finished",confirmText:"Interrupt and disconnect",onConfirm:()=>{n(e,{force:!0}).then((()=>r(!0))).catch(o)}})})):void 0},async connectAndRefetchIntegration(n,i){r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:n,nextState:M.ws.CONNECTING}});const a=r.getState().project.id,s=await o.connectIntegration(n,a,i);if(s.ok){r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:n,nextState:M.ws.CONNECTED}}),await e.integrationFetcher.fetchAndStoreIntegrations(a);const o=r.getState().integrationsState.integrations.find((e=>e.id===n));o&&(0,M.D7)(o.state)&&await t.refreshFilesystem()}else r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:n,nextState:M.ws.AVAILABLE}});return s},connectIntegration:async(e,t,r)=>H("connect",e,t,r),async refetchIntegrations(){const t=r.getState().project.id;await e.integrationFetcher.fetchAndStoreIntegrations(t)},async revokeIntegrationAuthToken(e){200!==(await fetch(`/auth/token/${e}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).status&&(0,s.D)(new Error("Failed to revoke integration auth token"),"error",{integrationId:e})},setIntegrationOAuthDoneCallback(e,t,r={}){window.deepnote.oauthDoneCallback=n=>{n?(r.refetchIntegration&&o.refetchIntegrations(),e(!0)):((0,s.D)(new Error("Federated integration authentication failed"),"error",{integrationId:r.integrationId,federatedAuthType:r.federatedAuthType}),r.displayMessageInCaseOfError&&p.Z.error({message:"Failed to authenticate the integration. Please try again later or contact our support."}),t(new Error("Federated integration authentication failed")))}},authenticate:async(e,t,r,n={displayMessageInCaseOfError:!0,refetchIntegration:!0})=>new Promise(((i,s)=>{switch(e){case M.As.OKTA:window.open(`/auth/snowflake/okta/${t}?source=${r}`,void 0,"popup");break;case M.As.NATIVE_SNOWFLAKE:window.open(`/auth/snowflake/native/${t}?source=${r}`,void 0,"popup");break;case M.As.AZURE_AD:window.open(`/auth/snowflake/azuread/${t}?source=${r}`,void 0,"popup");break;case M.rw.GOOGLE_OAUTH:window.open(`/auth/bigquery/google-oauth/${t}?source=${r}`,void 0,"popup");break;default:(0,a.vE)(e)}o.setIntegrationOAuthDoneCallback(i,s,{federatedAuthType:e,integrationId:t,displayMessageInCaseOfError:n.displayMessageInCaseOfError,refetchIntegration:n.refetchIntegration})})),reAuthenticate:async(e,t)=>(await o.revokeIntegrationAuthToken(t),o.authenticate(e,t,"notebook"))},n=async(t,o)=>{r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:t,nextState:M.ws.DISCONNECTING}});const n=r.getState().project.id,i=await H("disconnect",t,n,o);return i.ok?(r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:t,nextState:M.ws.AVAILABLE}}),await e.integrationFetcher.fetchAndStoreIntegrations(n)):r.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:t,nextState:M.ws.CONNECTED}}),i};return o}async function H(e,t,r,o){const n=await fetch(`/api/integration/connect/${t}/${r}`,{method:"connect"===e?"POST":"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:null==o?void 0:o.force})});if(n.ok)return{ok:!0};if(409===n.status)return{ok:!0};if(405===n.status)return{ok:!1,forcible:!0};{(0,s.D)(new Error(`Operation ${e} of ${t} to project ${r} failed with status ${n.status}`),"error");const o="connect"===e?"Failed to connect the integration to the project. Please try again later or contact our support.":"Failed to disconnect the integration from the project. Please try again later or contact our support.";return p.Z.error({message:o}),{ok:!1,forcible:!1}}}const $=e=>{const{store:t}=e,r=t.dispatch;return{switchRightSidebarTab(e){r({type:"SWITCH_RIGHT_SIDEBAR_TAB",tab:e})}}};var q=r(8550),W=r(25941),G=r(36047),Z=r(95592),J=r(17961),V=r(9897),z=r(96759),Y=r(65068),Q=r(5575),K=r(43035),X=r(50133),ee=r(29262),te=r(93111),re=r(95559),oe=r(23074);function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ae(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const se=e=>{const{blockTransforms:t,controllerRef:r,store:o,projectTrack:n}=e,i=o.dispatch,c=e=>{p.Z.error({message:"The operation could not be performed"}),(0,s.D)(new Error(`ShareDB error: code ${e.code} - ${e.message}`),"error")},l=()=>o.getState().project.team_id;const u={canExecute(e){const t=o.getState().connection.hardwareStatus,r=o.getState().connection.isConnected,n=Q.H.selectCurrentUserAccessType(o.getState()),i=!e||(0,a.C5)(n,f.EJ.EXECUTE_CELL);return t&&(0,C.OJ)(t)&&r&&i},splitCell(){const e=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(e,f.EJ.MANIPULATE_CELLS)&&t.transact((()=>{const e=t.splitCell();e&&(n.track("Block split",{type:e.type}),u.focusCell(e.id))}))},async getNotebookIdByPath(e){var t,o;const n=null===(t=r.current)||void 0===t?void 0:t.getControlChannelApi(),i=await(null==n?void 0:n.loadItem(e));return null!==(o=null==i?void 0:i.id)&&void 0!==o?o:null},async formatCell(e=null){const r=o.getState().config.formatterUrl,i=Q.H.selectCurrentUserAccessType(o.getState());if(!r||!(0,a.C5)(i,f.EJ.MANIPULATE_CELLS))return p.Z.error({message:"Formatting failed"});try{await t.formatCell(e,(async e=>{const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({snippet:e})});if(!t.ok)throw new Error(`Formatter failed with status ${t.status}`);const o=await t.json();if("InvalidInput"===o.errorType)return p.Z.error({message:"Parsing failed, please check your code for errors."}),null;if(o.errorMessage)throw new Error(o.errorMessage);return o})),n.track("Block formatted")}catch(e){console.log(e),(0,s.D)(e,"warning"),p.Z.error({message:"Formatting failed"})}},filterShortcut(e){if(o.getState().modalManager.openedModal)return!1;const r=e.target;if("TEXTAREA"===r.tagName)return!1;const n=["INPUT","SELECT"],i=t.getFocusedCellType();return!!(n.includes(r.tagName)&&i&&["input-text","input-select","input-date","input-slider"].includes(i))||!n.includes(r.tagName)},async publishProject(t,n,a,c){var l;if(!(null===(l=r.current)||void 0===l?void 0:l.getFocusedNotebookDoc()))return p.Z.error({message:"Failed to publish project, please contact our support"}),void(0,s.D)(new Error("Trying to publish a notebook, but there is no doc."),"error");if(t&&await e.fileApi.saveFile(t),a){var u;const e=null===(u=r.current)||void 0===u?void 0:u.getControlChannelApi();await(null==e?void 0:e.saveItem(a))}const d=o.getState().project.id,h=await fetch(`/api/project/${d}/publish`,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify({filesystemNotebookPath:n,publishedAccess:c,notebookInDbID:a})});if(h.ok)p.Z.info({message:"Notebook was published successfully"}),i(N.j7(n,new Date,c,a));else if(403===h.status)await p.Z.error({message:"Apps are not allowed to be shared publicly in your workspace. Contact a workspace admin to enable it."});else await p.Z.error({message:"Failed to publish project, please contact our support."}),(0,s.D)(new Error(`Failed to publish project. Response status: ${h.statusText}, body: ${await h.json()}`),"error")},async unpublishProject(){const e=o.getState().project.id,t=await fetch(`/api/project/${e}/publish`,{credentials:"include",method:"DELETE"});if(!t.ok)return p.Z.error({message:"Failed to unpublish project"}),void(0,s.D)(new Error(`Failed to unpublish project. Response status: ${t.statusText}`),"error");p.Z.info({message:"Notebook was unpublished successfully"}),i(N.EO())},async requestVariableDetails(e,t){var o;const n=null===(o=r.current)||void 0===o?void 0:o.getControlChannelApi();return new Promise(((r,o)=>null==n?void 0:n.requestVariableDetails(e,t).catch((e=>{p.Z.error({message:` An error occurred while fetching stats for ${t}`}),o(e)})).then((()=>{r()}))))},submitUserInput(e){var t;const o=null===(t=r.current)||void 0===t?void 0:t.getControlChannelApi();null==o||o.submitUserInput(e)},startHardwareAndRunCellById:async e=>u.startHardwareAndRun((()=>u.execute({selectBelow:!1,cellId:e})),!1).catch((e=>{(0,s.D)(e,"warning"),p.Z.error({message:"Executing block failed"})})),async startHardwareAndRunFocusedCell({selectBelow:e,skipSqlCache:r}){const o=t.getFocusedCellId();if(o)return u.startHardwareAndRun((()=>u.execute({selectBelow:e,cellId:o,skipSqlCache:r})),!0).catch((e=>{(0,s.D)(e,"warning"),p.Z.error({message:"Executing block failed"})}))},startHardwareAndRunSelectedCells:async()=>u.startHardwareAndRun((()=>{u.executeSelectedCells()}),!1).catch((e=>{(0,s.D)(e,"warning"),p.Z.error({message:"Executing selected blocks failed"})})),async startHardwareAndRun(r,n){if(n){const e=t.getFocusedCellType();if(e&&"markdown"===e)return r()}const i=o.getState().connection.hardwareStatus;if((0,C.kQ)(i)){if(!await e.projectApi.startHardware())return;try{return await(0,a.PM)((()=>Promise.resolve((0,C.OJ)(o.getState().connection.hardwareStatus))),48e4,100,"Timed out waiting for running HW"),r()}catch(e){return p.Z.error({message:"Failed to start the machine. Try restarting it from the Environment tab, or contact support."}),void(0,s.D)(e,"error")}}return r()},async executeAll({skipSqlCache:t}={}){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.EXECUTE_CELL))return;if(!o.getState().user.is_anonymous)return await e.projectApi.restartKernel(),u.executeRange({skipSqlCache:t});e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:this.getLinkToCurrentLocation()})},async executeFromThisCell(){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.EXECUTE_CELL))return;if(o.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:this.getLinkToCurrentLocation()});const n=t.getFocusedCellId();return n?u.executeRange({startCellId:n}):void 0},async executeAboveThisCell(){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.EXECUTE_CELL))return;if(o.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:this.getLinkToCurrentLocation()});const n=t.getFocusedCellId();return n?u.executeRange({startCellId:void 0,endCellId:n}):void 0},executeSelectedCells(){const e=t.getAllBlockIds();if(!e)return;const r=o.getState().layout.selectedCells,n=(0,oe.qC)(r,e);this.executeCells(n)},executeCells(t){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.EXECUTE_CELL))return;o.getState().user.is_anonymous?e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:this.getLinkToCurrentLocation()}):t.forEach((e=>{u.execute({selectBelow:!1,cellId:e})}))},getFocusedCellId:()=>t.getFocusedCellId(),getFocusedBlock(){const e=t.getFocusedCellId();return e?t.getBlockById(e):null},getFocusedCellType:()=>t.getFocusedCellType(),focusCell(e,r={}){const{position:n=null,align:i=null,initial:a=!1}=r;i&&u.scrollToCell(e,{initial:a,align:i});const c=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(c)){const e=new Error("focusCell works only on notebook files");return(0,s.D)(e,"warning")}t.focusCell(e,{position:n})},defocus(){t.defocus(),this._giveUpOwnershipOfOwnedCells({except:[]})},focusInitialCell(e){var t;const r=null===(t=o.getState().project.focusedItem)||void 0===t?void 0:t.relativePath,n=(0,te.A6)(),i=(0,te._R)();if(i&&r===n)return u.focusCell(i,{initial:!0,align:"center"}),void(0,te.nr)(n);const a=(0,oe.D)(e);a&&u.focusCell(a,{initial:!0,align:"center"})},doesPositionExist:e=>t.doesPositionExist(e),insertCellAtPosition(e,r,i){const a=t.insertCellAtPosition(e,r);if(!a)return;u.scrollToCell(a.id);const s=o.getState().project,c=Q.H.selectCurrentUserAccessType(o.getState());n.track("Block created",{type:a.type,projectId:s.id,workspaceId:s.team_id,location:i,accessType:c})},cellCanExecute(e){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.EXECUTE_CELL))return!1;const n=t.getCellType(e);if("markdown"===n)return!0;if(!u.canExecute(!1))return!1;const i=K.l.createKernelStatusSelector()(o.getState()),s=K.l.createExecutionQueueSelector()(o.getState());return"executing"!==(0,ee.vj)(i,s,!1,e)||"visualization"===n},async fetchAst(){const e=b.W.selectIsConnected(o.getState()),t=this.getFocusedNotebookId();if(!t)return null;if(e&&r.current){const e=r.current.getControlChannelApi(),o=await u.startHardwareAndRun((()=>null==e?void 0:e.fetchBlockVariablesDAG(t)),!1);return null!=o?o:null}return null},focusInputRequestEditor(){var e;const t=null===(e=this.getInputRequestEditorRef())||void 0===e?void 0:e.current;null==t||t.focus()},insertCell(e,r,n){const i=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(i,f.EJ.MANIPULATE_CELLS))return;const s=t.insertCell(e,r,n);s&&this._focusAddedCell(s.id)},insertCellByType(e,r,i){var a;const c=K.l.createFocusedNotebookSelector()(o.getState()),l=Q.H.selectCurrentUserAccessType(o.getState()),d=Q.H.selectFocusedItem(o.getState());if(!c||!(0,Y.q)(l,f.EJ.MANIPULATE_CELLS,d))return;if("sql"===e&&(null==i||!i.integration))return void(0,s.D)(new Error("Attempting to insert an sql cell but integration was not provided."),"error",{cellType:e,where:r});const p=o.getState().project.published_at,h=t.insertCellByType(e,r,ie(ie({},null!=i?i:{}),{},{appCoordinates:p&&"article"===c.metadata.deepnote_app_layout?(0,oe.Z8)(e,null):null}));if(h){if(n.track("Block created",{parent:null==i?void 0:i.parent,type:e,location:r,projectId:null==i?void 0:i.projectId,button:null==i?void 0:i.button,accessType:l,integrationType:"sql"===e?null==i||null===(a=i.integration)||void 0===a?void 0:a.type:void 0}),"visualization"===h.type&&null!=i&&i.cellId){const e=t.getCellDataFrameVariableName(i.cellId);e&&(0,re.KJ)(e,u,h.id)}return this._focusAddedCell(h.id),h.id}},_focusAddedCell(e){u.focusCell(e,{align:"in-view"})},convertFocusedCell(e){const r=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(r,f.EJ.MANIPULATE_CELLS)&&t.convertFocusedCell(e,{workspaceId:l()})},getCellSqlIntegrationId:e=>t.getCellSqlIntegrationId(e),async changeSqlCellIntegration(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(n,f.EJ.MANIPULATE_CELLS)&&await t.changeSqlCellIntegration(e,r)},async execute({selectBelow:i,cellId:c,skipSqlCache:l}={}){var h,g;if(o.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:this.getLinkToCurrentLocation()});const m=null!==(h=null===(g=r.current)||void 0===g?void 0:g.getFocusedNotebookDoc())&&void 0!==h?h:null,y=Q.H.selectCurrentUserAccessType(o.getState());if(!m||!(0,a.C5)(y,f.EJ.EXECUTE_CELL))return;if(!c){var v;const e=null===(v=this.getInputRequestEditorRef())||void 0===v?void 0:v.current;if(null!=e&&e.isFocused())return void e.insert("\n")}const b=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(b))throw new Error("Execute works only on notebook files");const E=b.id;if(!E)return(0,s.D)(new Error("Trying to execute a cell, but there is not focused file"),"fatal"),void p.Z.error({message:"You need to focus a file in order to execute"});const C=null!=c?c:t.getFocusedCellId();if(!C)return;if(!u.cellCanExecute(C))return;const w=t.getBlockById(C);if(w){if((0,q.jk)(w.type)){if("sql"===w.type){const e=t.getCellSqlIntegrationId(w.id);if(!e)return void p.Z.info({message:"Select a database for this SQL block."});{const t=o.getState().integrationsState.integrations.find((t=>t.id===e));if(!t||!(0,z.L3)(t.state))return void p.Z.info({message:"Assign the SQL block to a connected integration."})}}"input-select"===w.type&&t.ensureSelectInputValidValue(w.id),await(0,S.EM)((e=>m.whenNothingPending(e)));try{var T;const i=(0,J.HD)(w),s=null===(T=r.current)||void 0===T?void 0:T.getControlChannelApi(),c=await(null==s?void 0:s.executeCodeCell(i,E,l)),u=o.getState().project,d=ie({type:w.type,projectId:u.id,accessType:y,workspaceId:u.team_id},(e=>{const{cellId:r,cellType:n}=e;if("sql"===n){const e=t.getCellSqlIntegrationId(r),n=o.getState().integrationsState.integrations.find((t=>t.id===e));return{integrationType:null==n?void 0:n.type,integrationId:e}}return{}})({cellId:w.id,cellType:w.type}));if(n.track("Block executed",d),"InvalidFederatedOAuthCredentials"===(null==c?void 0:c.error)){const r=t.getCellSqlIntegrationId(w.id),n=(0,a.Xi)(o.getState().integrationsState.integrations,{integrationId:r});e.modalApi.openModal({newModal:N.Qi.PROMPT_FEDERATED_AUTH_SIGNIN,federatedAuthMethod:n.federatedAuthMethod,integrationId:n.id,integrationType:n.type,integrationName:n.name})}}catch(e){p.Z.error({message:"Could not execute block, please try again later"}),(0,s.D)(e,"error")}}i?u._focusNextAvailableCell(w.id,!1):"markdown"===w.type&&u.focusCell(w.id)}},async executeRange({startCellId:n,endCellId:i,skipSqlCache:c}={}){var l,h;const g=null!==(l=null===(h=r.current)||void 0===h?void 0:h.getFocusedNotebookDoc())&&void 0!==l?l:null,m=Q.H.selectCurrentUserAccessType(o.getState());if(g&&(0,a.C5)(m,f.EJ.EXECUTE_CELL)){await(0,S.EM)((e=>g.whenNothingPending(e)));try{var y;const l=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(l))throw new Error("executeRange works only on notebook files");const h=l.id;if(!h){const e=new Error("Trying to execute a block, but there is not focused file");return(0,s.D)(e,"fatal"),void p.Z.error({message:"You need to focus a file in order to execute"})}const f=null===(y=r.current)||void 0===y?void 0:y.getControlChannelApi();if(!f){const e=new Error("The controlChannelApi is not available in executeRange");return void(0,s.D)(e,"fatal")}const g=t.getExecutableBlocksInRange(n,i);if(!g){const e=new Error("No executable blocks in range");return(0,s.D)(e,"error"),void p.Z.error({message:"There are no executable blocks to be executed"})}const m=g.map((e=>(0,J.HD)(e))),v=await u.startHardwareAndRun((()=>f.executeCells(h,m,c)));if("InvalidFederatedOAuthCredentials"===(null==v?void 0:v.error)){const t=(0,a.Xi)(o.getState().integrationsState.integrations);e.modalApi.openModal({newModal:N.Qi.PROMPT_FEDERATED_AUTH_SIGNIN,federatedAuthMethod:t.federatedAuthMethod,integrationId:t.id,integrationType:t.type,integrationName:t.name})}}catch(e){p.Z.error({message:"Could not execute blocks, please try again later"}),(0,s.D)(e,"error")}}},_focusNextAvailableCell(e,r){const n=t.getNextAvailableCellId(e,r);if(n)return void u.focusCell(n,{align:"in-view"});const i=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(i,f.EJ.MANIPULATE_CELLS))return;const s=t.getCellType(e);return"markdown"===s||"code"===s||"sql"===s||"text-cell-p"===s?u.insertCellByType(s,"below",{cellId:e}):void 0},up(){const e=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(e,f.EJ.MANIPULATE_CELLS))return;const r=t.up();r&&u.scrollToCell(r,{align:"center"})},down(){const e=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(e,f.EJ.MANIPULATE_CELLS))return;const r=t.down();r&&u.scrollToCell(r,{align:"center"})},moveCell(e,t,r){u.moveCells([e],e,t,r)},moveSelectedCells(e,t,r){const o=u.getSelectedCells();u.moveCells(o,e,t,r)},moveCells(e,r,n,i){const s=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(s,f.EJ.MANIPULATE_CELLS)&&t.moveCells(e,r,n,i)},duplicateCell(e){const r=Q.H.selectCurrentUserAccessType(o.getState());return(0,a.C5)(r,f.EJ.MANIPULATE_CELLS)?t.duplicateCell(e):null},duplicateFocusedCell(){const e=t.getFocusedCellId();e&&t.transact((()=>{const t=u.duplicateCell(e);t&&u.focusCell(t)}))},deleteCell(e){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.MANIPULATE_CELLS))return;u._focusNextAvailableCell(e,!0);K.l.createExecutionQueueSelector()(o.getState()).find((t=>t.cellId===e))&&u.interrupt(),t.deleteCell(e)},deleteFocusedCell(){const e=t.getFocusedCellId();e&&u.deleteCell(e)},deleteSelectedCells(){o.getState().layout.selectedCells.forEach((e=>{u.deleteCell(e)}))},getFocusedNotebookId(){const e=Q.H.selectFocusedItem(o.getState());return(0,d.hE)(e)?e.id:null},getFocusedCellOutputs:()=>t.getFocusedCellOutputs(),isFocusedCellOutputsEmpty(){const e=this.getFocusedCellOutputs();return(0,oe.BO)(e)},isFocusedCellEmbeddable(){const e=t.getFocusedCellType();return Boolean(e&&(0,V.pk)(e))},isFocusedCellSplitable:()=>"code"===t.getFocusedCellType(),async interrupt(){var e,t,n,i;const c=null!==(e=null===(t=r.current)||void 0===t?void 0:t.getFocusedNotebookDoc())&&void 0!==e?e:null,l=Q.H.selectCurrentUserAccessType(o.getState());if(!c||!(0,a.C5)(l,f.EJ.EXECUTE_CELL))return;if(!u.canExecute(!1)||!(0,C.Rx)(c))return p.Z.closeAll(),void p.Z.info({message:"Machine is starting - please wait."});const h=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(h))throw new Error("interrupt works only on notebook files");const g=h.id;if(!g)return(0,s.D)(new Error("Trying to execute a cell, but there is not focused file"),"fatal"),void p.Z.error({message:"You need to focus a file in order to execute"});await(null===(n=r.current)||void 0===n||null===(i=n.getControlChannelApi())||void 0===i?void 0:i.interruptExecution(g))},async exportDataframe(e){var n,i,c,l;const h=Q.H.selectCurrentUserAccessType(o.getState()),g=null!==(n=null===(i=r.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==n?n:null;if(!g||!(0,a.C5)(h,f.EJ.EXECUTE_CELL))return;if(!u.canExecute(!1)||!(0,C.Rx)(g))return p.Z.closeAll(),void p.Z.info({message:"Machine is starting - please wait."});const m=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(m))throw new Error("Export works only in notebook files");const y=m.id;if(!y)return(0,s.D)(new Error("Trying to export data, but there is not focused file"),"fatal"),void p.Z.error({message:"You need to focus a file in order to export"});const v=t.getBlockById(e),b=v?(0,J.HD)(v):null;return b?null===(c=r.current)||void 0===c||null===(l=c.getControlChannelApi())||void 0===l?void 0:l.exportDataframe(y,b):void 0},scrollToCell(...t){e.commonApi.scrollToCell(...t)},async clearCellOutput(e){const r=Q.H.selectCurrentUserAccessType(o.getState());if((0,a.C5)(r,f.EJ.MANIPULATE_CELLS))switch(e){case"focused-cell":{const e=t.getFocusedCellId();if(!e)return;return this.clearCellOutputsById([e])}case"all-cells":{const e=t.getAllBlockIds();if(!e)return;return this.clearCellOutputsById(e)}default:(0,a.vE)(e)}},async clearCellOutputsById(e){var n,i,s,c;const l=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(l,f.EJ.MANIPULATE_CELLS))return;const u=this.getFocusedNotebookId();if(!u)return;const d=(null!==(n=null===(i=t.getBlocksByIds(e))||void 0===i?void 0:i.filter((({block:e})=>(0,V.Uo)(e)&&!e.state.output_cleared)))&&void 0!==n?n:[]).map((({block:e})=>e.id));0!==d.length&&await(null===(s=r.current)||void 0===s||null===(c=s.getControlChannelApi())||void 0===c?void 0:c.clearNotebookCellOutputs(u,d))},setCellSharingStatus(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(n,f.EJ.MANIPULATE_CELLS)&&(t.setCellSharingStatus(e,r),async function(e,t){const r=o.getState().project.id;await fetch(`/api/project/${r}/trackCellShareStatus/${e}`,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify({cellId:e,toggle:!1!==t})})}(e,r))},shareFocusedCell(){const r=t.getFocusedCellId();r&&e.modalApi.openModal({newModal:N.Qi.CELL_EMBED_MODAL,cellId:r})},toggleHeadingCollapse(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(n,f.EJ.MANIPULATE_CELLS)&&t.toggleHeadingCollapse(e,r,{workspaceId:l()})},toggleCellVisibility(e,r={}){const n=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(n,f.EJ.MANIPULATE_CELLS)&&t.toggleCellVisibility(e,r)},addCellToApp(e){t.addCellToApp(e),n.track("App block added",{blockId:e,type:t.getCellType(e)})},updateCellAppCoordinates(e,r){t.updateCellAppCoordinates(e,r)},removeCellFromApp(e){t.removeCellFromApp(e),n.track("App block deleted")},toggleCellCodeInApp(e,r){t.toggleCellCodeInApp(e,r),r?n.track("App block code hidden"):n.track("App block code shown")},toggleCellOutputInApp(e,r){t.toggleCellOutputInApp(e,r),r?n.track("App block output hidden"):n.track("App block output shown")},setBlockDropdownPosition(e){i({type:"SET_BLOCK_ADDING_DROPDOWN_POSITION",position:e})},openCellBlockDropdownAtFocusedCell(e){const r=t.getFocusedCellId(),n="above"===e?r:r&&t.getNextAvailableCellId(r,!1);if(!n)return;const i=o.getState().layout.openedBlockDropdownPosition;(i&&"block-dropdown"===i.type&&i.cellId===n?null:n)&&this.setBlockDropdownPosition({type:"block-dropdown",cellId:n})},createArticleFromEmptyState(){t.createArticleFromEmptyState(),n.track("App layout set",{to:"article"})},createDashboardFromEmptyState(){t.createDashboardFromEmptyState(),n.track("App layout set",{to:"dashboard"})},setAppLayout(e){var i,a;const s=null!==(i=null===(a=r.current)||void 0===a?void 0:a.getFocusedNotebookDoc())&&void 0!==i?i:null,l=K.l.createFocusedNotebookSelector()(o.getState());if(!s||!l)return;const u=l.metadata.deepnote_app_layout,d=[e?{p:["metadata","deepnote_app_layout"],oi:e}:{p:["metadata","deepnote_app_layout"],od:l.metadata.deepnote_app_layout}];s.submitOp(d,{source:!0},(e=>e&&c(e))),e||t.clearAllAppCoordinates(),n.track("App layout changed",{from:u,to:e})},getInputRequestEditorRef(){var e;return null===(e=r.current)||void 0===e?void 0:e.inputRequestEditorRef},getEditorRef(e){return"input-request"===e?this.getInputRequestEditorRef():"file-editor"===e?null===(t=r.current)||void 0===t?void 0:t.fileEditorRef:void 0;var t},async addToRequirements(t){t.length>0&&await e.fileApi.appendTextToFile("/requirements.txt",t.join("\n")+"\n")},async addToDockerfile(t){t.length>0&&await e.fileApi.appendTextToFile("/Dockerfile","\n"+t.join("\n"))},getLinkToCell(){const e=this.getLinkToCurrentLocation(),t=new URL(e);(0,W.n)(t.href),p.Z.success({message:"Link successfully copied."})},getLinkToFile(e){const t=o.getState(),{fullUrlWithFile:r}=(0,U.g)({project:t.project,filePath:e});return r},async editVisualizationCellSpec(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(n,f.EJ.MANIPULATE_CELLS)&&await t.editVisualizationCellSpec(e,r)},async editCellTableMetadata(e,t,n){var i;const s=Q.H.selectCurrentUserAccessType(o.getState()),c=o.getState().user.is_anonymous,l=null===(i=r.current)||void 0===i?void 0:i.getControlChannelApi();(0,a.C5)(s,f.EJ.EXECUTE_CELL)&&!c&&l&&await l.updateCellTable(e,t,n)},editCellVariableName(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState()),i=Q.H.selectFocusedItem(o.getState());(0,Y.q)(n,f.EJ.MANIPULATE_CELLS,i)&&t.editCellVariableName(e,r)},editInputCellValue(e,r){const n=Q.H.selectCurrentUserAccessType(o.getState()),i=o.getState().user.is_anonymous;(0,a.C5)(n,f.EJ.EDIT_INPUT_CELL_VALUE)&&!i&&t.editInputCellValue(e,r)},editInputCellSelectMetadata(e,r,n,i,s){const c=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(c,f.EJ.MANIPULATE_CELLS)&&t.editInputCellSelectMetadata(e,r,n,i,s)},editSliderCellMetadata(e,r,n,i){const s=Q.H.selectCurrentUserAccessType(o.getState());(0,a.C5)(s,f.EJ.MANIPULATE_CELLS)&&t.editSliderCellMetadata(e,r,n,i)},setFocusedCellColor(e){const r=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(r,f.EJ.MANIPULATE_CELLS))return;const n=t.getFocusedCellId();n&&t.setCellColor(n,e)},getLinkToCurrentLocation(){const e=o.getState().project,r=t.getFocusedCellId(),n=Q.H.selectFocusedItem(o.getState()),{fullUrlWithFile:i}=(0,d.mt)(n)?(0,U.g)({project:e,urlHash:r,notebookInDB:{id:n.id,name:n.name}}):(0,U.g)({project:e,filePath:"file"===(null==n?void 0:n.type)||"preview"===(null==n?void 0:n.type)?null==n?void 0:n.relativePath:void 0,urlHash:r});return i},async executeAndCreateCodeCellBelow(){const e=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(e,f.EJ.MANIPULATE_CELLS))return;const r=t.getFocusedCellId();return r?(u.insertCellByType("code","below",{cellId:r}),u.startHardwareAndRun((()=>{u.execute({selectBelow:!1,cellId:r})}),!0)):void 0},async sendCommMsg(e,t,n,i,a,s=!1,c=!0,l){var u;const p=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(p)||(0,d.rN)(p)&&!(0,d.G5)(p.relativePath))throw new Error("Can only send comm message in a notebook");if("request_state"===i.method){var h;if(await(null===(h=r.current)||void 0===h?void 0:h.widgetManager.handleStateRequest(e,t,n)))return Promise.resolve()}const f=null===(u=r.current)||void 0===u?void 0:u.getControlChannelApi();return null==f?void 0:f.commMsg(p.id,t,n,i,l,a,s,c)},registerIpyWidgetIframe(e,t){var o;null===(o=r.current)||void 0===o||o.widgetManager.setIframeMessenger(e,t)},unregisterIpyWidgetIframe(e){var t;null===(t=r.current)||void 0===t||t.widgetManager.removeIframeMessenger(e)},async updateCellLayoutMetadata(e,t){if(!r.current)return;const o=r.current.getControlChannelApi();await o.updateCellLayoutMetadata(e,t)},async requestCommInfo(){if(!r.current)return;const e=Q.H.selectFocusedItem(o.getState());if(!(0,d.hE)(e)||(0,d.rN)(e)&&!(0,d.G5)(e.relativePath))throw new Error("Can only request comm info for a notebook");const t=K.l.createKernelStatusSelector()(o.getState());let n=r.current.widgetManager.getCachedCommInfo();if("idle"===t){const t=r.current.getControlChannelApi(),o=await t.requestCommInfo(e.id);"ok"===(null==o?void 0:o.content.status)?n=ie(ie({},n),o.content.comms):(0,s.D)(new Error("Failed to request info about available comms"),"error",{reply:o})}return n},async updateIPyWidgetState(e,t){var o;return null===(o=r.current)||void 0===o||o.widgetManager.updateWidgetState(e,t),Promise.resolve()},setIsDraggingBlocks(e){i({type:"SET_IS_DRAGGING_BLOCKS",isDraggingBlocks:e})},beginCellSelection(){u.defocus(),o.dispatch({type:"BEGIN_CELL_SELECTION"})},updateCellSelection(e){u.defocus(),o.dispatch({type:"UPDATE_CELL_SELECTION",selectedCells:[...e]})},finishCellSelection(){o.dispatch({type:"FINISH_CELL_SELECTION"})},getSelectedCells:()=>o.getState().layout.selectedCells,getCollapsedSection(e){const r=Q.H.selectCurrentUserAccessType(o.getState());return(0,a.C5)(r,f.EJ.MANIPULATE_CELLS)?t.getCollapsedSection(e):[]},_isCellLockedByAnotherUser(e,t){const r=this._getCellOwner(e),n=o.getState().user.id,i=null!==r,a=r===n,s=0!==Object.values(t).filter((e=>e.user.id===r)).filter((t=>(0,X.$)(t)===e)).length;return i&&!a&&s},updateOwnershipAfterFocusChange(e,t){this._giveUpOwnershipOfOwnedCells({except:e?[e]:[]}),null!==e&&(this._isCellLockedByAnotherUser(e,t)||this.takeOwnershipOfCell(e))},_getCellOwner:e=>K.l.createOwnerCellIdSelector(e)(o.getState()),takeOwnershipOfCell(e){var n;const i=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(i,f.EJ.MANIPULATE_CELLS))return;const s=null===(n=r.current)||void 0===n?void 0:n.collabDoc;if(!s)return;const l=t.getBlockById(e);if(!l||!(0,oe.fT)(l))return;const u={p:["cellOwnership",e],oi:{owner_user_id:o.getState().user.id}};s.submitOp([u],{source:!0},(e=>e&&c(e)))},_giveUpOwnershipOfOwnedCells(e){var n;const i=null===(n=r.current)||void 0===n?void 0:n.collabDoc;if(!i)return null;const s=t.getAllBlockIds();if(!s)return null;const l=o.getState().user.id,u=s.map((e=>this._getCellOwner(e)===l?e:null)).filter(a.Dw).filter((t=>!e.except.includes(t))).map((e=>({p:["cellOwnership",e],oi:{}})));i.submitOp(u,{source:!0},(e=>e&&c(e)))},takeoverFocusedCell(){const e=t.getFocusedCellId();e&&this.takeOwnershipOfCell(e)},setIntentToEditCell(e){i({type:"SET_INTENT_TO_EDIT_CELL",cellId:e})},async restoreSession(){const e=Q.H.selectCurrentUserAccessType(o.getState());if(!(0,a.C5)(e,f.EJ.EXECUTE_CELL))return;const t=this.getFocusedNotebookId();if(t){try{var n;const e=null===(n=r.current)||void 0===n?void 0:n.getControlChannelApi();await u.startHardwareAndRun((()=>null==e?void 0:e.restoreNotebookSession(t)))}catch(e){throw p.Z.error({message:"Failed to restore variables, please contact support."}),e}p.Z.success({message:"Variables from your last session were restored succesfully!"})}},setFullWidth(e){var t,i;const a=null!==(t=null===(i=r.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=K.l.createFocusedNotebookSelector()(o.getState());if(!a||!s)return;const l=[{p:["metadata","deepnote_full_width"],od:s.metadata.deepnote_full_width,oi:e}];a.submitOp(l,{source:!0},(e=>e&&c(e))),n.track("Full width mode switched",{to:e?"on":"off"})},exportChartFilterToCode(e){const r=t.getBlockById(e);if(!r||!(0,V.xV)(r))return;const o=r.metadata.deepnote_chart_filter;if(o)try{var i;const t=null!==(i=r.metadata.deepnote_variable_name)&&void 0!==i?i:"df",a=(0,Z.TJ)(t),s=(0,Z.ug)(t,a,o);u.insertCellByType("code","below",{cellId:e,source:s}),n.track("Chart selection exported",{blockId:e})}catch(e){p.Z.error({message:"Failed to export filtered DataFrame, please contact support."}),(0,s.D)(e)}},isDataframeSqlCellFocused(){const e=t.getFocusedCellId();if(!e)return!1;const r=t.getBlockById(e);return"sql"===(null==r?void 0:r.type)&&r.metadata.sql_integration_id===G.w8}};return u};var ce=r(85110),le=r.n(ce),ue=r(59467),de=r(67014);const pe=500,he=e=>{const{blockTransforms:t,controllerRef:r,notebookApi:o,store:n}=e,i=n.dispatch;let c=[],l=[];const u=le()((()=>{c.length>0&&(i({type:"UPDATE_CELL_OUTPUT_HEIGHT",payload:c}),c=[])}),pe,{maxWait:pe}),d=le()((()=>{l.length>0&&(i({type:"UPDATE_CELL_HEIGHT",payload:l}),l=[])}),pe,{maxWait:pe}),p=le()((e=>{const r=Q.H.selectCurrentUserAccessType(n.getState()),i=t.getAllBlockIds();if(!i||!(0,a.C5)(r,f.EJ.MANIPULATE_CELLS))return;const s=ue.r.selectCurrentLayout(n.getState())[e];if(!s)return;const c={};Object.entries(s.cells).forEach((([e,t])=>{var r;t&&i.includes(e)&&(c[e]=null!==(r=c[e])&&void 0!==r?r:{},c[e].deepnote_cell_height=t)})),Object.entries(s.outputs).forEach((([e,t])=>{var r;t&&i.includes(e)&&(c[e]=null!==(r=c[e])&&void 0!==r?r:{},c[e].deepnote_output_heights=t)})),o.updateCellLayoutMetadata(e,c)}),5e3,{maxWait:5e3}),h={outputMessageHandler(e,t){(0,de.Uh)(t)&&(c.push({notebookId:e,cellId:t.cellId,outputIndex:t.outputIndex,height:t.height}),u(),p(e))},updateCellHeight(e,t){const r=o.getFocusedNotebookId();r?(l.push({notebookId:r,cellId:e,height:t}),d(),p(r)):(0,s.D)(new Error("Cell layout received without focused notebook."),"error")},async fetchOutputsForCell(e){var t;const o=null===(t=r.current)||void 0===t?void 0:t.getControlChannelApi();if(!o)return;const i=await o.fetchOutputs([e]);n.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:i})},async fetchOutputsForCells(e){var t;const o=null===(t=r.current)||void 0===t?void 0:t.getControlChannelApi();if(!o)return;const i=await o.fetchOutputs(e);n.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:i})}};return h};var fe=r(19133),ge=r(8587),me=r(77267),ye=r(79683),ve=r(28007),be=r(62835),Ee=r.n(be),Se=r(42040),Ce=r(89734),we=r.n(Ce),Te=r(26076);const Ie=e=>{const{controllerRef:t,store:r,projectTrack:o}=e,n=r.dispatch,c={async requestAdditionalAccess(e){const t=r.getState().project.id;try{return(await fetch(`/api/project/${t}/request-access`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:e?JSON.stringify({accessType:e}):void 0})).ok?(p.Z.success({message:"Request for additional access has been sent successfully!"}),!0):(p.Z.error({message:"Failed to send a request for additional access. Please, try again."}),!1)}catch{return p.Z.error({message:"Failed to send a request for additional access. Please, try again."}),!1}},getMemoryPodLimit:(e,t,r)=>e+.1*r>=r?r:null,updateProjectInDb:async(e,t)=>fetch(`/api/project/${e.projectId}`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}),async updateLinkSharing(e){const t=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(t,f.EJ.MANAGE_COLLABORATORS))return;const o={sharing_link_on:"none"!==e,link_access_type:"none"!==e?e:f.WP.VIEW},i=r.getState().project.id;try{n(N.Ud(o)),await c.updateProjectInDb({projectId:i},o)}catch(e){p.Z.error({message:"Oops! Looks like we failed to update your sharing link. Mind trying again?"}),(0,s.D)(new Error("There was an error changing link access"),"error",{error:e,newSettings:o})}finally{var l;null===(l=c.refetchProject())||void 0===l||l.catch((e=>(0,s.D)(e,"warning")))}},async leaveProject(){const e=r.getState().project.id,t=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(t,f.EJ.LEAVE_PROJECT))return p.Z.warning({message:"You can not leave project with your current access type."}),!1;return 200===(await fetch(`/api/project/${e}/collaborator-myself`,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"})).status||((0,s.D)(new Error("Error leaving project"),"error"),p.Z.error({message:"Oops! Looks like we failed to remove you from the project. Mind trying again?"}),!1)},async addCollaborators(e,t={}){const o=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(o,f.EJ.MANAGE_COLLABORATORS))return p.Z.warning({message:"You cannot change collaborators with your current access type."}),!1;const n=r.getState().project.collaborationProperties.collaborators.map((e=>e.email)),i=e.filter((e=>!n.includes(e)));if(0===i.length)return p.Z.warning({message:e.length>1?"Collaborators are already invited.":`Collaborator ${e[0]} is already invited.`}),!1;const l=r.getState().project.id;void 0===t.newAccessType&&(t.newAccessType=f.WP.VIEW,(0,s.D)(new Error("Adding collaborator but no access type provided. Defaulting to view"),"warning"));const u={method:"POST",body:{emails:i,userAccessType:t.newAccessType,inviteToWorkspace:t.inviteToWorkspace}},d=await fetch(`/api/project/${l}/collaborators`,{method:u.method,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(u.body)});if(await c.refetchProject(),200!==d.status){let e="";try{e=await d.json()}catch{}return(0,s.D)(new Error("Error adding collaborators"),"error",{errorJson:e}),p.Z.error({message:"There was an error adding collaborators. Refresh the page, and try again."}),!1}return!0},async updateCollaborators(e,t,o={}){const n=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(n,f.EJ.MANAGE_COLLABORATORS))return p.Z.warning({message:"You cannot change collaborators with your current access type."}),!1;const i=r.getState().project.id;if("change-access-type"===e&&void 0===o.newAccessType)return(0,s.D)(new Error("Trying to change access type but no new access type was provided"),"error"),!1;const l={method:"remove"===e?"DELETE":"PATCH",body:{email:t,userAccessType:o.newAccessType}},u=await fetch(`/api/project/${i}/collaborator`,{method:l.method,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l.body)});if(await c.refetchProject(),200!==u.status){let e="";try{e=await u.json()}catch{}return(0,s.D)(new Error("Error changing collaborator"),"error",{errorJson:e}),p.Z.error({message:"Oops! Looks like we failed to update your collaborators. Mind trying again?"}),!1}return!0},closeModal(){r.getState().modalManager.openedModal===N.Qi.FILE_UPLOAD_MODAL&&e.fileApi.removeUploadedItems(),n({type:N.wO.CLOSE_MODAL})},toggleCellCommandsDropdown(){const e=!r.getState().layout.isCellCommandsDropdownOpen;n(e?{type:"SHOW_CELL_COMMANDS_DROPDOWN"}:{type:"HIDE_CELL_COMMANDS_DROPDOWN"})},hideCellCommandsDropdown(){n({type:"HIDE_CELL_COMMANDS_DROPDOWN"})},isTeamHardwareActive(){var e;const t=r.getState().project.owner,o=r.getState().project.teams,n=r.getState().project.hardware;return!(null===(e=o.filter((e=>e.id===t.teamId))[0])||void 0===e||!e.team_hardwares.includes(n))},async setTeamAccessType(e){const t=r.getState().project.id,o=await fetch(`/api/project/${t}/team-access`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamAccessType:e})});if(!o.ok){await p.Z.error({message:"Unable to set team access"});const r=new Error(`[${t}] Setting team access to ${e} failed with ${o.status} ${o.statusText}`);(0,s.D)(r,"error")}n(N.xZ(e))},async renameProject(e){const t=r.getState().project.collaborationProperties.currentUserAccessType,o=r.getState().project.isRenamingProject;if(!(0,a.C5)(t,f.EJ.RENAME_PROJECT)||o)return;const i=r.getState().project.id,s=r.getState().project.name;let c=!1;n({type:N.Vm.SET_RENAMING,payload:!0}),n(N.eu(e));try{200===(await fetch(`/api/project/${i}`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e})})).status&&(c=!0)}finally{c||n(N.eu(s)),n({type:N.Vm.SET_RENAMING,payload:!1})}},async getFilePath(e){var r;const o=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi();return null==o?void 0:o.getPathById(e)},async restartKernel(e){var o;if(!t.current)return;const n=null!=e?e:null===(o=t.current.getFocusedNotebookDoc())||void 0===o?void 0:o.id;if(!n)return;const i=t.current.getControlChannelApi(),s=r.getState().project.collaborationProperties.currentUserAccessType;return(0,a.C5)(s,f.EJ.MANAGE_HARDWARE_LIFECYCLE)?null==i?void 0:i.restartKernel(n):void 0},async refetchProject(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==r?void 0:r.refetchProject()},turnOnNotifications(){we().requestPermission((()=>{(0,Te.p)("areNotificationsEnabled","true"),n({type:"TURN_ON_NOTIFICATIONS"});new(we())("Notifications are enabled 🎉").show()}))},async selectHardware(e){var o;const i=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi(),s=r.getState().project.collaborationProperties.currentUserAccessType;if((0,a.C5)(s,f.EJ.MANAGE_HARDWARE))try{n(N.P4(e));try{await(null==i?void 0:i.setHardware(e))||n(N.P4(void 0))}finally{n(N.P4(void 0))}n(N.TW(e))}catch(e){p.Z.error({message:"There was an error during machine selection."})}},async startHardware(){var o;const n=r.getState().user.is_anonymous;if(r.getState().filesystem.isUnavailable)return p.Z.error({message:"Machine is temporarily not available because of issue on storage service. Please try again later."}),!1;if(n)return e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code"}),!1;r.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:"submitted"});const i=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(i,f.EJ.MANAGE_HARDWARE_LIFECYCLE))return!1;const s=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi(),c=await(null==s?void 0:s.startHardware().catch((()=>(p.Z.warning({message:"Unable to start the machine. Try again, or contact support."}),!1))));return c||r.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:"not-exist"}),!!c},async restartProject(){if(r.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});if(!t.current)return;const o=t.current.getControlChannelApi(),n=r.getState().project.collaborationProperties.currentUserAccessType;return(0,a.C5)(n,f.EJ.MANAGE_HARDWARE_LIFECYCLE)?(r.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!1}),o.restartProject().catch((()=>p.Z.warning({message:"Sorry, we could not restart your project."})))):void 0},async restartHardware(){if(!t.current)return;const e=t.current.getControlChannelApi(),o=r.getState().project.collaborationProperties.currentUserAccessType;return(0,a.C5)(o,f.EJ.MANAGE_HARDWARE_LIFECYCLE)?e.restartHardware().catch((()=>p.Z.warning({message:"Unable to restart the machine. Try again, or contact support."}))):void 0},async stopHardware(){if(r.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});if(!t.current)return;const o=t.current.getControlChannelApi(),n=r.getState().project.collaborationProperties.currentUserAccessType;return(0,a.C5)(n,f.EJ.MANAGE_HARDWARE_LIFECYCLE)?null==o?void 0:o.stopHardware().catch((()=>{p.Z.warning({message:"Unable to stop the machine. Try again, or contact support."})})):void 0},async restoreProjectVersion(o){const n=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(n,f.EJ.RESTORE_SNAPSHOTS))return p.Z.warning({message:"Sorry, you can not restore project to a previous version."}),!1;if(!t.current)return;const i=t.current.getControlChannelApi();await i.restoreProjectVersion(o).catch((()=>p.Z.warning({message:"Sorry, we could not restore project to selected version"}))),e.projectFocusApi.refocusActiveNotebook()},getCurrentDoc(){var e;return null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc()},getCurrentUndoStack(){var e;return null===(e=t.current)||void 0===e?void 0:e.getFocusedFileUndoStack()},getWorkspaceId:()=>r.getState().project.team_id,isItemDockerfile:e=>(0,d.rN)(e)&&e.relativePath===fe.oH,submitDockerBuild(){var e;const i=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),a=r.getState().project.focusedItem,l=r.getState().project.id;(0,S.Hz)(i)&&(0,d.hE)(a)&&c.isItemDockerfile(a)&&(o.track("Environment docker built",{projectId:l}),n(N.jt({status:"WORKING"})),fetch(`/api/cloudbuild/?projectId=${l}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({dockerFileData:i.data})}).then((e=>{if(!e.ok){if(400===e.status)return void n(N.jt({status:"INVALID_DOCKERFILE"}));if(403===e.status)return void n(N.jt({status:"FORBIDDEN"}));throw new Error(`Submit custom docker build failed with status ${e.status} ${e.statusText}`)}return n(N.jt({status:"WORKING"})),c.refetchProject()})).catch((e=>((0,s.D)(e,"error"),n(N.jt({status:"FAILURE"})),p.Z.error({message:"Error building image"})))))},cancelDockerBuild(){var e;const o=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),i=r.getState().project.focusedItem;(0,S.Hz)(o)&&o.data&&(0,d.hE)(i)&&c.isItemDockerfile(i)&&fetch(`/api/cloudbuild/${(0,ge.P)(o.data)}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)return Promise.reject(new Error(`Interrupting build failed  ${e.status} ${e.statusText}`))})).catch((e=>((0,s.D)(e,"error"),n(N.jt({status:"FAILURE"})),p.Z.error({message:"Failed to cancel the Docker build"}))))},async fetchDockerBuildStatus(){var e;const o=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),i=r.getState().project.focusedItem;if(!(0,S.Hz)(o)||!o.data)return;if(!(0,d.hE)(i)||!c.isItemDockerfile(i))return;const a=await fetch(`/api/cloudbuild/${(0,ge.P)(o.data)}/latest-build`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(a.ok){const e=await a.json();n(N.jt({status:e.status,outputs:e.outputs,image:e.image,timestamp:e.timestamp}))}else 404===a.status&&n(N.jt({status:"NOT_FOUND",outputs:"",image:""}))},async fetchCurrentImage(){const e=r.getState().config.collaborationServiceUrl,t=r.getState().project.collaborationProperties.currentUserAccessType,o=r.getState().project.id;if((0,a.C5)(t,f.EJ.PROJECT_INFO))if((0,me.hE)("development"))r.dispatch(N.OP("deepnote/python:3.7"));else try{const t=await fetch(`${e}/project/${o}/image`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(t.ok){const{image:e}=await t.json();r.dispatch(N.OP(e))}else(0,ve.n_)({message:"Failed to fetch Docker image"})}catch(e){(0,s.D)(e,"fatal")}},async getGithubAppStatus(e){const t=(0,ye.o8)(e);if(!t)return void p.Z.error({message:"We could not parse the url. Are you sure it is a well-formed GitHub url?"});const r=await fetch(`/api/github-apps/${t.owner}/${t.repository}/status`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}});return r.ok?await r.json():((0,s.D)(new Error(`Failed to get GitHub apps integration status for repo ${e}`),"warning"),p.Z.error({message:"We could not connect to the GitHub repo. Could you try again?"}))},async linkGitRepo(t,i){const l=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(l,f.EJ.MANIPULATE_FILES))return;const u=("github"===i?ye.o8:ye.Wn)(t);if(!u)return p.Z.error({message:`We could not parse the url. Are you sure it is a well-formed ${i} url?`});const d=r.getState().project.id,h=new URLSearchParams({projectId:d,repoUrl:t});let g;if(await new Promise(((e,t)=>{const r=setTimeout((()=>{window.deepnote.sendToken=void 0,t(new Error("Failed to get access to the repo within 1 minute."))}),6e4),o=window.open(`/auth/githubAppRepo?${h}`);if(!o){const e=new Error(`Unable to authenticate when adding a ${i} repo. \`popUp\` is undefined`);throw(0,s.D)(e,"error"),e}window.deepnote.sendToken=t=>{g=t,e()},o.onload=()=>{o.location.host===window.location.host&&(clearTimeout(r),e())}})),window.deepnote.sendToken=void 0,!g)return p.Z.error({message:"We could not setup access to the repository. Do you have access to it?"});const m=await fetch("/api/github-apps/connect-repo",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({owner:u.owner,repo:u.repository,projectId:d,accessToken:g})});if(!m.ok){let e="Failed to connect the GitHub repository.";try{const t=await m.json();null!=t&&t.error&&(e+=` ${t.error}`)}catch(e){}return(0,s.D)(new Error(e),"error"),p.Z.error({message:e})}return n(N.Ud({linkedRepo:{owner:u.owner,repo:u.repository}})),o.track("GitHub repo cloned",{provider:"github",projectId:d,repository:u.repository,repoUrl:t}),Promise.all([c.refetchProject(),e.fileApi.cloneGitRepo(t,"/",g,i)])},async unlinkGitRepo(e,t){const i=r.getState().project.id,a=r.getState().config.collaborationServiceUrl;if(!(await fetch(`${a}/project/${i}/gitkey`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return void p.Z.error({message:"Failed to disconnect integration. Please, try again."});if((await fetch(`/api/github-apps/${i}/${e}/${t}`,{method:"DELETE"})).ok)return o.track("GitHub repo unlinked",{provider:"github",projectId:i,repository:t}),n(N.Ud({linkedRepo:void 0})),c.refetchProject();p.Z.error({message:"Failed to disconnect Github repository. Please, try again."})},async fetchSessionStart(){const e=r.getState().project.id;return fetch(`/api/usage/project/${e}/start`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((async t=>{if(!t.ok){const r=await t.text();return void(0,s.D)(new Error(`Error retrieving start of session for project ${e}, ${r}`),"error")}const{lastSessionStart:r}=await t.json();return r}))},async fetchInactivityGracePeriod(){const e=r.getState().project.id,t=await fetch(`/api/project/${e}/fetch-inactivity-grace-period`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){const r=await t.text();return(0,s.D)(new Error(`[${e}]/fetch-inactivity-grace-period failed with ${t.statusText}`),"error",{responseText:r}),i.B.duration(15,"m")}const{inactivityGracePeriodSeconds:o}=await t.json();return i.B.duration(o,"s")},async setInactivityGracePeriod(e){const t=r.getState().project.id;o.track("Inactivity period changed",{projectId:t,inactivityPeriodMinutes:e/60});const n=await fetch(`/api/project/${t}/set-inactivity-grace-period`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({inactivityGracePeriod:e})});if(!n.ok){p.Z.error({message:"Looks like we failed to set the inactivity grace period. Please, try again."});const e=await n.text();(0,s.D)(new Error(`[${t}]/set-inactivity-grace-period failed with ${n.statusText}`),"error",{responseText:e})}},async stopHardwareById(e){const t=await fetch(`/api/project/${e}/stop-hardware`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw p.Z.error({message:"Unable to stop the machine. Try again, or contact support."}),(0,s.D)(new Error(`[${e}]/stop-hardware failed with ${t.statusText}`),"error"),new Error(`[${e}] API /stop-hardware failed with ${t.statusText}`)},async _getRunningProjects(){const e=r.getState().user.id,t=`/api/billing/runningHardware/${Q.H.selectWorkspaceId(r.getState())}`,o=await fetch(t,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});return o.ok?await o.json():((0,s.D)(new Error(`[${e}]/runningHardware failed with ${o.statusText}`),"error"),[])},matchUser(e,t){var o,n;const i=r.getState().project.collaborationProperties.collaborators.filter((e=>e.name)),a=i.map((e=>e.email)),s=null!==(o=null===(n=t.current)||void 0===n?void 0:n.filter((e=>!a.includes(e.email))))&&void 0!==o?o:[],c=Ee()([...i,...s],(e=>e.email));return(0,Se.Lu)(c,e,{keys:["email","name"],threshold:Se.Lu.rankings.ACRONYM}).map((e=>({key:e.email,collaborator:e})))},canUser(e){const t=r.getState().project.collaborationProperties.currentUserAccessType,o=r.getState().project.focusedItem;return(0,Y.u)(e)?(0,Y.q)(t,e,o):(0,a.C5)(t,e)},isConnected:()=>r.getState().connection.isConnected,async fetchTunnelingState(){const e=r.getState().project.id,t=await fetch(`/api/tunnel/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){const r=await t.text();throw(0,s.D)(new Error(`[${e}] GET /api/tunnel failed with ${t.statusText}`),"error",{responseText:r}),new Error("Failed to fetch tunneling configuration. Please contact support.")}const{enabled:o}=await t.json();return o},async setTunnelingState(e){const t=r.getState().project.id,o=await fetch(`/api/tunnel/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})});if(!o.ok){p.Z.error({message:"Looks like we failed to set tunneling configuration. Please, try again."});const e=await o.text();(0,s.D)(new Error(`[${t}] POST /api/tunneling failed with ${o.statusText}`),"error",{responseText:e})}},async fetchCommentNotebookName(e){try{var r;const o=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),n=await(null==o?void 0:o.getNotebookInDb(e));if(n)return n.name;return await c.getFilePath(e)}catch(e){(0,s.D)(e,"warning")}},fetchUser(){fetch("/api/user/me",{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const t=await e.json();r.dispatch({type:"USER_SET",payload:t})})).catch((e=>(0,ve.n_)({message:`Error fetching own user data, error: ${e}`})))},fetchConfig(e){fetch(`/api/project/${e}/config`,{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const t=await e.json();r.dispatch({type:"CONFIG_SET",payload:t})})).catch((t=>(0,ve.n_)({message:`Error fetching config for project ${e}, error: ${t}`})))}};return c};var _e=r(98439);function Ae(e){const{controllerRef:t,store:r}=e,o=r.dispatch,n={getFocusedItemType(){var e;const o=r.getState().project.focusedItem,n=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc();return o?n?(0,d.rs)(o)?"terminal":(0,d.JF)(o)?"preview":(0,a.nZ)(n.data)?"notebook":(0,S.Hz)(n)?"plaintext":"none":"none":null},setActiveItem:async e=>(0,d.rN)(e)?n.setActiveFile(e.relativePath):(0,d.mt)(e)?n.setActiveNotebook(e.id):void 0,switchProjectLayout(e){const t=r.getState().project.collaborationProperties.currentUserAccessType,i=r.getState().project.focusedItem;if(e!==_e.k7.PUBLISHING_EDITOR||(0,a.C5)(t,f.EJ.PUBLISH_NOTEBOOK)){if((0,Te.p)(`selectedProjectLayout-${r.getState().project.id}`,e.toString()),e===_e.k7.CONTENT&&!(0,d.hE)(i)&&"preview"!==(null==i?void 0:i.type)){const e=r.getState().project.previouslyFocusedItems.slice().reverse().find((e=>(0,d.hE)(e)||"preview"===(null==e?void 0:e.type)));var c;if(e&&(0,d.hE)(e))null===(c=n.setActiveItem(e))||void 0===c||c.catch((e=>(0,s.D)(e,"warning")))}o({type:"SWITCH_PROJECT_LAYOUT",layout:e})}},async focusToCollaborator(t,o,i){const s=r.getState().project.previouslyFocusedItems,c=r.getState().project.focusedItem;let l;const u=s.length;u>0&&(l=s[u-1]);const p=r.getState().user,h=r.getState().filesystem.entities;if((0,d.hE)(c)&&l&&(0,d.hE)(l)&&o===p.id&&c.id!==l.id)return n.setActiveItem(l);if(i&&t.id)await n.setActiveNotebook(t.id),await(0,a._v)(900);else{const e=t.path?h[t.path]:void 0;if(!e)return;((0,d.rN)(c)||(0,d.JF)(c)?c.relativePath:void 0)!==t.path&&(await n.setActiveFile(e.relativePath),await(0,a._v)(900))}t.focusedCellId&&e.notebookApi.focusCell(t.focusedCellId,{align:"in-view"})},async setActiveNotebook(o){if(!t.current)return;const n=r.getState().project.focusedItem;(0,d.mt)(n)&&n.id===o||await e.itemFocusApi.setActiveNotebook(o,{addToHistory:!0})},refocusActiveNotebook(){const e=r.getState().project.focusedItem;(0,d.mt)(e)&&(r.dispatch((0,N.Kz)()),r.dispatch((0,N.ki)(e)))},openNotebookInNewTab(e,t){const o=r.getState().project,n=(0,U.g)({project:o,notebookInDB:{id:e,name:t}});window.open(n.fullUrlWithFile)},async setActiveFile(n,i){if(!t.current)return;const a=r.getState().project.focusedItem;if(n!==(a&&((0,d.rN)(a)||(0,d.JF)(a))?a.relativePath:void 0)||i){o({type:N.xg.SET_LOADING_FILE_PATH,loadingFilePath:n}),(0,d.dv)(n)&&o({type:"HIDE_RAW_CSV"}),t.current.editorRefs={};try{await e.itemFocusApi.setActiveFile(n,{openRaw:i})}finally{o({type:N.xg.SET_LOADING_FILE_PATH,loadingFilePath:void 0})}}},isFileFocused(e){const t=r.getState().project.focusedItem;return"file"===(null==t?void 0:t.type)&&t.id===e},async focusFileById(e){var r;const o=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),i=await(null==o?void 0:o.getNotebookInDb(e));if(i)return void await n.setActiveNotebook(i.id);const a=await(null==o?void 0:o.getPathById(e));a?await n.setActiveFile(a,!1):p.Z.error({message:"File must have been deleted."})},focusInitNotebook(){e.layoutApi.switchRightSidebarTab("project");const t=r.getState().filesystem.entities[fe.Fd],o=r.getState().project.init_notebook_id;o?n.setActiveNotebook(o).catch((e=>(0,s.D)(e,"warning"))):t&&(0,_.zE)(t)&&n.setActiveFile(t.relativePath).catch((e=>(0,s.D)(e,"warning")))},focusDockerfile(){const e=r.getState().filesystem.entities[fe.oH];e&&(0,_.zE)(e)&&n.setActiveFile(e.relativePath,!0).catch((e=>(0,s.D)(e,"warning")))}};return n}var ke=r(86008);function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){Pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const je="We failed to create terminal. Likely this is because we failed to load terminals. Try refreshing the page.",Ne=e=>{const{controllerRef:t,store:r,terminalStore:o,projectTrack:n}=e,i=r.dispatch,c={async createTerminal(){var n;if(!e.terminalHandler.isTerminalLoaded())return void p.Z.error({message:"We cannot create a terminal for you, because we failed to load our terminal library. Please try refreshing the page."});const l=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),u=r.getState().project.collaborationProperties.currentUserAccessType,d=r.getState().terminal.isCreatingTerminal,h=(0,a.C5)(u,f.EJ.RUN_TERMINAL),g=e.notebookApi.canExecute(!1);if(!d&&h&&g&&l&&o){i({type:"SET_IS_CREATING_TERMINAL",isCreatingTerminal:!0});try{const{terminalId:t,name:n,createdAt:a}=await(null==l?void 0:l.createNewTerminal()),s=r.getState().terminal.terminals,u=e.terminalHandler.createNewTerminal(l,t);if(!u)throw Error(je);const{terminal:d,listener:p}=u;o[t]={terminal:d,version:0,listenerStore:[p]},i({type:"SET_TERMINAL_NAMES",terminals:De(De({},s),{},{[t]:{name:n,createdAt:a}})}),c.focusTerminal(t)}catch(e){p.Z.error({message:je}),(0,s.D)(e,"warning")}finally{i({type:"SET_IS_CREATING_TERMINAL",isCreatingTerminal:!1})}}},openATerminal(){const e=r.getState().terminal.terminals,t=Object.keys(e),o=t.length>0;n.track("Terminal opened"),o?c.focusTerminal(t[0]):c.createTerminal().catch((e=>(0,s.D)(e,"warning")))},focusTerminal(e){try{const t=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(t,f.EJ.RUN_TERMINAL))return;const o=r.getState().project.id;(0,oe.dG)(o,`${ke.nH}${e}`),window.history.pushState(null,o,`#${ke.nH}${encodeURIComponent(e)}`),i(N.tc(e))}catch(e){(0,s.D)(e,"warning")}},resizeTerminal(e,o){const n=r.getState().connection.hardwareStatus;if((0,C.OJ)(n)&&t.current){const r=t.current.getControlChannelApi();null==r||r.sendTerminalMessage(e,"set_size",o).catch((e=>(0,s.D)(e,"warning")))}},async deleteTerminal(e){var r;const o=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi();await(null==o?void 0:o.deleteTerminal(e))},async renameTerminal(e,r){var o;const n=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi();await(null==n?void 0:n.renameTerminal(e,r))}};return c};var Le=r(85123),Fe=r(82125);const Re=e=>{const{controllerRef:t,store:r}=e,{dispatch:o,getState:n}=r,i=async()=>{const e=n().history.diffView.baseSnapshot,o=n().history.diffView.compareSnapshot;if(e){r.dispatch({type:Fe.fL.INIT_DIFF_LOADING});try{var i;const n=await(null===(i=t.current)||void 0===i?void 0:i.getSnapshotDiff(e.id,null==o?void 0:o.id));r.dispatch({type:Fe.fL.SET_DIFF_ENTRIES,diffEntries:null!=n?n:[]})}catch(e){r.dispatch({type:Fe.fL.SET_DIFF_ERROR})}}},c=async(e=Fe.fL.OVERWRITE_HISTORY_LOGS,t)=>{const o=r.getState(),n=o.project.collaborationProperties.currentUserAccessType;if(!(0,a.C5)(n,f.EJ.MANIPULATE_FILES))return;const i=`/api/project/${o.project.id}/history`,s=null!=t?t:(0,Le.n3)(o.history.filters),c=await fetch(i,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({activeLogTypes:s})}),l=await c.json();r.dispatch({type:e,logs:(0,Le.X8)(l)})},l=e=>{o({type:Fe.fL.SET_SNAPSHOT_DELETED,snapshot:e})};return{addSnapshot:async(e,r,o)=>{var n;await(null===(n=t.current)||void 0===n?void 0:n.addSnapshot(e,r,o))},fetchHistory:c,fetchHistoryAuthors:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.addHistoryAuthors()},fetchSnapshots:async()=>{var e;await(null===(e=t.current)||void 0===e?void 0:e.fetchSnapshots())},filterHistory:(e,t)=>{const{filters:r}=n().history;o({type:Fe.fL.FILTER_HISTORY,filters:e?(0,Le.fF)(r,t):r.filter((e=>e!==t))}),c(Fe.fL.MERGE_OVERWRITE_HISTORY_LOGS).catch((e=>(0,s.D)(e,"warning")))},setRestoringSnapshotId:e=>{o({type:Fe.fL.SET_RESTORING_SNAPSHOT_ID,snapshotId:e})},setBaseSnapshot:e=>{r.dispatch({type:Fe.fL.SET_BASE_SNAPSHOT,snapshot:e}),i()},setCompareSnapshot:e=>{r.dispatch({type:Fe.fL.SET_COMPARE_SNAPSHOT,snapshot:e}),i()},fetchSnapshotsDiff:i,getSnapshotFile:async(e,r)=>{var o;return null===(o=t.current)||void 0===o?void 0:o.getSnapshotFile(e,r)},setDeletingSnapshot:e=>{o({type:Fe.fL.SET_DELETING_SNAPSHOT,snapshot:e})},deleteSnapshot:async e=>{function t(e){p.Z.error({message:e})}const o=r.getState();try{const r=await fetch(`/api/project/${o.project.id}/snapshots/${e.id}`,{method:"DELETE",credentials:"include"});r.ok?l(e):400===r.status?t("Error deleting snapshot: unsupported for this project"):t("Error deleting snapshot")}catch(t){(0,ve.n_)({message:`Error deleting snapshot ${e.id}, error: ${t}`})}},setSnapshotDeleted:l}},Ue=e=>{const{store:t}=e,{dispatch:r,getState:o}=t;return{updateScheduling:async n=>{if(t.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:N.Qi.SIGN_IN_MODAL,title:"Sign up to schedule a notebook"});const i=o().project.id,a=o().scheduling;if(n.schedulingEnabled){const e=await fetch(a.schedulingEnabled?`/scheduling/${i}`:"/scheduling",{method:a.schedulingEnabled?"PATCH":"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:i,notebookId:n.notebookId,crontab:n.crontab,republish:n.republish,emailOnFailed:n.emailOnFailed,emailOnSuccess:n.emailOnSuccess,timezone:n.timezone})});if(!e.ok)return p.Z.error({message:"Failed to update scheduling. Please try again later or contact our support."}),void(0,s.D)(new Error(`[/api/${i}]/scheduling] failed with ${e.statusText}`),"error");p.Z.success({message:"Scheduling settings updated"}),r({type:"UPDATE_SCHEDULING",newSchedulingState:n})}else{const e=await fetch(`/scheduling/${i}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)return p.Z.error({message:"Failed to remove scheduling. Please try again later or contact our support."}),void(0,s.D)(new Error(`DELETE [/api/${i}]/scheduling] failed with ${e.statusText}`),"error");p.Z.success({message:"Scheduling settings updated"}),r({type:"REMOVE_SCHEDULING"})}},fetchScheduling:e=>{fetch(`/scheduling/${e}`,{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const r=await e.json();t.dispatch({type:"UPDATE_SCHEDULING",newSchedulingState:r})})).catch((t=>(0,ve.n_)({message:`Error fetching scheduling config for project ${e}, error: ${t}`})))}}};var xe=r(37044),Me=r(64842),Be=r(17119),He=r(70489),$e=r(39981);function qe(e,t){return(...r)=>t(e(...r))}const We=e=>(0,o.W)({commentsApi:qe(h,m.F),editorApi:qe(w,m.F),environmentApi:qe(T.L,m.F),fileApi:qe(x,m.F),historyApi:qe(Re,m.F),integrationApi:qe(B,m.F),notebookApi:qe(se,m.F),outputsApi:qe(he,m.F),projectApi:qe(Ie,m.F),projectFocusApi:qe(Ae,m.F),schedulingApi:qe(Ue,m.F),terminalApi:qe(Ne,m.F),layoutApi:qe($,m.F),commentsPreferencesApi:qe(g,m.F)},{blockTransforms:e.blockTransforms,blockTransport:e.blockTransport,commonApi:e.commonApi,controllerRef:e.controllerRef,fileSaver:e.fileSaver,integrationFetcher:e.integrationFetcher,notebooksFetcher:e.notebooksFetcher,itemFocusApi:e.itemFocusApi,modalApi:e.modalApi,slateRef:e.slateRef,store:e.store,terminalHandler:e.terminalHandler,terminalStore:e.terminalStore,projectTrack:e.projectTrack,gettingStartedMutator:e.gettingStartedMutator}),{ServiceContext:Ge,useServices:Ze}=(0,Be.A)();function Je(e){const{commonApi:t,modalApi:r,gettingStartedMutator:o}=(0,Me.WG)(),i=(0,xe.qr)(),a=(0,He.tu)(),[s,c]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const{blockTransforms:e,blockTransport:n,controllerRef:s,fileSaver:l,integrationFetcher:u,notebooksFetcher:d,itemFocusApi:p,slateRef:h,terminalHandler:f,terminalStore:g,projectTrack:m}=a;c(We({blockTransforms:e,blockTransport:n,commonApi:t,controllerRef:s,fileSaver:l,integrationFetcher:u,notebooksFetcher:d,itemFocusApi:p,modalApi:r,slateRef:h,store:i,terminalHandler:f,terminalStore:g,projectTrack:m,gettingStartedMutator:o}))}),[t,r,o,i,a]),s?(0,$e.tZ)(Ge.Provider,{value:s,children:e.children}):null}},70489:(e,t,r)=>{"use strict";r.d(t,{jZ:()=>Ft,tu:()=>Lt});var o=r(37496),n=r(26375),i=r(91987),a=r(26056),s=r(66753);function c(e){const{store:t}=e;return{async fetchAndStoreIntegrations(e){try{const r=await fetch(`/api/integration/project/${e}`);if(!r.ok){if(403===r.status)return void s.Z.error({message:"Failed to fetch integrations due to invalid permissions."});throw new Error("Failed fetch integrations request")}const o=await r.json();t.dispatch({type:"INTEGRATION_BATCH_ADD",payload:{integrations:o}})}catch(e){s.Z.error({message:"Failed to fetch integrations."}),(0,a.D)(e,"error")}}}}var l=r(66922);function u(e){const{apolloClient:t}=e;return{async fetchNotebooks(e,r){var o,n,i,a;const s=await t.query({query:l.x3,variables:{id:e},fetchPolicy:null!==(o=null==r?void 0:r.fetchPolicy)&&void 0!==o?o:"network-only"});return"Project"===(null==s||null===(n=s.data)||void 0===n||null===(i=n.projectById)||void 0===i?void 0:i.__typename)&&null!==(a=s.data.projectById.notebooksInDB)&&void 0!==a?a:[]}}}var d=r(9645);function p(e){const{apolloClient:t}=e;return{async refetch(){await t.refetchQueries({include:[d.PU]})}}}var h=r(3766),f=r(28007),g=r(65661);function m(e){const{store:t}=e;return{async fetchProject(e,r){const o=r?`/api/project/${e}?refetch`:`/api/project/${e}`;return fetch(o,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok)throw window.location.reload(),new Error(e.statusText);return e.json()})).then((e=>{var o;r&&(0,h.Zn)(null===(o=e.collaborationProperties)||void 0===o?void 0:o.currentUserAccessType)>(0,h.Zn)(t.getState().project.collaborationProperties.currentUserAccessType)?t.dispatch({type:g.wO.OPEN_MODAL,payload:{newModal:g.Qi.REFRESH_MODAL,title:"You were granted new permissions!",message:"Project owner granted you extra permissions! Please reload the page to continue."}}):t.dispatch((0,g.Ud)(e))})).catch((e=>(0,f.n_)({message:`Error refetching project from ${o}, error: ${e}`})))}}}var y=r(33161),v=r(23074),b=r(96106),E=r(40376);function S(e){const{blockTransactionQueue:t}=e;return{saveCell(e,r,o){const n=(0,b.TK)(o),i={id:(0,y.Z)(),notebookId:e,operations:[{updateBlock:{blockId:r,blockDataUpdate:n}}]};(0,E.fF)("Block API: saveCell",i),t.queueTransaction(i)},saveNewCell(e,r,o,n,i){var a;const s=(0,b.TK)(n),c={id:(0,y.Z)(),notebookId:e,operations:[{insertBlock:{blockId:r,insertAfterBlockId:null!==(a=null==i?void 0:i.id)&&void 0!==a?a:null,blockData:s}}]};(0,E.fF)("Block API: saveNewCell",c),t.queueTransaction(c)},saveDeletedCell(e,r,o,n){const i={id:(0,y.Z)(),notebookId:e,operations:[{deleteBlock:{blockId:r}}]};(0,E.fF)("Block API: saveDeletedCell",i),t.queueTransaction(i)},saveCellMove(e,r,o,n,i){var a;const s={id:(0,y.Z)(),notebookId:e,operations:[{moveBlock:{blockId:r,moveAfterBlockId:null!==(a=null==i?void 0:i.id)&&void 0!==a?a:null}}]};(0,E.fF)("Block API: saveCellMove",s),t.queueTransaction(s)},saveCellFocus(e,t){(0,v.Z2)(e,t)}}}var C=r(64119),w=r(24249),T=r.n(w),I=r(79675),_=r.n(I),A=r(33419),k=r(8550),O=r(85508),D=r.n(O),P=r(17961),j=r(9897);function N(e,t,r){const o=r?(0,b.lM)(r):null,n=(0,j.cP)(e,t);n?o?L(e,n,o):e.apply({type:"remove_node",path:n.path,node:n.block,remote:!0,affectsUserEditableData:!0}):o&&function(e,t){const r=(0,j.iW)(e,t);e.apply({type:"insert_node",path:r,node:t,remote:!0,affectsUserEditableData:!0})}(e,o)}function L(e,t,r){const{block:o,path:n}=t,i=o.type!==r.type,a=o.sorting_key!==r.sorting_key;if(i){e.apply({type:"remove_node",path:n,node:o,remote:!0,affectsUserEditableData:!0});const t=a?(0,j.iW)(e,r):n;e.apply({type:"insert_node",path:t,node:r,remote:!0,affectsUserEditableData:!0})}else{const i=(0,j.ER)(t.block,r);if(i){const t=function(e,t){const r=(0,P.HD)(e),o=(0,P.HD)(t),n=(0,k.St)(r),i=(0,k.St)(o);return!D()(n,i)}(o,r),s=a?(0,j.iW)(e,r):n;e.apply({type:"set_node",path:n,properties:(0,j.qk)(i,o),newProperties:i,remote:!0,affectsUserEditableData:t}),D()(n,s)||e.apply({type:"move_node",path:n,newPath:s,remote:!0,affectsUserEditableData:!0})}}}var F=r(34);const R=C.Ps`
  query FetchChangedBlocks(
    $notebookId: String!
    $sinceVersions: [BlockIdVersionPairInput!]!
    $includeAddedBlocks: Boolean!
  ) {
    notebookById(id: $notebookId) {
      id
      changedBlocksSinceVersions(sinceVersions: $sinceVersions, includeAddedBlocks: $includeAddedBlocks) {
        blockId
        blockVersion
        block {
          ...FullBlockFragment
        }
      }
    }
  }

  ${A.q}
`;function U(e){const t={};let r=!1,o=!1,n=!1,i=null,s=()=>{};const c=async(t,r,o)=>{if(0===o.knownBlockVersions.length&&!o.includeAddedBlocks)return;const n=await e.apolloClient.query({query:R,variables:{notebookId:t,sinceVersions:o.knownBlockVersions,includeAddedBlocks:o.includeAddedBlocks}});T()(n.data,"No data returned from changedBlocksSinceVersions query"),T()(n.data.notebookById,"Notebook not available for changedBlocksSinceVersions query");const i=n.data.notebookById.changedBlocksSinceVersions;F.MO.withoutSaving(r,(()=>{i.forEach((e=>{N(r,e.blockId,e.block)}))}))},l=async e=>{if(await i,r||o||n)return;const s=t[e];if(!s||0===s.blocks.length)return void delete t[e];const{editor:d,blocks:p}=s,f=_()(p.map((({blockId:e,incomingBlockVersion:t})=>{var r;const o=null===(r=(0,j.cP)(d,e))||void 0===r?void 0:r.block.version;return o&&o>=t?null:{id:e,version:null!=o?o:0}})));r=!0;try{var g,m;await c(e,d,{knownBlockVersions:f,includeAddedBlocks:!1}),t[e]={editor:d,blocks:(null!==(g=null===(m=t[e])||void 0===m?void 0:m.blocks)&&void 0!==g?g:[]).filter((e=>!p.includes(e)))}}catch(e){e instanceof Error&&!("networkError"in e)&&(0,a.D)(e,"error"),console.debug("Block Fetch Queue: problem with submission, waiting 5s before retrying.",e),await(0,h._v)(5e3)}finally{r=!1}return o?(o=!1,u(e,d)):l(e)},u=async(e,s)=>{if(await i,r||o||n)return void(o=!0);const d=[...(0,j.am)(s)].map((([e])=>({id:e.id,version:e.version})));n=!0,o=!1;try{var p,f,g;const r=t[e],o=null!==(p=null==r?void 0:r.blocks)&&void 0!==p?p:[];return await c(e,s,{knownBlockVersions:d,includeAddedBlocks:!0}),t[e]={editor:s,blocks:(null!==(f=null===(g=t[e])||void 0===g?void 0:g.blocks)&&void 0!==f?f:[]).filter((e=>!o.includes(e)))},n=!1,await l(e)}catch(t){return n=!1,t instanceof Error&&!("networkError"in t)&&(0,a.D)(t,"error"),console.debug("Block Fetch Queue: problem with submission, waiting 5s before retrying.",t),await(0,h._v)(5e3),await u(e,s)}finally{n=!1}};return{pause(){i=new Promise((e=>{s=e}))},resume(){i=null,s()},fetchBlockUpdate(r,o){var n,i;const{blockId:s,blockVersion:c}=o,u=e.slateRef.current;u&&(c?(t[r]={editor:u,blocks:[...null!==(n=null===(i=t[r])||void 0===i?void 0:i.blocks)&&void 0!==n?n:[],{blockId:s,incomingBlockVersion:c}]},l(r).catch((e=>{(0,a.D)(e,"error",{notebookId:r,blockId:s,incomingBlockVersion:c})}))):N(u,s,null))},catchUpWithBlockUpdates(t){const r=e.slateRef.current;r&&u(t,r).catch((e=>{(0,a.D)(e,"error",{notebookId:t})}))}}}const x=C.Ps`
  mutation SubmitBlockTransactions($transactions: [BlockTransaction!]!) {
    submitBlockTransactions(transactions: $transactions) {
      results {
        id
        status
        blockUpdates {
          blockId
          blockVersion
          block {
            ...BlockAmendFragment
          }
        }
      }
    }
  }

  ${A.k}
`;function M(e){const{apolloClient:t,blockFetchQueue:r,slateRef:o}=e,n=[];let i=!1;const s=async()=>{if(i)return;const e=n.slice();if(0!==e.length){r.pause(),i=!0;try{const r=await t.mutate({mutation:x,variables:{transactions:e}});T()(r.data,"No data returned from submitBlockTransactions mutation"),n.splice(0,e.length);const i=o.current;if(i){const e=r.data.submitBlockTransactions.results;F.MO.withoutSaving(i,(()=>{e.flatMap((e=>e.blockUpdates)).forEach((e=>{!function(e,t,r){const o=(0,j.cP)(e,t);o?r?L(e,o,(0,b.ex)(o.block,r)):e.apply({type:"remove_node",path:o.path,node:o.block,remote:!0,affectsUserEditableData:!0}):r&&console.warn("Block amend failed: block not found",{blockId:t})}(i,e.blockId,e.block)}))}))}}catch(e){e instanceof Error&&!("networkError"in e)&&(0,a.D)(e,"error"),(0,E.fF)("Block Transaction Queue: problem with submission, waiting 5s before retrying.",e),await(0,h._v)(5e3)}finally{i=!1}s().catch((e=>{(0,a.D)(e,"error")}))}else r.resume()};return{queueTransaction(e){n.push(e),s().catch((e=>{(0,a.D)(e,"error")}))}}}var B=r(72790),H=r(26129),$=r(8097);function q(e){const{controllerRef:t,store:r}=e,o=t.current,n={async forceSave(e){if(!o)throw new Error("Controller is not available");try{await(0,$.V)(n.saveFile(e),5e3),s.Z.success({message:"Changes have been saved. FYI, they are also auto-saved every 10 seconds.",duration:2e3})}catch(e){e instanceof B.Lc?s.Z.error({message:"You do not have enough permissions to save content of this file."}):(e instanceof B.r6||e instanceof $.W)&&s.Z.error({message:"File could not be saved. There is a problem with the server connection."})}},async saveFile(e){if(!o)throw new Error("Controller is not available");const t=r.getState().project.collaborationProperties.currentUserAccessType;if(!(0,h.C5)(t,H.EJ.MANIPULATE_FILES))throw new B.Lc("Cannot save file");const n=o.getControlChannelApi();await n.saveItem(e).catch((()=>{throw new B.r6("Cannot save file")}))}};return n}var W=r(11564);function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Z(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J(e){return{track:(t,r={},o={})=>{(0,W.j)(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){Z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({workspaceId:e},r),o)}}}var V=r(5575);function z(e){const{controllerRef:t,store:r}=e,o=(e,t)=>{s.Z.error({message:"The operation could not be performed"}),(0,f.$e)((r=>{r.setFingerprint(["{{default}}",String(e.code)]),(0,a.D)(new Error(`ShareDB error: code ${e.code} - ${e.message}`),"error",{ops:t})}))};return{saveCell(e,n,i){var a,s;const c=null!==(a=null===(s=t.current)||void 0===s?void 0:s.getNotebookDoc(e))&&void 0!==a?a:null,l=V.H.selectCurrentUserAccessType(r.getState()),u=(0,h.C5)(l,H.EJ.MANIPULATE_CELLS),d=(0,h.C5)(l,H.EJ.EDIT_INPUT_CELL_VALUE),p=u||(0,j.FZ)(i)&&d;if(!c||!p)return;const f=[{p:["cells",n],oi:(0,P.HD)(i)}];(0,E.fF)("ShareDB: saveCell -> notebookDoc.submitOp",f),c.submitOp(f,{source:!0},(e=>e&&o(e,f)))},saveNewCell(e,n,i,a){var s,c;const l=null!==(s=null===(c=t.current)||void 0===c?void 0:c.getNotebookDoc(e))&&void 0!==s?s:null,u=V.H.selectCurrentUserAccessType(r.getState());if(!l||!(0,h.C5)(u,H.EJ.MANIPULATE_CELLS))return;const d=[{p:["cells",n],oi:(0,P.HD)(a)},{p:["cellOrder",(0,j.Su)(i)],li:n}];(0,E.fF)("ShareDB: saveNewCell -> notebookDoc.submitOp",d),l.submitOp(d,{source:!0},(e=>e&&o(e,d)))},saveDeletedCell(e,n,i,a){var s,c,l,u;const d=V.H.selectCurrentUserAccessType(r.getState()),p=null!==(s=null===(c=t.current)||void 0===c?void 0:c.getNotebookDoc(e))&&void 0!==s?s:null;if(!p||!(0,h.C5)(d,H.EJ.MANIPULATE_CELLS))return;const f=1===(null!==(l=null===(u=p.data)||void 0===u?void 0:u.cellOrder.filter((e=>e===n)).length)&&void 0!==l?l:1)?{p:["cells",n],od:(0,P.HD)(a)}:null,g={p:["cellOrder",(0,j.Su)(i)],ld:n},m=_()([f,g]);(0,E.fF)("ShareDB: saveDeletedCell -> notebookDoc.submitOp",m),p.submitOp(m,{source:!0},(e=>e&&o(e,m)))},saveCellMove(e,n,i,a){var s,c;const l=V.H.selectCurrentUserAccessType(r.getState()),u=null!==(s=null===(c=t.current)||void 0===c?void 0:c.getNotebookDoc(e))&&void 0!==s?s:null;if(!u||!(0,h.C5)(l,H.EJ.MANIPULATE_CELLS))return;const d=[{p:["cellOrder",(0,j.Su)(i)],lm:(0,j.Su)(a)}];(0,E.fF)("ShareDB: saveCellMove -> notebookDoc.submitOp",d),u.submitOp(d,{source:!0},(e=>e&&o(e,d)))},saveCellFocus(e,t){(0,v.Z2)(e,t)}}}var Y=r(52424),Q=r(55236),K=r(83964),X=r(17555);function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const oe=e=>{const{commonApi:t,slateRef:r,store:o}=e;return{getBlocksByIds(e){const t=r.current;return t?Array.from((0,j.am)(t,{match:t=>e.includes(t.id)})).map(j.Bu):null},getAllBlockIds(){const e=r.current;return e?Array.from((0,j.am)(e,{at:(0,j.Dr)([])})).map(j.Bu).map((({block:e})=>e.id)):null},getExecutableBlocksInRange(e,t){const o=r.current;if(!o)return null;const n=(0,j.am)(o,{match:j.Uo}),i=[];let a=!e;for(const r of n){const o=(0,j.Bu)(r);if(o.block.id===t)break;(a||o.block.id===e)&&(a=!0,i.push(o.block))}return i},getCodeBlocks(e){const t=r.current;if(!t)return null;const o=(0,j.am)(t,{match:t=>!("code"!==t.type||e.excludeShellBlocks&&(0,h.Lw)((0,K.y)(t)))}),n=[];for(const[e]of o)n.push(e);return n},getBlocksByTypes(e){const t=r.current;if(!t)return null;const o=(0,j.am)(t,{match:t=>e.includes(t.type)}),n=[];for(const[e]of o)n.push(e);return n},splitCell(){var e;const t=r.current;if(!t)return null;const o=(0,j.UA)(t);if(!o)return null;const n=o.block,i=(0,j.Su)(o.path);if(!(0,j.J2)(n))return null;const a={id:(0,Y.EL)(),type:"code"},s=null===(e=t.selection)||void 0===e?void 0:e.focus.offset,c=(0,K.y)(n),l=(0,v.KX)(c.slice(0,s),"trailing"),u=(0,v.KX)(c.slice(s),"leading"),d=i+1,p=k._I.code.createNewCell({id:a.id,source:u,existingCellCounts:{}});return this.transact((()=>{Q.YR.insertNodes(t,(0,P.Jt)(a.id,p,{sortingKey:null}),{at:(0,j.Dr)([d])}),Q.YR.setNodes(t,{text:l},{at:(0,K.v)((0,j.Dr)([i])),voids:!0})})),a},async formatCell(e,t){const o=r.current;if(!o)return;const n=e?(0,j.cP)(o,e):(0,j.UA)(o);if(!n||!(0,j.J2)(n.block))return(0,a.D)(new Error("Block source not found")),s.Z.error({message:"Formatting failed"});const i=(0,K.y)(n.block),c=await t(i);if(null===c)return;const l=e?(0,j.cP)(o,e):(0,j.UA)(o);l&&(0,j.J2)(l.block)&&(0,K.y)(l.block)===i&&Q.YR.setNodes(o,{text:c},{at:(0,K.v)(n.path),voids:!0})},getFocusedCellId(){var e;const t=r.current,o=t?(0,j.UA)(t):null;return null!==(e=null==o?void 0:o.block.id)&&void 0!==e?e:null},getFocusedCellType(){var e;const t=r.current,o=t?(0,j.UA)(t):null;return null!==(e=null==o?void 0:o.block.type)&&void 0!==e?e:null},getCellIndex(e){const t=r.current,o=t?(0,j.cP)(t,e):null;return o?(0,j.Su)(o.path):-1},getBlockById(e){var t;const o=r.current,n=o?(0,j.cP)(o,e):null;return null!==(t=null==n?void 0:n.block)&&void 0!==t?t:null},getCellType(e){var t;const o=r.current,n=o?(0,j.cP)(o,e):null;return null!==(t=null==n?void 0:n.block.type)&&void 0!==t?t:null},focusCell(e,t){const o=r.current;if(!o)return{focusChanged:!1};const n=(0,j.cP)(o,e);if(!n)return{focusChanged:!1};const i=n.path,[,a]=Q.ML.first(o,i);return Q.YR.select(o,{path:a,offset:0}),(0,j.$R)(o),{focusChanged:!0}},defocus(){const e=r.current;e&&Q.YR.deselect(e)},doesPositionExist(e){const t=r.current;if(!t)return!1;const o=(0,j.cP)(t,e.cellId),n=o&&(0,j.J2)(o.block)?(0,K.y)(o.block):null,i=n?n.split("\n")[e.line-1]:null;return null!=i&&i.length>=e.offset},insertCellAtPosition(e,t){const o=r.current;if(!o)return null;const n=e.metadata.cell_id;return Q.YR.insertNodes(o,(0,P.Jt)(n,e,{sortingKey:null}),{at:(0,j.Dr)([t])}),{id:n,type:e.cell_type}},insertCell(e,t,o){const n=r.current;if(!n)return null;const i=(0,j.zB)(n);if(!i)return null;const a=(()=>{if("notebook-end"===t)return i.children.length;if("below"===t||"above"===t){const e=null!=o&&o.cellId?(0,j.cP)(n,o.cellId):(0,j.UA)(n);if(!e)return i.children.length;const r=(0,j.Su)(e.path);return"above"===t?r:r+1}(0,h.vE)(t)})();return this.insertCellAtPosition(e,a)},insertCellByType(e,t,o={}){var n,i;const a=r.current;if(!a)return null;const s=(0,j.Sd)(a),c=null!==(n=o.source)&&void 0!==n?n:"",l=o.cellId&&"pandas-dataframe"===(null===(i=o.integration)||void 0===i?void 0:i.type)?this.getCellDataFrameVariableName(o.cellId):null,u=(0,Y.EL)(),d="sql"===e?(0,v.S6)({id:u,integrationId:o.integration.id,source:c,variableName:l,existingCellCounts:s}):k._I[e].createNewCell({id:u,source:c,existingCellCounts:s});return o.appCoordinates&&(d.metadata.deepnote_app_coordinates=o.appCoordinates),this.insertCell(d,t,o)},getCellDataFrameVariableName(e){var t,o;const n=r.current;if(!n)return null;const i=(0,j.cP)(n,e);if(!i)return null;const a=i.block;return"sql"===(null==a?void 0:a.type)?null!==(t=a.metadata.deepnote_variable_name)&&void 0!==t?t:null:"code"===(null==a?void 0:a.type)?(0,v.Vl)(null!==(o=(0,v.sb)((0,K.y)(a).split("\n")))&&void 0!==o?o:""):null},convertFocusedCell(e,t){const o=r.current;if(!o)return;const n=(0,j.UA)(o);if(!n||n.block.type===e)return;(0,W.j)("Block type changed",{from:n.block.type,to:e,workspaceId:t.workspaceId});const i=(0,v.lH)(n.block,e);Q.YR.setNodes(o,i,{at:n.path})},getCellSqlIntegrationId(e){var t;const o=r.current;if(!o)return null;const n=(0,j.cP)(o,e);return n&&"sql"===n.block.type&&null!==(t=n.block.metadata.sql_integration_id)&&void 0!==t?t:null},async changeSqlCellIntegration(e,t){const o=r.current;o&&(0,j.HT)(o,e,{sql_integration_id:t})},getNextAvailableCellId(e,t){const o=r.current;if(!o)return null;const n=(0,j.zB)(o),i=(0,j.cP)(o,e);if(!n||!i)return null;const a=(0,j.Su)(i.path);if(n.children.length!==a+1){const e=n.children[a+1];return e&&(0,j._C)(e)?e.id:null}if(t){const e=n.children[a-1];return e&&(0,j._C)(e)?e.id:null}return null},up(){const e=r.current;if(!e)return null;const t=(0,j.UA)(e),o=t?(0,j.Su)(t.path):-1;if(o<=0)return null;const n=(0,j.nt)(e,o);return n?((0,j.GW)(e,{at:(0,j.Dr)([o]),to:(0,j.Dr)([o-1])}),n.block.id):null},down(){const e=r.current;if(!e)return null;const t=(0,j.zB)(e);if(!t)return null;const o=(0,j.UA)(e),n=o?(0,j.Su)(o.path):-1;if(-1===n||n>=t.children.length-1)return null;const i=(0,j.nt)(e,n);return i?((0,j.GW)(e,{at:(0,j.Dr)([n]),to:(0,j.Dr)([n+1])}),i.block.id):null},moveCells(e,t,o,n){const i=r.current;if(!i)return;const a=this.getCellIndex(t),s=this.getCellIndex(n),c="above"===o?s:s+1+0,l=a<c?c-1:c;(0,j.GW)(i,{match:t=>e.includes(t.id),to:(0,j.Dr)([l])})},duplicateCell(e){const t=r.current;if(!t)return null;const o=(0,j.cP)(t,e);if(!o)return null;const n=(0,j.Su)(o.path)+1,i=(0,j.Qi)(o.block,(0,Y.EL)(),{existingVariableNames:(0,j.gz)(t)});return Q.YR.insertNodes(t,i,{at:(0,j.Dr)([n])}),i.id},deleteCell(e){const t=r.current;if(!t)return;const o=(0,j.cP)(t,e);o&&Q.YR.removeNodes(t,{at:o.path})},getFocusedCellOutputs(){const e=r.current;if(!e)return X.F;const t=(0,j.UA)(e);if(!t)return X.F;const n=(0,j.Uo)(t.block)&&t.block.state.output_cleared,i=o.getState().output[t.block.id];return n||!i||(0,v.BO)(i)?X.F:i},setCellSharingStatus(e,t){const o=r.current;o&&(0,j.HT)(o,e,{allow_embed:t})},toggleHeadingCollapse(e,t,o){const n=r.current;if(!n)return;const i=(0,j.cP)(n,e);i?((0,W.j)("Block collapse changed",{newState:t?"collapsed":"expanded",blockType:i.block.type,workspaceId:o.workspaceId}),(0,j.HT)(n,e,{is_collapsed:t})):(0,a.D)(new Error("Trying to toggle heading cell collapse state, but there is no cell"),"error")},toggleCellVisibility(e,{cellId:t,allCells:o,newSetting:n}={}){const i=r.current;if(!i)return;const s="output"===e?"is_output_hidden":"is_code_hidden",c="output"===e?"deepnote_app_is_output_hidden":"deepnote_app_is_code_hidden";if(o){const t=[...(0,j.am)(i)],r=t.some((([e])=>("is_code_hidden"in e.metadata||"is_output_hidden"in e.metadata)&&Boolean(e.metadata[s]))),o=null!=n?n:!r;return t.forEach((([t])=>{this.toggleCellVisibility(e,{cellId:t.id,newSetting:o})}))}{const e=null!=t?t:this.getFocusedCellId();if(!e)return;const r=(0,j.cP)(i,e);if(!r)return void(0,a.D)(new Error("Trying to toggle cell output visibility, but there is no cell"),"error");if(!(0,j.Uo)(r.block))return void(0,a.D)(new Error("Trying to toggle cell output visibility, but the cell is not executable"),"warning");const o=r.block.metadata[s],l=null!=n?n:!o,u=null==r.block.metadata[c]?{[c]:l}:{};(0,j.HT)(i,e,te({[s]:l},u))}},addCellToApp(e){const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);if(!n)return;const i=t.getCellElement(e),a=(0,v.Z8)(n.block.type,i),s=(0,j.am)(o,{at:(0,j.Dr)([]),match:e=>Boolean(e.metadata.deepnote_app_coordinates)}),c=Math.max(...[...s].map((([e])=>{var t,r,o,n,i;return(null!==(t=null===(r=e.metadata.deepnote_app_coordinates)||void 0===r?void 0:r.y)&&void 0!==t?t:0)+(null!==(o=null===(n=e.metadata)||void 0===n||null===(i=n.deepnote_app_coordinates)||void 0===i?void 0:i.h)&&void 0!==o?o:0)})),0)+1;(0,j.HT)(o,e,(e=>{e.deepnote_app_coordinates=te(te({},a),{},{y:c}),"is_code_hidden"in e&&void 0!==e.is_code_hidden&&(e.deepnote_app_is_code_hidden=e.is_code_hidden),"is_output_hidden"in e&&void 0!==e.is_output_hidden&&(e.deepnote_app_is_output_hidden=e.is_output_hidden)}))},updateCellAppCoordinates(e,t){var o;const n=r.current;if(!n)return;const i=(0,j.cP)(n,e);if(!i)return;const{x:a,y:s,w:c,h:l}=null!==(o=i.block.metadata.deepnote_app_coordinates)&&void 0!==o?o:{};D()({x:a,y:s,w:c,h:l},t)||(0,j.HT)(n,e,{deepnote_app_coordinates:t})},removeCellFromApp(e){const t=r.current;t&&(0,j.HT)(t,e,(e=>{delete e.deepnote_app_coordinates}))},toggleCellCodeInApp(e,t){const o=r.current;o&&(0,j.HT)(o,e,{deepnote_app_is_code_hidden:t})},toggleCellOutputInApp(e,t){const o=r.current;o&&(0,j.HT)(o,e,{deepnote_app_is_output_hidden:t})},createArticleFromEmptyState(){const e=r.current;if(!e)return;const t=(0,j.am)(e);for(const[e]of t)this.addCellToApp(e.id)},createDashboardFromEmptyState(){const e=r.current;if(!e)return;const t=(0,j.am)(e).next().value,{block:o}=(0,j.Bu)(t);o&&this.addCellToApp(o.id)},clearAllAppCoordinates(){const e=r.current;if(!e)return;const t=(0,j.am)(e,{at:(0,j.Dr)([]),match:e=>Boolean(e.metadata.deepnote_app_coordinates)});for(const[r]of t)(0,j.HT)(e,r.id,(e=>{delete e.deepnote_app_coordinates}))},async editVisualizationCellSpec(e,t){const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);n&&("visualization"===n.block.type?(0,j.HT)(o,e,{deepnote_visualization_spec:t}):(0,a.D)(new Error(`Trying to deepnote_visualization_spec property on cell type ${n.block.type}`),"error"))},editCellVariableName(e,t){const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);if(!n)return;const i=n.block.type;"input-date"===i||"input-select"===i||"input-slider"===i||"input-text"===i||"sql"===i||"visualization"===i?(0,j.HT)(o,e,(e=>{t?e.deepnote_variable_name=(0,h.mk)(t):delete e.deepnote_variable_name})):(0,a.D)(new Error(`Trying to change variable name property on cell type ${i}`),"error")},editInputCellValue(e,t){const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);if(!n)return;const i=n.block.type;"input-date"===i||"input-select"===i||"input-slider"===i||"input-text"===i?(0,j.HT)(o,e,{deepnote_variable_value:t}):(0,a.D)(new Error("Trying to change input property on non-input cell type"),"error")},editInputCellSelectMetadata(e,t,o,n,i){var s;const c=r.current;if(!c)return;const l=(0,j.cP)(c,e);if(!l)return;const u=l.block.type;if("input-date"!==u&&"input-select"!==u&&"input-slider"!==u&&"input-text"!==u)return void(0,a.D)(new Error("Trying to change input property on non-input cell type"),"error");const d=null!==(s=t[0])&&void 0!==s?s:"",p=l.block.metadata.deepnote_variable_value,h=t.includes(p)?p:d;(0,j.HT)(c,e,{deepnote_variable_value:h,deepnote_variable_options:t,deepnote_variable_custom_options:o,deepnote_variable_selected_variable:n,deepnote_variable_select_type:i})},editSliderCellMetadata(e,t,o,n){const i=r.current;if(!i)return;const s=(0,j.cP)(i,e);if(!s)return;"input-slider"===s.block.type?(0,j.HT)(i,e,{deepnote_slider_min_value:t,deepnote_slider_max_value:o,deepnote_slider_step:n}):(0,a.D)(new Error("Trying to change slider property on non-slider cell type"),"error")},getCollapsedSection:e=>[],setCellColor(e,t){const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);n&&((0,j.my)(n.block)?(0,j.HT)(o,e,{color:t}):(0,a.D)(new Error("Trying to change color property on non-callout cell"),"error"))},ensureSelectInputValidValue(e){var t;const o=r.current;if(!o)return;const n=(0,j.cP)(o,e);if(!n||"input-select"!==n.block.type)return;const{block:i}=n,a=null!==(t=i.metadata.deepnote_variable_options)&&void 0!==t?t:[],s=i.metadata.deepnote_variable_value;var c;"from-variable"===i.metadata.deepnote_variable_select_type&&Boolean(i.metadata.deepnote_variable_selected_variable)&&!a.includes(s)&&(0,j.HT)(o,e,{deepnote_variable_value:null!==(c=a[0])&&void 0!==c?c:""})},transact(e){const t=r.current;t&&Q.ML.withoutNormalizing(t,e)}}};function ne(){return{}}var ie=r(37044),ae=r(19133),se=r(14562),ce=r(58324);const le=e=>{const t=(0,ce.x1)();t&&"pageload"===t.op&&(e?(t.setStatus("ok"),t.tags["project-initialisation"]="successful"):(t.setStatus("internal_error"),t.tags["project-initialisation"]="failed"),t.finish())};var ue=r(50061),de=r(94327);function pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class he{constructor(){pe(this,"listeners",[]),pe(this,"listenersOncer",[]),pe(this,"on",(e=>(this.listeners.push(e),{dispose:()=>this.off(e)}))),pe(this,"once",(e=>{this.listenersOncer.push(e)})),pe(this,"off",(e=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)})),pe(this,"emit",(e=>{if(this.listeners.forEach((t=>t(e))),this.listenersOncer.length>0){const t=this.listenersOncer;this.listenersOncer=[],t.forEach((t=>t(e)))}})),pe(this,"pipe",(e=>this.on((t=>e.emit(t)))))}}var fe=r(77717),ge=r(16046);const me=ge.z.array(ge.z.object({blocks:ge.z.object({from:ge.z.string(),to:ge.z.string()}),inputVariables:ge.z.array(ge.z.string())}));function ye(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ve{constructor(e){ye(this,"controlChannel",void 0),this.controlChannel=e}async decompressContents(e){return this.controlChannel.request("contents-decompress",{path:e})}async startHardware(){return this.controlChannel.request("start-hardware")}async restartProject(){return this.controlChannel.request("restart-project")}async stopHardware(){return this.controlChannel.request("stop-hardware")}async listSnapshots(){return this.controlChannel.request("snapshots-get-all")}async addSnapshot(e,t,r){return this.controlChannel.request("snapshots-add",{name:e,description:t,userId:r})}async getSnapshotDiff(e,t){return this.controlChannel.request("snapshots-diff",{fromSnapshotId:e,toSnapshotId:t})}async getSnapshotFile(e,t){return this.controlChannel.request("snapshots-load-file",{path:e,snapshotId:t})}async requestVariableDetails(e,t){return this.controlChannel.request("request-variable-details",{notebookId:e,varName:t})}async refetchProject(){return this.controlChannel.request("refetch-project")}async fetchOutputs(e){return this.controlChannel.request("fetch-outputs",{cellIds:e})}async clearNotebookCellOutputs(e,t){return this.controlChannel.request("clear-cell-outputs",{notebookId:e,cellIds:t})}async fetchCellLayoutMetadata(e){return this.controlChannel.request("fetch-cell-layout-metadata",{notebookId:e})}async restartKernel(e){return this.controlChannel.request("restart",{notebookId:e})}async setHardware(e){return this.controlChannel.request("set-hardware",{selection:e})}async restartHardware(){return this.controlChannel.request("restart-hardware")}async createNewItem(e,t){return this.controlChannel.request("contents-new-untitled",{path:e,isNotebook:"notebook"===t,type:"directory"===t?"directory":"file"})}async renameItem(e,t){return this.controlChannel.request("contents-rename",{path:e,newPath:t})}async duplicateItem(e){return this.controlChannel.request("contents-duplicate",{path:e})}async deleteItem(e){return this.controlChannel.request("contents-delete",{path:e})}async saveItem(e){return this.controlChannel.request("contents-save",{id:e})}async createNotebookInDB(e){return this.controlChannel.request("contents-new-notebook",{name:e})}async renameNotebookInDB(e,t,r,o){return this.controlChannel.request("contents-rename-notebook",{notebookId:e,name:t,newName:r,trigger:o})}async duplicateNotebookInDB(e){return this.controlChannel.request("contents-duplicate-notebook",{notebookId:e})}async deleteNotebookInDB(e){return this.controlChannel.request("contents-delete-notebook",{notebookId:e})}async getPathById(e){return this.controlChannel.request("contents-get-path-by-id",{id:e})}async getNotebookInDb(e){return this.controlChannel.request("contents-get-notebook-db",{id:e})}async restoreProjectVersion(e){return this.controlChannel.request("restore-project-version",{versionId:e})}async getExistingTerminals(){return this.controlChannel.request("get-existing-terminals")}async refetchTerminal(e){return this.controlChannel.request("refetch-terminal",{terminalId:e})}async createNewTerminal(){return this.controlChannel.request("new-terminal")}async sendTerminalMessage(e,t,r){return this.controlChannel.request("terminal-message",{message:{type:t,content:r},terminalId:e})}async deleteTerminal(e){return this.controlChannel.request("delete-terminal",{terminalId:e})}async renameTerminal(e,t){return this.controlChannel.request("rename-terminal",{terminalId:e,newName:t})}async executeCodeCell(e,t,r=!1){return this.controlChannel.request("execute",{cell:e,notebookId:t,skipSqlCache:r})}async executeCells(e,t,r=!1){return this.controlChannel.request("execute-cells",{notebookId:e,cells:t,skipSqlCache:r})}async fetchBlockVariablesDAG(e){return me.parse(await this.controlChannel.request("fetch-block-variables-dag",{notebookId:e}))}async interruptExecution(e){return this.controlChannel.request("interrupt",{notebookId:e})}async exportDataframe(e,t){return this.controlChannel.request("export-dataframe",{notebookId:e,cell:t})}submitUserInput(e){return this.controlChannel.notify("submit-user-input",{notebookId:e})}async requestUser(e){return this.controlChannel.request("get-user",{id:e})}async requestSharedbAutocomplete(e,t){return this.controlChannel.request("autocomplete",{position:e,notebookId:t})}async requestSharedbHover(e,t){return this.controlChannel.request("hover",{position:e,notebookId:t})}async requestSharedbDefinition(e,t){return await this.controlChannel.request("definition",{position:e,notebookId:t})}async requestSharedbSignatureHelp(e,t){return this.controlChannel.request("signatureHelp",{position:e,notebookId:t})}async requestAutocomplete(e,t,r){return this.controlChannel.request("autocomplete-v2",{position:e,notebookId:t,blocks:r})}async requestHover(e,t,r){return this.controlChannel.request("hover-v2",{position:e,notebookId:t,blocks:r})}async requestDefinition(e,t,r){return await this.controlChannel.request("definition-v2",{position:e,notebookId:t,blocks:r})}async requestSignatureHelp(e,t,r){return this.controlChannel.request("signatureHelp-v2",{position:e,notebookId:t,blocks:r})}async getCommentState(){return this.controlChannel.request("comment-get-all")}async addComment(e,t,r){return this.controlChannel.request("comment-add",{comment:e,cellId:t,notebookId:r})}async editComment(e){return this.controlChannel.request("comment-edit",{comment:e})}async deleteComment(e,t){return this.controlChannel.request("comment-delete",{commentId:e,threadId:t})}async resolveThread(e,t,r){return this.controlChannel.request("comment-thread-resolve",{threadId:e,cellId:t,resolvedAt:r})}async unresolveThread(e,t){return this.controlChannel.request("comment-thread-unresolve",{threadId:e,cellId:t})}async fetchFilesystemEntities(e){return this.controlChannel.request("contents-fetch-entities",{relativePaths:"string"==typeof e?[e]:[...new Set(e)]}).catch((e=>Promise.reject(new B.rB("Contents contents-fetch-entities failed, storage service is unavailable.",e))))}async getFilesystemSpaceInfo(){return this.controlChannel.request("contents-space-info").catch((e=>Promise.reject(new B.rB("Contents contents-space-info failed, storage service is unavailable.",e))))}async loadItem(e){return this.controlChannel.request("contents-load",{path:e})}async loadNotebook(e){return this.controlChannel.request("contents-load-notebook",{id:e})}register(e,t){return this.controlChannel.register(e,t)}async generateInitNotebook(){return this.controlChannel.request("generate-init-notebook")}async generateDockerfile(){return this.controlChannel.request("generate-dockerfile")}async commMsg(e,t,r,o,n,i=[],a=!1,s=!0){return this.controlChannel.request("comm-msg",{notebookId:e,msgId:r,msg:{content:{comm_id:t,data:o},metadata:n,buffers:i.map((e=>btoa(new Uint8Array(e))))},expectReply:a,disposeOnDone:s})}async requestCommInfo(e){return this.controlChannel.request("comm-info-request",{notebookId:e})}async updateCellLayoutMetadata(e,t){return this.controlChannel.request("store-cell-layout-metadata",{notebookId:e,cellLayoutMetadata:t})}async updateCellTable(e,t,r){return this.controlChannel.request("update-cell-table",{notebookId:e,cellId:t,tableState:r})}async restoreNotebookSession(e){return this.controlChannel.request("restore-notebook-session",{notebookId:e})}}function be(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let Ee=function(e){return e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.RECONNECT=2]="RECONNECT",e[e.HARD_RECONNECT=3]="HARD_RECONNECT",e[e.API_CHANGE=4]="API_CHANGE",e}({});class Se extends he{constructor(e,t){super(),be(this,"apiVersion",void 0),be(this,"loadProjectId",void 0),be(this,"docProvider",void 0),be(this,"controlChannelApi",void 0),be(this,"socket",void 0),be(this,"sharedbAuthFilter",void 0),be(this,"heartbeatInterval",void 0),be(this,"collabData",void 0),be(this,"transaction",void 0),be(this,"connectionAttemptCount",0),be(this,"retryPolicy",(e=>{const t=Math.min(Math.max(1e3*e,0),5e3);return se.l.pushWithTimeStamp(`connection retry attempt ${e}. Next retry: ${t}`),t}));this.socket=new ue.Waterfall((async()=>{this.collabData=await we(e,t),this.apiVersion&&this.collabData.apiVersion!==this.apiVersion&&this.emit(Ee.API_CHANGE),this.apiVersion=this.collabData.apiVersion,this.connectionAttemptCount+=1;const r=Ce(this.collabData.collaborationServiceUrl);return console.log(`Connecting to WS url ${r}`),r}),void 0,{connectionTimeout:1e4,emitClose:!0,retryPolicy:this.retryPolicy}),this.socket.addEventListener("error",(e=>{se.l.pushWithTimeStamp("Socket error"),Object.entries(e).forEach((([e,t])=>se.l.push(`Event properties - ${e}: ${t}`)))})),this.socket.addEventListener("close",(e=>{se.l.pushWithTimeStamp(`[connection.ts] socket closed with code ${e.code}, reason ${e.reason}, wasClean: ${e.wasClean}`),Object.entries(e).forEach((([e,t])=>se.l.push(`Event properties - ${e}: ${t}`))),this.sharedbAuthFilter.status="CLOSED",this.emit(Ee.DISCONNECT)})),this.sharedbAuthFilter=new ue.Dam(new ue.Pipe(this.socket,"db"));const r=this.sharedbAuthFilter;r.addEventListener("error",(e=>{(0,a.D)(new Error(`ShareDb channel error event: ${e}`),"error",{event:e})}));const o=new ue.Cable(new ue.Pipe(this.socket,"ct"));this.patchControlChannel(o),this.controlChannelApi=new ve(o),this.docProvider=new de.Connection(r),this.socket.addEventListener("open",(async()=>{se.l.pushWithTimeStamp("Socket opened");try{if(!this.collabData)throw new Error("Missing collab data");const e=await o.request("init-project",{sessionId:this.collabData.sessionId,projectId:t},1e4),{loadProjectId:r,collabDocVersion:n}=e,i=this.docProvider.get(t,"collab");this.loadProjectId?this.loadProjectId!==r||i&&n&&i.version>n?(Object.values(this.docProvider.collections).forEach((e=>{Object.values(e).forEach((e=>{e._hardRollback()}))})),this.emit(Ee.HARD_RECONNECT),this.transaction&&(this.transaction.name="Hard reconnect",this.transaction.finish())):(this.emit(Ee.RECONNECT),this.transaction&&(this.transaction.name="Reconnect",this.transaction.finish())):this.emit(Ee.CONNECT),this.sharedbAuthFilter.status="OPEN",this.loadProjectId=r,this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval((()=>{o.request("ping",void 0,2e4).catch((e=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval),console.warn("Heartbeat failed, closing socket.",e),this.closeAndReconnect(4e3,"hearbeat failed"),this.transaction=(0,f.Yr)({name:"General reconnect",op:"reconnect"})}))}),2e4),this.socket.addEventListener("close",(()=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.transaction=(0,f.Yr)({name:"General reconnect",op:"reconnect"})})),this.connectionAttemptCount=0}catch(e){(0,h.cz)(e,["ProjectDisposingError"])?await(0,h._v)(1e3):(0,h.cz)(e,["ProjectIsSuspendedError","ProjectInMaintenanceError","UserIsSuspendedError"])?await(0,h._v)(1e4):(5===this.connectionAttemptCount&&(0,a.D)(e,"error"),await(0,h._v)(500)),this.socket.failed(e)}})),se.l.pushWithTimeStamp("Connection constructed.")}close(e,t){console.log(`Forced close, reason: ${t}`),Object.values(this.docProvider.collections).forEach((e=>{Object.values(e).forEach((e=>{e.destroy()}))})),this.docProvider.whenNothingPending((()=>{this.docProvider.close(),this.emit(Ee.DISCONNECT),this.sharedbAuthFilter.status="CLOSED",this.socket.close(e,t)}))}closeAndReconnect(e,t){console.log(`Forced close and recconect, reason: ${t}`),this.emit(Ee.DISCONNECT),this.sharedbAuthFilter.status="CLOSED",this.socket.ws.close(e,t)}getDocProvider(){return this.docProvider}getControlChannelApi(){return this.controlChannelApi}patchControlChannel(e){e.requestOld=e.request,e.request=async(t,r,o)=>{if(!["contents-fetch-entities","hover","ping","contents-space-info"].includes(t)){const e=`Requesting via control channel: ${t}`;se.l.pushWithTimeStamp(e),(0,f.n_)({message:e,category:"control-channel"})}try{return await e.requestOld(t,r,o)}catch(e){throw se.l.pushWithTimeStamp(`Error in control channel request ${t}: ${JSON.stringify(e)}`),new fe.V(`Error in control channel request ${t}`,{cause:e,methodName:t,params:r})}}}}const Ce=e=>{const t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws",`${t.toString()}/`},we=async(e,t)=>{const r=await fetch(`/api/project/${t}/collaboration`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),o=e.getState().user.id;if(200===r.status){const t=await r.json();if(o&&t.userId!==o)throw window.location.reload(),new Error("Unexpected change of user id.");return e.dispatch({type:"UPDATE_SESSION_CONFIG",sessionId:t.sessionId}),t}throw 401===r.status||403===r.status?(o&&window.location.reload(),new Error("Unauthorized access, probably due to expired session, reloading.")):new Error(`Failed to get collab url ${r.status}.`)};var Te=r(77267),Ie=r(32902),_e=r.n(Ie),Ae=r(89734),ke=r.n(Ae),Oe=r(86008),De=r(63871);function Pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(r),!0).forEach((function(t){Ne(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ne(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Le{constructor(){Ne(this,"modelStateCache",{}),Ne(this,"iframeMessengers",{})}setIframeMessenger(e,t){this.iframeMessengers[e]={send:t}}removeIframeMessenger(e){delete this.iframeMessengers[e]}async handleCommMsg(e){if(De.KernelMessage.isCommOpenMsg(e))this.updateWidgetState(e.content.comm_id,JSON.stringify(e.content.data.state));else if(De.KernelMessage.isCommMsgMsg(e)||De.KernelMessage.isCommCloseMsg(e)||De.KernelMessage.isStatusMsg(e)){if(De.KernelMessage.isCommMsgMsg(e)&&"update"===e.content.data.method){const t=e.content.data.state,r=this.modelStateCache[e.content.comm_id];if("resolved"===(null==r?void 0:r.status)){const o=await r.state;this.modelStateCache[e.content.comm_id].state=Promise.resolve(je(je({},o),t))}}Object.values(this.iframeMessengers).forEach((t=>{t.send(e)}))}else(0,h.UT)(e)}updateWidgetState(e,t){let r;try{r=JSON.parse(t)}catch(e){return void(0,a.D)(new Error("Failed deserializing PyWidget state"),"error",{error:e})}if(Object.keys(r).length>0){const t=this.modelStateCache[e];t&&t.resolveState(r),this.modelStateCache[e]={state:Promise.resolve(r),status:"resolved",resolveState:()=>{}}}}getCachedCommInfo(){return Object.fromEntries(Object.keys(this.modelStateCache).map((e=>[e,{target_name:"jupyter.widget"}])))}clearCache(){this.modelStateCache={}}async handleStateRequest(e,t,r){if(this.modelStateCache[t]){const o=await this.modelStateCache[t].state;return this.iframeMessengers[e].send({channel:"iopub",content:{comm_id:t,data:{state:o,method:"update"}},parent_header:{msg_id:r,msg_type:"comm_msg"},buffers:[],metadata:{},header:{msg_id:"mock_id",msg_type:"comm_msg",date:"mock_date",session:"mock_session",username:"mock_username",version:"5.3"}}),!0}let o=e=>{};const n=new Promise((e=>{o=e}));return this.modelStateCache[t]={state:n,resolveState:o,status:"pending"},!1}}var Fe=r(85123),Re=r(82125),Ue=r(48271),xe=r(85675);let Me;const Be=()=>{Me&&(clearInterval(Me),Me=void 0)};function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){qe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function qe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class We{constructor(e,t,r){qe(this,"_store",void 0),qe(this,"_integrationFetcher",void 0),qe(this,"_projectFetcher",void 0),qe(this,"_terminalHandler",void 0),qe(this,"_terminalStore",void 0),qe(this,"_payAsYouGoMachinesFetcher",void 0),qe(this,"_notebooksInDbFetch",void 0),qe(this,"projectId",void 0),qe(this,"workspaceId",void 0),qe(this,"textFileUndoStacks",{}),qe(this,"terminalsAlreadyErrored",new Set),qe(this,"editorRefs",{}),qe(this,"fileEditorRef",{current:void 0}),qe(this,"inputRequestEditorRef",{current:void 0}),qe(this,"collabDoc",void 0),qe(this,"docsExecutingMyCell",{}),qe(this,"widgetManager",new Le),qe(this,"_connection",null),qe(this,"dispose",(()=>{var e;this.collabDoc.destroy(),null===(e=this._connection)||void 0===e||e.close(1e3,"Closing the project")})),qe(this,"clearRefs",(()=>{this.editorRefs={},this.fileEditorRef.current=void 0})),qe(this,"setupPeriodicFileRefresh",(()=>{var e;e=async()=>{this._store.getState().connection.isConnected&&await this.refreshFilesystem()},Be(),Me=setInterval(e,8e3)})),qe(this,"stopPeriodicFileRefresh",(()=>{Be()})),this._store=e.store,this._integrationFetcher=e.integrationFetcher,this._projectFetcher=e.projectFetcher,this._terminalHandler=e.terminalHandler,this._terminalStore=e.terminalStore,this._payAsYouGoMachinesFetcher=e.payAsYouGoMachinesFetcher,this.projectId=t,this.workspaceId=r}static getScrollingElement(){return(0,Te.sk)()?null:document.getElementById(Oe.Ik)}setConnection(e){this._connection=e,this.collabDoc=this.getDoc("collab"),this._registerControlChannel()}getConnection(){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection}getControlChannelApi(){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection.getControlChannelApi()}_registerControlChannel(){if(!this._connection)throw new Error("Controller connection is not configured");const e=this.getControlChannelApi();e.register("refetch-project",(()=>(this._store.dispatch(g.jt()),this._projectFetcher.fetchProject(this.projectId,!0)))),e.register("refetch-hardware-info",(async()=>(await this._payAsYouGoMachinesFetcher.refetch(),this._projectFetcher.fetchProject(this.projectId,!0)))),e.register("new-outputs",(async e=>{this._store.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:e.cellIdsToOutputs})})),e.register("reload-project",(async e=>("dispose"===e.reason?s.Z.loading({message:"Your machine will be restarted in 4 seconds.",duration:4}).then((()=>{s.Z.success({message:"Restarting the machine...",duration:2})}),(()=>{})):"refresh"===e.reason&&s.Z.loading({message:"Hi! We released a new update. Your page will be refreshed to load the latest version of Deepnote.",duration:4}).then((()=>{s.Z.success({message:"Refreshing the page...",duration:2})}),(()=>{})),setTimeout((()=>{window.location.reload()}),5e3)))),e.register("new-history-logs",(async e=>{this._store.dispatch({type:Re.fL.APPEND_HISTORY_LOGS,logs:(0,Fe.X8)(e)}),this.addHistoryAuthors()})),e.register("snapshot-created",(async e=>{this._store.dispatch({type:Re.fL.ADD_SNAPSHOTS,snapshots:e}),this.addHistoryAuthors()})),e.register("comments-patch",(async t=>{const r=this._store,o=r.getState().project.collaborationProperties.currentUserAccessType;(0,h.C5)(o,H.EJ.VIEW_COMMENTS)&&(t.threads&&Object.entries(t.threads).forEach((async([t,o])=>{if(r.getState().commentsState.threads[t])if(!r.getState().commentsState.threads[t].resolvedAt&&o.resolvedAt&&o.resolvedBy){if(!r.getState().commentsState.authors[o.resolvedBy]){const t=await e.requestUser(o.resolvedBy);r.dispatch({type:"ADD_COMMENT_AUTHOR",user:t})}r.dispatch({type:"RESOLVE_THREAD",threadId:t,cellId:o.cellId,resolvedAt:o.resolvedAt,resolvedBy:o.resolvedBy})}else r.getState().commentsState.threads[t].resolvedAt&&!o.resolvedAt?r.dispatch({type:"UNRESOLVE_THREAD",threadId:t,cellId:o.cellId}):r.getState().commentsState.threads[t].deletedAt&&!o.deletedAt?r.dispatch({type:"RESTORE_THREAD",threadId:t}):!r.getState().commentsState.threads[t].deletedAt&&o.deletedAt&&r.dispatch({type:"DELETE_THREAD",threadId:t,deletedAt:o.deletedAt});else r.dispatch({type:"ADD_ACTIVE_THREAD",thread:o,threadId:t})})),t.comments&&Object.entries(t.comments).forEach((async([t,o])=>{if(r.getState().commentsState.comments[t])r.dispatch({type:"EDIT_COMMENT",commentId:t,threadId:o.threadId,content:o.content,editedAt:o.editedAt});else{if(!r.getState().commentsState.authors[o.userId]){const t=await e.requestUser(o.userId);r.dispatch({type:"ADD_COMMENT_AUTHOR",user:t})}r.dispatch({type:"ADD_COMMENT",comment:o,commentId:t})}})))})),e.register("comments-delete",(async e=>{const t=this._store.getState().project.collaborationProperties.currentUserAccessType;(0,h.C5)(t,H.EJ.VIEW_COMMENTS)&&e.comments&&e.comments.forEach((e=>{this._store.dispatch({type:"DELETE_COMMENT",commentId:e.commentId,threadId:e.threadId})}))})),e.register("integration-connect",(async()=>{await this._integrationFetcher.fetchAndStoreIntegrations(this.projectId)})),e.register("collab-message",(async e=>{e&&("collab-error"===e.severity?s.Z.error({duration:e.durationSeconds,message:e.message}):"collab-info"===e.severity?s.Z.info({duration:e.durationSeconds,message:e.message}):"collab-success"===e.severity&&s.Z.success({duration:e.durationSeconds,message:e.message}))})),e.register("contents-refresh",(async()=>this.refreshFilesystem())),e.register("contents-refresh-notebooks",(async()=>{if(this._notebooksInDbFetch)return this._notebooksInDbFetch()})),e.register("new-terminal",(async t=>{const{terminalId:r,name:o,createdAt:n}=t,i=this._store.getState().terminal.terminals;if(i[r])return;const a=this._terminalHandler.createNewTerminal(e,r);if(!a)throw Error("We failed to create terminal. Likely this is because we failed to load xterm.");const{terminal:s,listener:c}=a;this._terminalStore[t.terminalId]={terminal:s,version:0,listenerStore:[c]},this._store.dispatch({type:"SET_TERMINAL_NAMES",terminals:$e($e({},i),{},{[t.terminalId]:{name:o,createdAt:n}})})})),e.register("delete-terminal",(async e=>{this._terminalHandler.deleteTerminal(e.terminalId)})),e.register("rename-terminal",(async e=>{const t=this._store.getState().terminal.terminals,r=$e($e({},t[e.terminalId]),{},{name:e.newName});this._store.dispatch({type:"SET_TERMINAL_NAMES",terminals:$e($e({},t),{},{[e.terminalId]:r})})})),e.register("terminal-disconnected",(async e=>{})),e.register("terminal-stdout",(async t=>{t.forEach((async t=>{const r=t.terminalId,o=this._terminalStore[r];if(o)await this._terminalHandler.terminalStdOut(o,t,e);else if(!this.terminalsAlreadyErrored.has(r)){this.terminalsAlreadyErrored.add(r);const e=new Error(`Received a message ${JSON.stringify(t)}, but there is no such terminal.`);(0,a.D)(e,"error")}}))})),e.register("comm-msg",(async e=>{await this.widgetManager.handleCommMsg(e)}))}async fetchComments(){const e=this._store.getState().project.collaborationProperties.currentUserAccessType;if(!(0,h.C5)(e,H.EJ.VIEW_COMMENTS))return;const t=this.getControlChannelApi(),r=await t.getCommentState();this._store.dispatch({type:"SET_COMMENTS_STATE",commentsState:r})}async fetchSnapshots(){const e=this.getControlChannelApi();try{const t=await e.listSnapshots();this._store.dispatch({type:Re.fL.ADD_SNAPSHOTS,snapshots:t})}catch(e){(0,a.D)(e,"error")}}async addSnapshot(e,t,r){const o=this.getControlChannelApi();try{await o.addSnapshot(e,t,r)}catch(e){throw(0,a.D)(e,"error"),e}}async getSnapshotDiff(e,t){const r=this.getControlChannelApi();try{return await r.getSnapshotDiff(e,t)}catch(e){throw(0,a.D)(e,"error"),e}}async getSnapshotFile(e,t){const r=this.getControlChannelApi();try{return await r.getSnapshotFile(e,t)}catch(e){throw(0,a.D)(e,"error"),e}}addHistoryAuthors(){const e=this._store.getState().project.collaborationProperties.currentUserAccessType;if(!(0,h.C5)(e,H.EJ.MANIPULATE_FILES))return;const t=this._store.getState().history.projectLogs,r=this._store.getState().history.historyAuthors;_e()(t.map((e=>e.userId)).filter((e=>e&&!r[e]))).forEach((async e=>{const t=await this.getControlChannelApi().requestUser(e);this._store.dispatch({type:Re.fL.ADD_HISTORY_AUTHOR,author:t})}))}async refreshFilesystem(){const e=this._store.getState().filesystem.expandedDirPaths;try{await this.fetchFilesystemEntities(e),await this.getFilesystemSpaceInfo()}catch(e){if(e instanceof B.rB)return void this._store.dispatch({type:g.xg.SET_FILESYSTEM_UNAVAILABLE,isUnavailable:!0});throw e}}possiblyDisplayNotification(e,t,r,o){const n=!!this.docsExecutingMyCell[e],i=!(null==r||!r.find((e=>e.sessionId===o)));this.docsExecutingMyCell[e]=i;if(!(n&&!i))return;if(ke().needsPermission)return;const a=new(ke())("Finished execution",{body:`In ${t}`,notifyClick:()=>{window.focus()}}),s=this._store.getState().project.focusedItem;(0,xe.hE)(s)&&e===(null==s?void 0:s.id)&&document.hasFocus()||a.show()}getFocusedDoc(){const e=this._store.getState().project.focusedItem;if((0,xe.hE)(e))return this.getDoc(e.id)}getFocusedNotebookDoc(){const e=this._store.getState().project.focusedItem;if((0,xe.hE)(e))return this.getNotebookDoc(e.id)}getNotebookDoc(e){const t=this.getDoc(e);if((0,h.nZ)(t.data))return t}getDoc(e){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection.getDocProvider().get(this.projectId,e)}getFocusedFileUndoStack(){const e=this._store.getState().project.focusedItem;if((0,xe.hE)(e))return this.textFileUndoStacks[e.id]}async fetchFilesystemEntities(e){const t=await this.getControlChannelApi().fetchFilesystemEntities(e),r=(0,Ue.wT)(t);D()(r,this._store.getState().filesystem.entities)||this._store.dispatch({type:g.xg.ENTITIES_LOADED,entities:t,partial:!1})}async getFilesystemSpaceInfo(){const e=await this.getControlChannelApi().getFilesystemSpaceInfo();e&&!D()(e,this._store.getState().filesystem.spaceInfo)&&this._store.dispatch({type:g.xg.SPACE_INFO_LOADED,spaceInfo:e})}setupNotebooksInDbRefetch(e){this._notebooksInDbFetch=e}}var Ge=r(27809),Ze=r(72008),Je=r.n(Ze),Ve=r(72307),ze=r.n(Ve);function Ye(e,t,r){void 0!==e.data&&t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:r,data:e.data});let o=[];const n=()=>{try{const e=Je()(o);o=[],t.dispatch({type:"RECEIVE_SHAREDB_OP",path:r,op:e})}catch(e){(0,a.D)(e,"error",{path:r,ops:o})}},i=ze()((()=>{n()}),1e3,{trailing:!0,leading:!1});e.on("load",(()=>{null!==e.type&&t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:r,data:e.data})})),e.on("create",(()=>{t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:r,data:e.data})})),e.on("op batch",(r=>{o=[...o,...r],r.every((r=>function(e,t,r){const o=e.p;if(4===o.length&&"cells"===o[0]&&"metadata"===o[2]&&"source_hash"===o[3])return!0;if(4===o.length&&"cells"===o[0]&&"metadata"===o[2]&&"deepnote_to_be_reexecuted"===o[3])return!0;if(4===o.length&&"cells"===o[0]&&"metadata"===o[2]&&"execution_start"===o[3])return!0;if(4===o.length&&"cells"===o[0]&&"metadata"===o[2]&&"execution_millis"===o[3])return!0;if(1===o.length&&"kernelStatus"===o[0])return!0;if(o.length>=1&&"executionQueue"===o[0]){const o=r.getState().sharedbState.files[t],n=o&&(0,h.nZ)(o)?o.executionQueue:null;if(!n||0===n.length)return!1;if(1===n.length&&0===e.ld)return!1}if(3===o.length&&"cells"===o[0]&&"execution_count"===o[2])return!0;if(3===o.length&&"cells"===o[0]&&"source_hash"===o[2])return!0;return!1}(r,e.id,t)))?i():n()})),e.on("del",(()=>{t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:r,data:e.data})}))}class Qe extends B.GU{}const Ke=e=>({createController:(t,r)=>{const o=new We(e,t,r);return o.setConnection(new Se(e.store,t)),o}}),Xe=e=>{const{controllerRef:t,itemFocusApi:r,store:o}=e;if(!t.current)throw new Error("Controller is not available");const n=t.current;return{initialize:t=>{o.dispatch({type:"PROJECT_INITIALIZATION_STARTED"}),se.l.pushWithTimeStamp("starting function initialize()");const i=n.projectId,s=e.projectFetcher.fetchProject(i),c=setTimeout((()=>{se.l.pushWithTimeStamp("initialization timed out"),(0,a.D)(new Error("Initialisation of project timed out"),"error",{latestEvents:se.l.getItems(),waterfall:n.getConnection().socket});o.dispatch({type:"PROJECT_INITIALIZATION_WARNING",warning:"This is taking longer than usual. We are still trying though. If the issue persists, please try restarting your browser."})}),3e4),l=e=>{if(clearTimeout(c),e){const t="Something went wrong during project inititalisation. Please try again later.";o.dispatch({type:"PROJECT_INITIALIZATION_ERROR",error:t}),(0,a.D)(e,"error"),le(!1)}else o.dispatch({type:"PROJECT_INITIALIZATION_FINISHED"})};let u=!1;const d=async c=>{try{n.collabDoc.subscribed||await(0,Ge.EM)((e=>n.collabDoc.subscribe(e))),u||(u=!0,Ye(n.collabDoc,o,"collabDoc"),function(){var e;const t=null===(e=n.collabDoc.data)||void 0===e?void 0:e.hardwareStatus;t&&o.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:t});const r=(0,Ge.z3)(["hardwareStatus"],(()=>{var e;null!==(e=n.collabDoc.data)&&void 0!==e&&e.hardwareStatus&&o.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:n.collabDoc.data.hardwareStatus})}));n.collabDoc.on("op",r),n.collabDoc.on("load",(()=>{var e;null!==(e=n.collabDoc.data)&&void 0!==e&&e.hardwareStatus&&o.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:n.collabDoc.data.hardwareStatus})}))}()),await s,o.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!0});const d=n.refreshFilesystem(),p=e.terminalHandler.initializeProjectTerminals(n.getControlChannelApi()),h=n.fetchComments(),f=e.integrationFetcher.fetchAndStoreIntegrations(i);await Promise.all([d,p]);const m=r.focusActiveItem(!c,t),y=async function(){const e=n.projectId,t=n.getControlChannelApi(),i=o.getState().project.init_notebook_id;try{if(i){const n=await t.loadNotebook(i);if(!n)throw new Error(`[${e}] Init file not found!`);o.dispatch({type:g.xg.SET_INIT_NOTEBOOK_ID,id:n.id}),await r.loadDocAndSubscribe(n.id,"/")}else if(o.getState().filesystem.entities[ae.Fd]){const n=await t.loadItem(ae.Fd);if(!n)throw new Error(`[${e}] Init file not found!`);o.dispatch({type:g.xg.SET_INIT_NOTEBOOK_ID,id:n.id}),await r.loadDocAndSubscribe(n.id,ae.Fd)}}catch(e){(0,a.D)(new Qe("Failed to load init notebook",{cause:e}),"error")}}();await m,l(),le(!0),n.setupPeriodicFileRefresh(),await Promise.all([h,f,y])}catch(e){l(e)}};n.getConnection().on((async e=>{if(console.debug("Connection event:",e),e===Ee.CONNECT&&(se.l.pushWithTimeStamp("CONNECT"),n.widgetManager.clearCache(),await d(!1)),e===Ee.RECONNECT&&(se.l.pushWithTimeStamp("RECONNECT"),n.widgetManager.clearCache(),await d(!0)),e===Ee.HARD_RECONNECT){se.l.pushWithTimeStamp("HARD_RECONNECT"),console.log("HARD RECONNECT");(async()=>{n.widgetManager.clearCache(),await(0,Ge.EM)((e=>n.collabDoc.once("load",e))),await r.focusActiveItem(!1),n.setupPeriodicFileRefresh(),o.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!0})})().catch((e=>{(0,a.D)(e,"fatal"),window.location.reload()}))}e===Ee.API_CHANGE&&(se.l.pushWithTimeStamp("API_CHANGE"),n.getConnection().closeAndReconnect(4001,"Backend API version changed"),o.dispatch({type:g.wO.OPEN_MODAL,payload:{newModal:g.Qi.REFRESH_MODAL,title:"New version is out!",message:"We have done a lot of bugfixes and even released some new features. Please refresh the page to continue."}})),e===Ee.DISCONNECT&&(n.stopPeriodicFileRefresh(),se.l.pushWithTimeStamp("DISCONNECT"),o.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!1}))})),se.l.pushWithTimeStamp("initialisation of initialisation class done");return()=>{clearTimeout(c)}}}};var et=r(32037),tt=r(71267),rt=r(76904),ot=r.n(rt),nt=r(43035),it=r(98439),at=r(15455),st=r(93111),ct=r(11098),lt=r(44791),ut=r(24973),dt=r.n(ut);function pt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ht=e=>{const t=e[e.length-1];return t?"number"==typeof(r=t).p[0]?r.p[0]:null:null;var r};class ft{constructor(e){this.doc=e,pt(this,"listenerStore",{}),pt(this,"undoStack",[]),pt(this,"undoStackPointer",-1),pt(this,"tryToComposeOps",!1),pt(this,"compositionTimeout",void 0),pt(this,"addOps",(e=>{this.undoStackPointer!==this.undoStack.length-1&&(this.undoStack=this.undoStack.slice(0,this.undoStackPointer+1)),this.tryToComposeOps&&this.undoStack[this.undoStackPointer]&&this.opsComposable(this.undoStack[this.undoStackPointer])&&this.opsComposable(e)&&this.opsComposable([e[0],this.undoStack[this.undoStackPointer][0]])?this.undoStack[this.undoStack.length-1]=this.undoStack[this.undoStack.length-1].concat(e):(100===this.undoStack.length&&this.undoStack.shift(),this.undoStack.push(e),this.tryToComposeOps=!0,this.compositionTimeout&&clearTimeout(this.compositionTimeout),this.compositionTimeout=setTimeout((()=>{this.tryToComposeOps=!1,this.compositionTimeout=void 0}),300)),this.undoStackPointer=this.undoStack.length-1})),pt(this,"restoreAutocompleteInfo",((e,t)=>{const r=e.slice().reverse();for(let e=0;e<r.length;e++)t[e].i=r[e].i;return t})),pt(this,"undo",(()=>{if((0,f.n_)({message:"Called Undo"}),this.undoStackPointer<0)return null;const e=this.undoStack[this.undoStackPointer];this.undoStackPointer--;const t=this.restoreAutocompleteInfo(e,dt().type.invert(e));return this.submitOps(t,"Undo"),ht(e)})),pt(this,"redo",(()=>{if(this.undoStackPointer>=this.undoStack.length-1)return null;const e=this.undoStack[this.undoStackPointer+1];return this.undoStackPointer++,this.submitOps(e,"Redo"),ht(e)})),pt(this,"registerOpListener",(e=>{const t=(0,y.Z)();return this.listenerStore[t]=e,t})),pt(this,"removeOpListener",(e=>{delete this.listenerStore[e]})),pt(this,"destroy",(()=>{this.listenerStore={},this.compositionTimeout&&(clearTimeout(this.compositionTimeout),delete this.compositionTimeout)})),pt(this,"reset",(()=>{this.undoStack=[],this.undoStackPointer=-1})),pt(this,"submitOps",((e,t)=>{e.forEach((e=>{this.doc.submitOp([e],void 0,(e=>{e&&(this.reset(),e.message=t+" failed because of a conflict with a collaborator. "+e.message,(0,f.n_)(e),s.Z.closeAll(),s.Z.warning({message:t+" failed because of a conflict with a collaborator."}))}))}));for(const t of Object.values(this.listenerStore))t(e)})),pt(this,"opsTargetFile",((e,t)=>1===e.p.length&&1===t.p.length&&"number"==typeof e.p[0]&&"number"==typeof t.p[0])),pt(this,"opsComposable",(e=>{if(0===e.length)return!0;const t=e[0];return e.every((e=>this.opsTargetFile(t,e)))}))}}function gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(r),!0).forEach((function(t){yt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const vt="/notebook.ipynb";function bt(e){const{controllerRef:t,store:r,slateRef:o,terminalStore:n}=e,i={openTerminal:e=>{const t=r.getState().project.collaborationProperties.currentUserAccessType,o=r.getState().terminal.terminals;(0,h.C5)(t,H.EJ.RUN_TERMINAL)&&o[e]&&r.dispatch(g.tc(e))},clearEditorRefs({currentlyFocusedItem:e,controller:t,newItemPath:r,newItemId:o}){const n=(0,xe.rN)(e)&&e.relativePath===r,i=(0,xe.hE)(e)&&e.id===o;n||i||t.clearRefs()},async defocusNotebookIfActiveAndFocusAnother(t){const o=r.getState().project.focusedItem;if((0,xe.hE)(o)&&o.id===t){r.dispatch((0,g.Kz)());const o=r.getState().project.id,n=r.getState().project.init_notebook_id,a=(await e.notebooksFetcher.fetchNotebooks(o,{fetchPolicy:"cache-first"})).filter((e=>e.id!==n&&e.id!==t));if(a.length>0){const e=a[0];return i.setActiveNotebook(e.id)}}},saveCurrentlyFocusedItem(t){const o=nt.l.selectSharedbFiles(r.getState()),n=V.H.selectCurrentUserAccessType(r.getState()),i=(0,h.C5)(n,H.EJ.MANIPULATE_FILES);(0,xe.hE)(t)&&void 0!==o[t.id]&&i&&e.fileSaver.saveFile(t.id).catch((e=>{(0,a.D)(e,"error")}))},updateFocusedNotebookName(e,t){const o=r.getState().project.focusedItem;if(!(0,xe.mt)(o)||o.id!==e)return;const n=mt(mt({},o),{},{name:t});r.dispatch((0,g.ki)(n))},updateAndRememberUrl({addToHistory:e,cellIdToFocus:t,controller:o,path:n,notebookInDB:i}){const{relativeUrlWithFile:a}=(0,at.g)({project:r.getState().project,urlHash:null!=t?t:void 0,filePath:n,notebookInDB:i});if(e){const e=null!=n?n:null==i?void 0:i.id;e&&(0,v.dG)(o.projectId,e),window.history.pushState(null,o.projectId,a)}else window.history.replaceState(null,o.projectId,a)},setActiveNotebook:async(o,n={})=>{var s,c;const{addToHistory:l,cellIdToFocus:u}=n;se.l.pushWithTimeStamp("setActiveNotebook");const d=t.current;if(!d)return;(0,W.j)("Notebook opened",{workspaceId:d.workspaceId});const p=d.getControlChannelApi(),h=r.getState().project.focusedItem;let f,m,y;try{const e=await p.loadNotebook(o);if(!e)return void await d.refreshFilesystem();f=e.truncated,m=e.name,y=e.relativePath;if(!await i.loadDocAndSubscribe(o,"/",m))return}catch(e){(0,a.D)(e,"error")}const v={id:o,name:null!==(s=m)&&void 0!==s?s:""};i.saveCurrentlyFocusedItem(h),se.l.pushWithTimeStamp("focusedNotebookOp"),i.updateAndRememberUrl({addToHistory:l,notebookInDB:v,cellIdToFocus:u,controller:d});const b={type:"notebook",id:v.id,name:v.name,relativePath:null!==(c=y)&&void 0!==c?c:`/${v.name}.ipynb`,truncated:f};i.clearEditorRefs({currentlyFocusedItem:h,controller:d,newItemId:null==v?void 0:v.id});!((0,xe.hE)(h)&&h.id===(null==v?void 0:v.id))&&d.clearRefs(),r.dispatch((0,g.ki)(b)),u&&e.commonApi.scrollToCell(u)},setActiveFile:async(o,n={})=>{const{openRaw:s,addToHistory:c=!0,cellIdToFocus:l}=n;if(se.l.pushWithTimeStamp(`setActiveFile ${o}`),!o)return void r.dispatch((0,g.Kz)());if(o){const e=(0,Ue.hU)(o),n=r.getState().filesystem.expandedDirPaths;var u;if(e.some((e=>!n.includes(e))))r.dispatch({type:g.xg.SET_EXPANDED_DIRS,expandedDirPaths:[...new Set([...n,...e])]}),await(null===(u=t.current)||void 0===u?void 0:u.refreshFilesystem())}const d=t.current;if(!d)return;(0,W.j)("File opened",{path:o,type:(0,Ue.mD)(o),workspaceId:d.workspaceId});const p=(0,ct.Aq)(o),h=null!=s?s:r.getState().filesystem.openRawList.includes(o),f=d.getControlChannelApi(),m=r.getState().project.focusedItem;let y,v;if(p===ct.DI.EDITOR||h)try{const t=await f.loadItem(o);if(!t){if(o.endsWith(".ipynb")){const t=r.getState().project.id,a=(await e.notebooksFetcher.fetchNotebooks(t)).find((e=>e.name===(0,et.vQ)(o)));if(a)return await i.setActiveNotebook(a.id,{cellIdToFocus:n.cellIdToFocus,addToHistory:!1})}return void await d.refreshFilesystem()}y=t.id,v=t.truncated;const a=await i.loadDocAndSubscribe(y,o);if(!a)return;y!==((0,xe.rN)(m)&&m.id)&&(d.textFileUndoStacks[y]||(d.textFileUndoStacks[y]=new ft(a)))}catch(e){(0,a.D)(e,"error")}i.saveCurrentlyFocusedItem(m),se.l.pushWithTimeStamp("focusedFileOp"),i.updateAndRememberUrl({addToHistory:c,path:o,cellIdToFocus:l,controller:d}),h&&!r.getState().filesystem.openRawList.includes(o)&&r.dispatch({type:g.xg.SET_OPEN_RAW_LIST,openRawList:[...r.getState().filesystem.openRawList,o]});const b=y?{type:"file",id:y,truncated:v,relativePath:o}:{type:"preview",relativePath:o};i.clearEditorRefs({currentlyFocusedItem:m,controller:d,newItemPath:o,newItemId:y}),r.dispatch((0,g.ki)(b)),l&&e.commonApi.scrollToCell(l)},extractFilePathFromUrl:async e=>{const t=(0,st.mK)();t&&(0,st.rf)("fileId");const r=(0,st.bp)();if(r){const e=(0,et.aR)(r);return{filePath:null,notebookInDB:{id:e.id,name:e.name}}}const o=(0,st.A6)();if(o)return{filePath:o,notebookInDB:null};if(t){const r=await e.getPathById(t);if(r)return(0,st.nr)(r),{filePath:r,notebookInDB:null};s.Z.error({message:"The file you are trying to open has been deleted"})}return{filePath:null,notebookInDB:null}},focusActiveItem:async(e,o)=>{var a,s,c;const l=r.getState().project.focusedItem,u=null===(a=t.current)||void 0===a?void 0:a.projectId,d=u?(0,v.d)(u):null,p=(0,xe.rs)(l)&&l.id||(null==d?void 0:d.startsWith(Oe.nH))&&d.slice(Oe.nH.length);if(p)return(0,h.C5)(r.getState().project.collaborationProperties.currentUserAccessType,H.EJ.RUN_TERMINAL)&&n[p]?r.dispatch((0,g.ki)({id:p,type:"terminal"})):r.dispatch((0,g.ki)(null));const f=t.current;if(!f)return;const{filePath:m,notebookInDB:y}=await i.extractFilePathFromUrl(f.getControlChannelApi()),b=m||(0,xe.rN)(l)&&l.relativePath||void 0,E=b===m&&((0,xe.G5)(b)||(0,xe.mt)(l))?i.getCellIdToFocus(l):void 0;if(y)return i.setActiveNotebook(y.id,{cellIdToFocus:e?E:void 0,addToHistory:!1});if(b)return i.setActiveFile(b,{cellIdToFocus:e?E:void 0,addToHistory:!1});const S=32===(null==d?void 0:d.length)&&"/"!==(null==d?void 0:d[0])?d:null;if(S)return i.setActiveNotebook(S,{addToHistory:!1});if(d)return i.setActiveFile(d,{addToHistory:!1});if(o)return i.setActiveNotebook(o,{addToHistory:!1});const C=ot()(r.getState().filesystem.entities,Ue.F5).sort(((e,t)=>e.relativePath.localeCompare(t.relativePath,void 0,{numeric:!0})));let w=C.find((e=>(0,xe.G5)(e.relativePath)&&e.relativePath!==vt));if(w=null!==(s=w)&&void 0!==s?s:r.getState().filesystem.entities[vt],w=null!==(c=w)&&void 0!==c?c:C.find((e=>"file"===e.type&&e.relativePath.toLowerCase().endsWith(".py"))),(0,tt.zE)(w))return i.setActiveFile(w.relativePath,{cellIdToFocus:E,addToHistory:!1});r.dispatch({type:"SWITCH_PROJECT_LAYOUT",layout:it.k7.CONTENT})},getCellIdToFocus:e=>{const t=(0,xe.hE)(e)?(0,v.D)(e.id):void 0,r=(0,st._R)();return null!=r?r:t},registerNotebookCallbacks:(e,o,n)=>{const i=r.getState().sessionConfig.sessionId,s=(0,Ge.z3)(["executionQueue"],(()=>{var r;const s=n.data;null!=s&&s.executionQueue||(0,a.D)(new Error("Notebook has no execution queue"),"warning",{supposedNotebook:s}),null===(r=t.current)||void 0===r||r.possiblyDisplayNotification(e,o,s.executionQueue,i)}));n.on("op",s)},loadDocAndSubscribe:async(e,n,a)=>{const s=t.current;if(!s)return;s.getControlChannelApi().fetchCellLayoutMetadata(e).then((e=>{r.dispatch({type:"CACHED_CELL_LAYOUT_FETCHED",payload:e})}));const c=s.getDoc(e);return null!=c&&c.type||(c.removeAllListeners("load"),c.removeAllListeners("del"),c.removeAllListeners("error"),c.once("load",(()=>{i.registerNotebookCallbacks(e,null!=a?a:(0,Ue.UO)(n),c),Ye(c,r,`files.${e}`)})),c.on("load",(()=>{console.log("Doc loaded, fileId:",e)})),c.on("del",(()=>{console.log("Doc deleted, fileId:",e)})),c.on("error",(e=>{le(!1),(0,lt.g)(o.current,new Error(`Doc error: ${e.message} , code: ${e.code}`),"error")})),await(0,Ge.EM)((e=>c.subscribe(e))),se.l.pushWithTimeStamp("fileDocSubscribed")),c}};return i}r(37141);var Et=r(60212),St=r(90142),Ct=r.n(St),wt=r(19764),Tt=r(94366);function It(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const[At,kt]=(0,Tt.Z)((()=>r.e(1802).then(r.t.bind(r,46466,23))),"We failed to load terminals. Please try refreshing the page.");function Ot(e){const{store:t,terminalStore:r}=e;function o(e,r){var o;if(null===(o=At.current)||void 0===o||!o.Terminal)return;const n=new At.current.Terminal({cursorBlink:!1,fontFamily:Et.F$,fontSize:14,fontWeightBold:"500"});n.loadAddon(new(Ct()));const i=n.onData((o=>{const n=t.getState().connection.hardwareStatus,i=t.getState().connection.isConnected;(0,wt.OJ)(n)&&i?e.sendTerminalMessage(r,"stdin",[o]).catch((e=>{const t=new Error(`error when sending terminal stdin: ${e.message}`);(0,a.D)(t,"error",{terminalId:r})})):(s.Z.closeAll(),s.Z.info({message:i?"Machine is not running yet. You can start typing once it's ready.":"It seems you're offline. You can start typing when you're back online."}))}));return{terminal:n,listener:i}}return{createNewTerminal:o,deleteTerminal:function(e){r[e].listenerStore.forEach((e=>e.dispose())),r[e].terminal.dispose(),delete r[e];const o=t.getState().project.focusedItem;(0,xe.rs)(o)&&(null==o?void 0:o.id)===e&&t.dispatch(g.Kz());const n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?It(Object(r),!0).forEach((function(t){_t(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t.getState().terminal.terminals);delete n[e],t.dispatch({type:"SET_TERMINAL_NAMES",terminals:n})},initializeProjectTerminals:async function(e){const n=t.getState().project.collaborationProperties.currentUserAccessType;if((0,h.C5)(n,H.EJ.RUN_TERMINAL)){const n=await e.getExistingTerminals();await kt();const i=n.map((({terminalContents:t,terminalId:n,name:i,createdAt:s,terminalColumns:c,terminalRows:l,version:u})=>{const d=o(e,n);if(!d)return(0,a.D)(new Error("Failed to create while initializing project terminals. Likely we failed to load xterm."),"error"),null;const{terminal:p,listener:h}=d;return p.resize(c,l),p.write(t),r[n]={terminal:p,version:u,listenerStore:[h]},{[n]:{name:i,createdAt:s}}})).filter(Boolean);t.dispatch({type:"SET_TERMINAL_NAMES",terminals:Object.assign({},...i)})}else t.dispatch({type:"SET_TERMINAL_NAMES",terminals:{}})},terminalStdOut:async function(e,t,r){const{terminalId:o,version:n,content:i}=t;if(n===e.version+1)e.terminal.write(i),e.version=n;else{const{terminalContents:t,version:n}=await r.refetchTerminal(o);e.terminal.reset(),e.terminal.write(t),e.version=n}},isTerminalLoaded:function(){return Boolean(At.current)}}}var Dt=r(64842),Pt=r(17119),jt=r(39981);const{ServiceContext:Nt,useServices:Lt}=(0,Pt.A)();function Ft(e){const{commonApi:t}=(0,Dt.WG)(),r=(0,ie.qr)(),a=(0,o.x)(),[s,l]=(0,i.useState)(null);return(0,i.useEffect)((()=>{var o,i;l((o={commonApi:t,store:r,apolloClient:a},i={projectId:e.projectId,workspaceId:e.workspaceId,blockApiEnabled:e.blockApiEnabled},(0,n.W)({blockFetchQueue:U,blockTransactionQueue:M,blockTransforms:oe,blockTransport:i.blockApiEnabled?S:z,controllerRef:e=>({current:e.controllerFactory.createController(i.projectId,i.workspaceId)}),controllerInit:Xe,fileSaver:q,integrationFetcher:c,itemFocusApi:bt,projectFetcher:m,notebooksFetcher:u,payAsYouGoMachinesFetcher:p,terminalHandler:Ot,terminalStore:ne,slateRef:()=>({current:null}),projectTrack:()=>J(i.workspaceId)},{commonApi:o.commonApi,store:o.store,apolloClient:o.apolloClient,controllerFactory:Ke})))}),[t,r,e.projectId,a,e.workspaceId,e.blockApiEnabled]),(0,i.useEffect)((()=>{if(!s)return;const{controllerInit:t,controllerRef:r}=s,o=t.initialize(e.defaultNotebookId),n=r.current;return()=>{o(),null==n||n.dispose()}}),[s,r,e.defaultNotebookId]),s?(0,jt.tZ)(Nt.Provider,{value:s,children:e.children}):null}},96759:(e,t,r)=>{"use strict";r.d(t,{QW:()=>s,L3:()=>l,Y:()=>u.Y});var o=r(19873);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=i(i({},o.QW),{},{redshift:i(i({},o.QW.redshift),{},{upsellModalType:"integration-redshift"}),athena:i(i({},o.QW.athena),{},{upsellModalType:"integration-athena"}),github:i({},o.QW.github),s3:i(i({},o.QW.s3),{},{upsellModalType:"integration-s3"}),"big-query":i(i({},o.QW["big-query"]),{},{upsellModalType:"integration-bigquery"}),gcs:i(i({},o.QW.gcs),{},{upsellModalType:"integration-gcs"}),snowflake:i(i({},o.QW.snowflake),{},{upsellModalType:"integration-snowflake"}),dbt:i(i({},o.QW.dbt),{},{upsellModalType:"integration-snowflake"}),ecr:i(i({},o.QW.ecr),{},{upsellModalType:"integration-ecr"}),gcr:i(i({},o.QW.gcr),{},{upsellModalType:"integration-gcr"}),dockerhub:i(i({},o.QW.dockerhub),{},{upsellModalType:"integration-dockerhub"}),"sql-server":i(i({},o.QW["sql-server"]),{},{upsellModalType:"integration-sql-server"}),trino:i(i({},o.QW.trino),{},{upsellModalType:"integration-trino"}),dremio:i(i({},o.QW.dremio),{},{upsellModalType:"integration-dremio"}),ssh_tunnel:i({},o.QW.ssh_tunnel),github_package:i({},o.QW.github_package)});var c=r(45409);function l(e){return e===c.ws.CONNECTED||e===c.ws.ALWAYS_ON}var u=r(43388)},43388:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n,bJ:()=>a,jc:()=>i});var o=r(45409);function n(e){return{activeIntegrations:i(e),availableIntegrations:a(e)}}function i(e){return e.filter((e=>e.state===o.ws.CONNECTED||e.state===o.ws.DISCONNECTING||e.state===o.ws.MOUNT_ERROR||e.state===o.ws.CONNECTING||e.state===o.ws.REFRESHING))}function a(e){return e.filter((e=>e.state===o.ws.AVAILABLE))}},58455:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var o=r(91987),n=r(36057);function i(e,t){const[r,i]=(0,o.useState)((()=>{var r;let o;return"undefined"!=typeof window&&(o=(0,n.KM)(e)),null!==(r=o)&&void 0!==r?r:t}));return[r,t=>{try{const o=t instanceof Function?t(r):t;"undefined"!=typeof window&&(i(o),(0,n.RQ)(e,o))}catch(e){console.log(e)}}]}},85123:(e,t,r)=>{"use strict";r.d(t,{LI:()=>v,X8:()=>m,fF:()=>y,n3:()=>g,zM:()=>E});var o=r(26129),n=r(3766),i=r(36042),a=r.n(i),s=r(32902),c=r.n(s),l=r(48271),u=r(82125);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const f={[u.AY.VERSION_AUTOMATIC]:[o.TD.PROJECT_VERSION],[u.AY.VERSION_MANUAL]:[o.TD.PROJECT_VERSION],[u.AY.SNAPSHOT_AUTOMATIC]:[o.TD.SNAPSHOT],[u.AY.SNAPSHOT_MANUAL]:[o.TD.SNAPSHOT],[u.AY.FILE_CHANGES]:[o.TD.EDIT_NOTEBOOK,o.TD.NEW_FILE,o.TD.NEW_DIRECTORY,o.TD.DELETE_FILE,o.TD.RENAME_FILE],[u.AY.EXECUTIONS]:[o.TD.EXECUTE_CELL,o.TD.EXECUTE_ALL],[u.AY.KERNEL]:[o.TD.KERNEL_INTERRUPT,o.TD.KERNEL_RESTART],[u.AY.HARDWARE]:[o.TD.RESTART_HARDWARE,o.TD.HARDWARE_PREEMPTION,o.TD.HARDWARE_OUT_OF_QUOTA,o.TD.HARDWARE_SHUTDOWN_INACTIVITY,o.TD.PAY_AS_YOU_GO_DISABLED],[u.AY.SCHEDULED_RUNS]:[o.TD.SCHEDULED_RUN_FAILED,o.TD.SCHEDULED_RUN_SUCCESS,o.TD.SCHEDULED_RUN_SKIPPED],[u.AY.NOTEBOOK_SCHEDULE]:[o.TD.NOTEBOOK_SCHEDULING_ENABLED,o.TD.NOTEBOOK_SCHEDULING_DISABLED,o.TD.NOTEBOOK_SCHEDULING_UPDATED],[u.AY.PUBLISHING]:[o.TD.PUBLISH_NOTEBOOK,o.TD.UNPUBLISH_NOTEBOOK,o.TD.TOGGLE_PUBLIC_LISTING,o.TD.TOGGLE_PUBLISHED_ACCESS]};(0,n.UT)(0),(0,n.UT)(0);const g=e=>c()(a()(e.map((e=>f[e])))),m=e=>e.map((e=>{var t,r,n,i,a;return(e=>!("type"in e))(e)?{id:e.id,userId:null!==(i=e.user_id)&&void 0!==i?i:void 0,projectId:e.project_id,fileId:void 0,type:o.TD.PROJECT_VERSION,createdAt:new Date(e.created_at),metadata:null!==(a=e.metadata)&&void 0!==a?a:void 0}:{id:String(e.id),userId:null!==(t=e.user_id)&&void 0!==t?t:void 0,projectId:e.project_id,fileId:null!==(r=e.file_id)&&void 0!==r?r:void 0,type:e.type,createdAt:new Date(e.created_at),metadata:null!==(n=e.metadata)&&void 0!==n?n:void 0}})),y=(e,t)=>e.includes(t)?e:[...e,t],v=(e,t)=>{var r;const o=b(e,t),n="API"===(null===(r=e.metadata)||void 0===r?void 0:r.triggeredBy)?" (via API)":"";return p(p({},o),{},{name:(null==o?void 0:o.name)+n})},b=(e,t)=>{switch(e.type){case o.TD.EXECUTE_CELL:return{type:u.AY.EXECUTIONS,color:u.er.EXECUTIONS,name:"Block executed",description:null!=t?t:"File not found"};case o.TD.EXECUTE_ALL:return{type:u.AY.EXECUTIONS,color:u.er.EXECUTIONS,name:"Notebook executed",description:null!=t?t:"File not found"};case o.TD.EDIT_NOTEBOOK:return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"Notebook modified",description:null!=t?t:"File not found"};case o.TD.NEW_FILE:{var r;const t=(0,l.UO)(null===(r=e.metadata)||void 0===r?void 0:r.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File created",description:t}}case o.TD.DELETE_FILE:{var i;const t=(0,l.UO)(null===(i=e.metadata)||void 0===i?void 0:i.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File deleted",description:t}}case o.TD.RENAME_FILE:{var a,s;const t=(0,l.UO)(null===(a=e.metadata)||void 0===a?void 0:a.path),r=(0,l.UO)(null===(s=e.metadata)||void 0===s?void 0:s.newPath);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File renamed",description:`${t} → ${r}`}}case o.TD.NEW_DIRECTORY:{var c;const t=(0,l.UO)(null===(c=e.metadata)||void 0===c?void 0:c.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"Directory created",description:t}}case o.TD.KERNEL_RESTART:return{type:u.AY.KERNEL,color:u.er.KERNEL,name:"Kernel restart",description:null!=t?t:"File not found"};case o.TD.KERNEL_INTERRUPT:return{type:u.AY.KERNEL,color:u.er.KERNEL,name:"Kernel interrupt",description:null!=t?t:"File not found"};case o.TD.RESTART_HARDWARE:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine restarted",description:"All state was cleared"};case o.TD.HARDWARE_PREEMPTION:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine was preempted.",description:"All state was cleared"};case o.TD.HARDWARE_OUT_OF_QUOTA:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine quota ran out.",description:"All state was cleared"};case o.TD.PAY_AS_YOU_GO_DISABLED:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Pay-as-you-go machines have been disabled.",description:"All state was cleared"};case o.TD.HARDWARE_SHUTDOWN_INACTIVITY:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine was shut down.",description:"Machine was shut down due to inactivity"};case o.TD.SNAPSHOT:{var d,p;const t=e.metadata;return{type:t.automatic?u.AY.SNAPSHOT_AUTOMATIC:u.AY.SNAPSHOT_MANUAL,color:t.automatic?u.er.SNAPSHOT_AUTOMATIC:u.er.SNAPSHOT_MANUAL,name:null===(d=e.metadata)||void 0===d?void 0:d.label,description:null===(p=e.metadata)||void 0===p?void 0:p.description}}case o.TD.PROJECT_VERSION:var h,f;return{type:e.userId?u.AY.VERSION_MANUAL:u.AY.VERSION_AUTOMATIC,color:e.userId?u.er.VERSION_MANUAL:u.er.VERSION_AUTOMATIC,name:null===(h=e.metadata)||void 0===h?void 0:h.title,description:null===(f=e.metadata)||void 0===f?void 0:f.description};case o.TD.NOTEBOOK_SCHEDULING_DISABLED:var g,m;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(g=e.metadata)||void 0===g?void 0:g.title,description:null===(m=e.metadata)||void 0===m?void 0:m.message};case o.TD.NOTEBOOK_SCHEDULING_ENABLED:var y,v;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(y=e.metadata)||void 0===y?void 0:y.title,description:null===(v=e.metadata)||void 0===v?void 0:v.message};case o.TD.NOTEBOOK_SCHEDULING_UPDATED:var b,E;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(b=e.metadata)||void 0===b?void 0:b.title,description:null===(E=e.metadata)||void 0===E?void 0:E.message};case o.TD.SCHEDULED_RUN_FAILED:var S;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(S=e.metadata)||void 0===S?void 0:S.message};case o.TD.SCHEDULED_RUN_SKIPPED:var C;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(C=e.metadata)||void 0===C?void 0:C.message};case o.TD.SCHEDULED_RUN_SUCCESS:var w;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(w=e.metadata)||void 0===w?void 0:w.message};case o.TD.PUBLISH_NOTEBOOK:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook published"};case o.TD.UNPUBLISH_NOTEBOOK:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook unpublished"};case o.TD.TOGGLE_PUBLIC_LISTING:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook listed/unlisted"};case o.TD.TOGGLE_PUBLISHED_ACCESS:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook published access changed"};default:(0,n.vE)(e.type)}};function E(e,t){return Date.now()-e<864e5*t}},30285:(e,t,r)=>{"use strict";r.d(t,{H5:()=>d,ep:()=>c,iX:()=>s,tL:()=>u,wI:()=>l});var o=r(26056),n=r(3766),i=r(37044),a=r(85675);const s=(e,t,r)=>{const n=(0,i.mr)(e,r);if(!t(n)){const e=new Error("The useAssertiveSelector assertion failed for "+t.toString());return(0,o.D)(e,"fatal"),n}return n},c=()=>(0,i.mr)((e=>e.project.focusedItem));function l(){const e=c(),t=e&&"id"in e?e.id:null;if(!t){const e=new Error("No focused item or item without an ID");return(0,o.D)(e,"warning"),""}return t}const u=()=>{const e=c();return(0,i.mr)((t=>Boolean((null==e?void 0:e.id)&&(0,a.hE)(e)&&"string"==typeof t.sharedbState.files[e.id])))},d=()=>{const e=c();return(0,i.mr)((t=>Boolean((null==e?void 0:e.id)&&(0,a.hE)(e)&&(0,n.nZ)(t.sharedbState.files[e.id]))))}},65068:(e,t,r)=>{"use strict";r.d(t,{q:()=>a,u:()=>i});var o=r(26129),n=r(3766);function i(e){return e===o.EJ.MANIPULATE_CELLS||e===o.EJ.EXECUTE_CELL||e===o.EJ.ADD_COMMENT||e===o.EJ.VIEW_COMMENTS||e===o.EJ.RESOLVE_COMMENT_THREAD||e===o.EJ.EDIT_INPUT_CELL_VALUE||e===o.EJ.VIEW_NOTEBOOK_VARIABLES||e===o.EJ.AUTOCOMPLETE||e===o.EJ.PUBLISH_NOTEBOOK||e===o.EJ.SCHEDULE_NOTEBOOK||e===o.EJ.REQUEST_VARIABLE_DETAILS}function a(e,t,r){return"file"!==(null==r?void 0:r.type)&&(0,n.C5)(e,t)}},51416:(e,t,r)=>{"use strict";r.d(t,{W:()=>o});const o={selectIsConnected:e=>e.connection.isConnected,selectHardwareStatus:e=>e.connection.hardwareStatus}},28491:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var o=r(71267),n=r(86341),i=r(85675),a=r(43035);const s=e=>e.filesystem.initNotebookId,c=e=>e.filesystem.entities,l={selectInitNotebookId:s,selectEntities:c,createFileCountSelector:()=>(0,n.P1)(c,(e=>Object.values(null!=e?e:{}).filter(o.zE).filter(i.v5).length)),createInitNotebookSelector:()=>(0,n.P1)(a.l.selectSharedbFiles,s,((e,t)=>{if(!t)return null;const r=e[t];return"string"!=typeof r&&r?r:null})),createFileSelector:e=>(0,n.P1)(c,(t=>Object.values(null!=t?t:{}).find((t=>t.relativePath===e))))}},25825:(e,t,r)=>{"use strict";r.d(t,{q:()=>p});var o=r(86341),n=r(39744),i=r(28491),a=r(25061),s=r(43035);const c=(e,t,r)=>{if(!t)return"missing";if("busy"===t.kernelStatus||"notReady"===t.kernelStatus)return"running";return e.some((e=>{const t=r[e];return!!t&&(0,n.j)(t)}))?"errored":"ok"},l=(e,t)=>{var r;return c(null!==(r=null==e?void 0:e.cellOrder)&&void 0!==r?r:[],e,t)},u=()=>(0,o.P1)(s.l.createFocusedNotebookSelector(),(e=>{var t;return null!==(t=null==e?void 0:e.kernelStatus)&&void 0!==t?t:"notReady"})),d=e=>e.connection.hardwareStatus,p={selectHardwareStatus:d,createBlockApiInitNotebookStatusSelector:e=>(0,o.P1)((()=>e),i.Q.createInitNotebookSelector(),a.U.selectOutputs,c),createSharedbInitNotebookStatusSelector:()=>(0,o.P1)(i.Q.createInitNotebookSelector(),a.U.selectOutputs,l),createKernelStatus:u,createRuntimeStatusSelector:()=>(0,o.P1)(u(),d,((e,t)=>"notReady"!==e&&"ready"===t?"ready":"stopping"===t||"submitted"===t||"scaling-up"===t||"ready"===t&&"notReady"===e?"preparing":"not-ready"))}},59467:(e,t,r)=>{"use strict";r.d(t,{r:()=>i});var o=r(86341);const n=e=>e.notebookLayout.cachedLayout,i={createInitialPlaceholderHeightSelector:e=>(0,o.P1)(n,(t=>{var r,o;return null!==(r=null===(o=t[e])||void 0===o?void 0:o.deepnote_cell_height)&&void 0!==r?r:0})),selectCachedLayout:n,selectCurrentLayout:e=>e.notebookLayout.currentLayout}},25061:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var o=r(86341),n=r(23074),i=r(17555);const a=e=>e.output,s={selectOutputs:a,createCellOutputSelector:(e,t)=>(0,o.P1)(a,(r=>t.cleared?i.F:(0,n.N4)(r,e)))}},5575:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var o=r(86341);const n=e=>e.project.scrollTarget,i={selectCurrentUserAccessType:e=>e.project.collaborationProperties.currentUserAccessType,selectWorkspaceId:e=>e.project.team_id,selectProjectId:e=>e.project.id,selectFocusedItem:e=>e.project.focusedItem,selectFocusedItemId:e=>{const t=e.project.focusedItem;return t&&"preview"!==t.type?t.id:null},selectFocusedNotebookPath:e=>{if(e.project.focusedItem&&"relativePath"in e.project.focusedItem)return e.project.focusedItem.relativePath},createScrollTargetForCellSelector:e=>(0,o.P1)(n,(t=>(null==t?void 0:t.cellId)===e?t:null))}},43035:(e,t,r)=>{"use strict";r.d(t,{l:()=>d});var o=r(3766),n=r(26129),i=r(86341),a=r(85675),s=r(5575);const c=e=>e.sharedbState.files,l=e=>e.sharedbState.collabDoc.cellOwnership,u=()=>(0,i.P1)(c,s.H.selectFocusedItem,((e,t)=>t&&(0,a.hE)(t)&&(0,o.nZ)(e[t.id])?e[t.id]:null)),d={selectSharedbFiles:c,createOwnerCellIdSelector:e=>(0,i.P1)(l,(t=>{var r,o;return null!==(r=null===(o=t[e])||void 0===o?void 0:o.owner_user_id)&&void 0!==r?r:null})),createFocusedNotebookSelector:u,createKernelStatusSelector:()=>(0,i.P1)(u(),(e=>{var t;return null!==(t=null==e?void 0:e.kernelStatus)&&void 0!==t?t:null})),createExecutionQueueSelector:()=>(0,i.P1)(u(),(e=>{var t;return null!==(t=null==e?void 0:e.executionQueue)&&void 0!==t?t:[]})),createExecutingCellIdSelector:()=>(0,i.P1)(u(),(e=>{var t,r;return null!==(t=null==e||null===(r=e.executionQueue[0])||void 0===r?void 0:r.cellId)&&void 0!==t?t:null})),createPersistedSessionSelector:()=>(0,i.P1)(d.createFocusedNotebookSelector(),(e=>{if(null!=e&&e.metadata.deepnote_persisted_session){if(new Date(e.metadata.deepnote_persisted_session.createdAt).getTime()>Date.now()-n.wn)return e.metadata.deepnote_persisted_session}return null})),createTextFileSelector:e=>(0,i.P1)(c,(t=>{const r=t[e];return"string"==typeof r?r:""}))}},39744:(e,t,r)=>{"use strict";r.d(t,{j:()=>a});var o=r(3766),n=r(79638);const i=["Syntax error:","[31mERROR","Killed |"];function a(e){return e.some((e=>(0,n.VZ)(e)||(0,n.ee)(e)&&e.text&&i.some((t=>(0,o.vu)(e.text,"").includes(t)))))}},85675:(e,t,r)=>{"use strict";r.d(t,{C_:()=>g,G5:()=>l,JF:()=>c,QP:()=>p,UY:()=>u,aq:()=>h,dv:()=>d,hE:()=>s,h_:()=>f,mt:()=>i,rN:()=>a,rs:()=>n,v5:()=>m});var o=r(19133);const n=e=>!!e&&"terminal"===e.type,i=e=>!!e&&"notebook"===e.type,a=e=>!!e&&"file"===e.type,s=e=>i(e)||a(e),c=e=>!!e&&"preview"===e.type,l=e=>null==e?void 0:e.toLowerCase().endsWith(".ipynb"),u=e=>e.toLowerCase().endsWith(".zip")||e.toLowerCase().endsWith(".tar")||e.toLowerCase().endsWith(".tar.gz"),d=e=>null==e?void 0:e.toLowerCase().endsWith(".csv"),p=e=>e.toLowerCase().endsWith(".py"),h=e=>e.toLowerCase().endsWith(".txt"),f=e=>e.toLowerCase().endsWith("dockerfile"),g=e=>e.toLowerCase().endsWith(".pdf"),m=e=>!e.relativePath.startsWith("/.deepnote")&&e.relativePath!==o.Fd},48271:(e,t,r)=>{"use strict";r.d(t,{F5:()=>h,K:()=>p,Of:()=>f,UO:()=>c,Zg:()=>g,_U:()=>u,hU:()=>s,mD:()=>l,wT:()=>m});var o=r(19133),n=r(56370),i=r(71267),a=r(66648);function s(e){const t=["/"];let r="";for(const o of a.dirname(a.normalize(e)).split("/"))o&&(r=`${r}/${o}`,t.push(r));return t}function c(e){return a.basename(e)}function l(e){return e.substr(e.lastIndexOf(".")+1)}function u(e,t){if(e===t)return!1;const r=e.split("/");return!t.split("/").every(((e,t)=>r[t]===e))}function d(e){const t=e.relativePath.split("/");return t[t.length-1]}function p(e,t,r){const o=d(e);if("file"===t.type){const e=function(e,t){const r=e.relativePath.split("/");if(1===r.length)return null;const o=t[r.slice(0,r.length-1).join("/")];return o||null}(t,r);if(null!=e&&e.children)return!e.children.includes(o);return d(t)!==o}return!t.children||!t.children.includes(o)}const h=e=>{const t=e.relativePath;return"/"!==t&&t!==o.Fd&&!t.startsWith("/.deepnote")};function f(e){try{const o=new URL(e);if(o.host===window.location.host&&o.protocol===window.location.protocol){var t,r;const e=null!==(t=null!==(r=o.pathname.match(/^\/workspace\/([^/]+)\/project\/([^/]+)/))&&void 0!==r?r:o.pathname.match(/^\/project\/([^/]+)/))&&void 0!==t?t:null,i=null==e?void 0:e[e.length-1],a=i?(0,n.ae)(i):null;if(!e||!a)return null;const s=e[0].length+1,c=decodeURIComponent(o.pathname.substr(s));return{filePath:c.startsWith("/")?c:`/${c}`,cellId:o.hash.substr(1)||void 0,projectNameSlug:a.name,projectId:a.id}}return null}catch(e){return null}}const g=(e,t)=>{const{relativePath:r}=e;return a.basename(r)===t.relativePath||t.relativePath===r||a.dirname(r)===t.relativePath?r:(0,i.IQ)(e)&&"/"===t.relativePath?`/${a.basename(e.relativePath)}`:(0,i.zE)(t)&&"/"===a.dirname(t.relativePath)?`/${a.basename(r)}`:(0,i.zE)(t)&&(0,i.zE)(t)?`${a.dirname(t.relativePath)}/${a.basename(r)}`:(0,i.IQ)(e)?`${t.relativePath}/${a.basename(r)}`:"/"===t.relativePath?`/${a.basename(r)}`:`${t.relativePath}/${a.basename(r)}`},m=e=>{const t={};return e.forEach((e=>{t[e.relativePath]=e})),t}},50133:(e,t,r)=>{"use strict";function o(e){return e.location?(t=e.location)&&"block_id"in t?t.block_id:null:null;var t}r.d(t,{$:()=>o})},15455:(e,t,r)=>{"use strict";r.d(t,{g:()=>i,j:()=>a});var o=r(79683),n=r(77267);const i=({project:e,filePath:t,urlHash:r,notebookInDB:i})=>(0,o.gC)({serverUrl:n.KB,project:e,filePath:t,urlHash:r,notebookInDB:i}),a=({project:e,author:t})=>(0,o.jD)({serverUrl:n.KB,project:e,author:t})},94366:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var o=r(26056),n=r(66753);function i(e,t,r=3){let i=0;const a={current:null};return[a,async()=>{for(;i<r&&!a.current;){i++;try{a.current=await e()}catch(e){i===r&&((0,o.D)(e,"warning",{message:"We failed loading a library 3 times.",userFacingMessage:t}),t&&(n.Z.closeAll(),n.Z.error({message:t})))}}return a.current}]}},47122:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var o=r(78563),n=r(91987),i=r(94366),a=r(39981);const s={default:(...e)=>(0,a.BX)("div",{children:["Component failed to load. Please refresh the browser or"," ",(0,a.tZ)(o.rU,{isExternal:!0,href:"mailto:help@deepnote.com",children:"contact our support"}),"."]})};function c(e,t=3){const[,r]=(0,i.Z)(e,null,t),o=async()=>{const e=await r();return null!=e?e:s};return(0,n.lazy)(o)}},9645:(e,t,r)=>{"use strict";r.d(t,{PU:()=>s,vP:()=>u});var o=r(64119),n=r(64705),i=r(44539),a=r(91987);const s=o.Ps`
  query GetPayAsYouGoMachinesData($id: String!) {
    team(id: $id) {
      ... on Team {
        id
        payAsYouGoMachinesAllowed
      }
    }
  }
`,c=o.Ps`
  mutation SetPayAsYouGoMachinesAllowed($id: String!, $allowed: Boolean!) {
    setPayAsYouGoMachinesAllowed(team_id: $id, allowed: $allowed) {
      ... on Team {
        id
        payAsYouGoMachinesAllowed
      }
    }
  }
`,l=!0;function u(e){var t;const{data:r,loading:o,error:u}=(0,n.a)(s,{variables:{id:e},fetchPolicy:"cache-first"}),[d,{error:p}]=(0,i.D)(c),h=(0,a.useCallback)((async t=>{await d({variables:{id:e,allowed:t},optimisticResponse:{setPayAsYouGoMachinesAllowed:{id:e,payAsYouGoMachinesAllowed:t}}})}),[d,e]);return{data:{payAsYouGoMachinesAllowed:"Team"===(null==r||null===(t=r.team)||void 0===t?void 0:t.__typename)?r.team.payAsYouGoMachinesAllowed:l},mutations:{setPayAsYouGoMachinesAllowed:h},loading:o,error:u,setPayAsYouGoMachinesAllowedError:p}}},66922:(e,t,r)=>{"use strict";r.d(t,{IY:()=>c,QF:()=>g,x3:()=>h});var o=r(64119),n=r(64705),i=r(44539),a=r(66648),s=r(91987);const c="/",l=o.Ps`
  mutation CreateNotebookInDB($projectId: String!) {
    createNotebookInDB(id: $projectId) {
      notebook {
        id
        name
      }
    }
  }
`,u=o.Ps`
  mutation DeleteNotebookInDB($projectId: String!, $id: String!) {
    deleteNotebookInDB(projectId: $projectId, id: $id) {
      id
    }
  }
`,d=o.Ps`
  mutation RenameNotebookInDB($projectId: String!, $id: String!, $name: String!) {
    renameNotebookInDB(projectId: $projectId, id: $id, name: $name) {
      notebook {
        id
        name
      }
    }
  }
`,p=o.Ps`
  mutation DuplicateNotebookInDb($projectId: String!, $id: String!) {
    duplicateNotebookInDb(projectId: $projectId, id: $id) {
      notebook {
        id
        name
      }
    }
  }
`,h=o.Ps`
  query GetNotebooksInDBForProjectList($id: String!) {
    projectById(id: $id) {
      __typename
      ... on Project {
        id
        notebooksInDB {
          id
          name
          working_directory
          updated_at
        }
      }
    }
  }
`,f=o.Ps`
  mutation SetWorkingDirectoryForNotebookInDB($projectId: String!, $id: String!, $workingDirectory: String!) {
    setWorkingDirectoryForNotebookInDB(projectId: $projectId, id: $id, workingDirectory: $workingDirectory) {
      notebook {
        id
        name
        working_directory
        updated_at
      }
    }
  }
`,g=e=>{var t,r;const{data:o,loading:g,error:m,refetch:y}=(0,n.a)(h,{variables:{id:e.projectId},fetchPolicy:"cache-first"}),v=(0,s.useCallback)(((t,{data:r})=>{if(null!=r&&r.createNotebookInDB.notebook)return t.modify({id:`Project:${e.projectId}`,fields:{notebooksInDB:(e,{toReference:t})=>[...null!=e?e:[],t(r.createNotebookInDB.notebook,!0)]}})}),[e.projectId]),[b]=(0,i.D)(l,{variables:{projectId:e.projectId},update:v}),E=(0,s.useCallback)(((e,{data:t})=>{if(null!=t&&t.renameNotebookInDB.notebook)return e.modify({id:e.identify(null==t?void 0:t.renameNotebookInDB.notebook),fields:{name:()=>t.renameNotebookInDB.notebook.name}})}),[]),[S]=(0,i.D)(d),C=(0,s.useCallback)(((t,{data:r})=>{if(null!=r&&r.deleteNotebookInDB)return t.modify({id:`Project:${e.projectId}`,fields:{notebooksInDB:(e,{readField:t})=>e.filter((e=>{var o;return t("id",e)!==(null==r||null===(o=r.deleteNotebookInDB)||void 0===o?void 0:o.id)&&e}))}})}),[e.projectId]),[w]=(0,i.D)(u,{update:C}),T=(0,s.useCallback)(((t,{data:r})=>{if(null!=r&&r.duplicateNotebookInDb.notebook)return t.modify({id:`Project:${e.projectId}`,fields:{notebooksInDB:(e,{toReference:t})=>[...null!=e?e:[],t(r.duplicateNotebookInDb.notebook,!0)]}})}),[e.projectId]),[I]=(0,i.D)(p,{update:T}),_=(0,s.useCallback)((async(t,r)=>{await S({variables:{id:t,name:r,projectId:e.projectId},optimisticResponse:{renameNotebookInDB:{__typename:"RenameNotebookInDBResponse",notebook:{id:t,name:r}}}})}),[e.projectId,S]),A=(0,s.useCallback)((async t=>{await w({variables:{id:t,projectId:e.projectId}})}),[e.projectId,w]),k=(0,s.useCallback)((async()=>{var e;const{data:t}=await b();return null!==(e=null==t?void 0:t.createNotebookInDB)&&void 0!==e?e:null}),[b]),O=(0,s.useCallback)((async t=>{var r;const{data:o}=await I({variables:{id:t,projectId:e.projectId}});return null!==(r=null==o?void 0:o.duplicateNotebookInDb)&&void 0!==r?r:null}),[I,e.projectId]),D=(0,s.useCallback)(((e,{data:t})=>{var r;const o=null==t||null===(r=t.setWorkingDirectoryForNotebookInDB)||void 0===r?void 0:r.notebook;if(o)return e.modify({id:e.identify(o),fields:{working_directory:()=>o.working_directory}})}),[]),[P]=(0,i.D)(f,{update:D}),j=(0,s.useCallback)((async(t,r)=>{let o=a.normalize(r);o.startsWith(c)||(o=`/${o}`),await P({variables:{id:t,workingDirectory:o,projectId:e.projectId}})}),[e.projectId,P]);return{data:{notebooks:"Project"===(null==o||null===(t=o.projectById)||void 0===t?void 0:t.__typename)&&null!==(r=o.projectById.notebooksInDB)&&void 0!==r?r:[]},refetch:y,loading:g,error:m,mutations:{createNotebookInDb:k,deleteNotebookInDb:A,renameNotebookInDb:_,duplicateNotebookInDb:O,setWorkingDirectoryForNotebookInDB:j},mutationCallbacks:{createNotebookInDbMutationCallback:v,renameNotebookInDbMutationCallback:E,deleteNotebookInDbMutationCallback:C,duplicateNotebookInDbMutationCallback:T,setWorkingDirectoryForNotebookInDBCallback:D}}}},37141:(e,t,r)=>{"use strict";(0,r(77267).sk)()&&void 0!==r.g&&(r.g.window=void 0)},19873:(e,t,r)=>{"use strict";r.d(t,{B1:()=>u,nm:()=>n,QW:()=>y});var o=r(39981);const n=({standardPlanDisplayName:e,proPlanDisplayName:t,enterprisePlanDisplayName:r}={standardPlanDisplayName:"Free",proPlanDisplayName:"Team",enterprisePlanDisplayName:"Enterprise"})=>[{question:"Is there a free version of Deepnote?",answer:"Absolutely! Individuals and small teams can use Deepnote for free — no credit card or payment details needed. Just sign up to get started."},{question:`How is the ${e} Plan different from the ${t} and ${r} Plans?`,answer:(0,o.BX)(o.HY,{children:["The ",e," plan is designed for hobbyists and individuals. It allows up to 3 editors and 5 projects in the workspace.",(0,o.tZ)("br",{}),(0,o.tZ)("br",{}),"Our ",t," plan is designed for, well, teams. The ",t," plan allows for an unlimited number of editors to create an unlimited number of projects. The ",t," plan also includes more advanced features such as an extended 30-day version history and static IP addresses.",(0,o.tZ)("br",{}),(0,o.tZ)("br",{}),"For larger organizations who need a little (or a lot) more, we have the ",r," plan. The"," ",r," plan comes with unlimited version history, Okta SSO, dedicated support resources, and the option for customized machines to fit your needs."]})},{question:"Do you offer any education or non-profit discounts?",answer:(0,o.BX)(o.HY,{children:["Yes! Students, teachers, and other learning courses in academia get free access to our Education plan. The Education plan offers all the benefits of the ",t," plan, except access to stronger machines.",(0,o.tZ)("br",{}),(0,o.tZ)("br",{}),"To get started with the Education plan, simply sign up for a Deepnote account with an email address from your school or organization."]})},{question:"What happens if I run out of computation time?",answer:(0,o.BX)(o.HY,{children:["In the rare case that you run out of computation time, you have a few options:",(0,o.tZ)("br",{}),(0,o.tZ)("br",{}),"1. Wait until the month rolls over and the hours are replenished.",(0,o.tZ)("br",{}),"2. Invite more editors or admins to your workspace. Every additional editor will add 750 hours to the workspace’s total computation time. ",(0,o.tZ)("br",{}),"3. You can also pay for more machine hours at an hourly rate (see our Pricing table).",(0,o.tZ)("br",{}),(0,o.tZ)("br",{}),"Note: Even if you run out of hours, you can still access and edit all your notebooks."]})}];function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c={"data-warehouses-and-lakes-in-jupyter-compatible-data-notebooks":"Data warehouses & lakes","databases-in-jupyter-compatible-data-notebooks":"Databases","local-files-and-file-hosting-in-jupyter-compatible-data-notebooks":"Files","collaboration-and-productivity-in-jupyter-compatible-data-notebooks":"Collaboration & productivity","machine-learning-ops-in-jupyter-compatible-data-notebooks":"Machine learning","data-transformation-and-processing-in-jupyter-compatible-data-notebooks":"Data processing","docker-container-registries-in-jupyter-compatible-data-notebooks":"Docker container registries","version-control-in-jupyter-compatible-data-notebooks":"Version control"},l={"aws-data-stack-in-jupyter-compatible-notebooks":"AWS stack","google-cloud-platform-data-stack-in-jupyter-compatible-notebooks":"Google Cloud stack","azure-data-stack-in-jupyter-compatible-notebooks":"Azure stack"},u=(a(a(a({},c),l),{},{all:"All"}),a(a(a({},c),l),{},{all:"All","data-warehouses-and-lakes-in-jupyter-compatible-data-notebooks":"Data warehouse & lake","databases-in-jupyter-compatible-data-notebooks":"Database","local-files-and-file-hosting-in-jupyter-compatible-data-notebooks":"File","docker-container-registries-in-jupyter-compatible-data-notebooks":"Docker container registry"}),"https://portal.productboard.com/deepnote/1-deepnote-product-portal/tabs/1-under-consideration/submit-idea");var d=r(38483),p=r(69461),h=r(45409);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const y={mongodb:g(g({},h.kM.mongodb),{},{icon:d.bep,iconBgColor:"#F5FCF7",landingDesciption:"Connect to a MongoDB instance and query data with pymongo.",landingLink:"/integrations/mongodb",usageType:"Built-in",category:"Database"}),pgsql:g(g({},h.kM.pgsql),{},{icon:d._CE,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Postgres instance and use SQL directly from a notebook interface.",landingLink:"/integrations/postgresql",usageType:"Built-in",category:"Database"}),clickhouse:g(g({},h.kM.clickhouse),{},{icon:d.kc_,iconBgColor:"#FFFBEC",landingDesciption:"Connect to a ClickHouse instance and use SQL directly from a notebook interface.",isNew:!0,usageType:"Built-in",category:"Database"}),redshift:g(g({},h.kM.redshift),{},{icon:d.UQY,iconBgColor:"rgba(67, 135, 250, 0.1)",landingDesciption:"Connect to a Redshift warehouse and query the data using Deepnote SQL blocks.",landingLink:p._.docsPage("redshift"),usageType:"Built-in",category:"Data warehouse"}),athena:g(g({},h.kM.athena),{},{icon:d.UjL,iconBgColor:"#fcf1d0",landingDesciption:"Connect to Athena instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Data warehouse"}),github:g(g({},h.kM.github),{},{icon:d.ETn,iconBgColor:"#9099A31A",iconColor:"#393A3F",landingDesciption:"Attach a repository to your project to read or commit to any branch.",landingLink:"/integrations/github",usageType:"Built-in",category:"Other"}),gitlab:g(g({},h.kM.gitlab),{},{icon:d.Ts0,iconBgColor:"rgba(0, 0, 0, 0.05)"}),env:g(g({},h.kM.env),{},{icon:d.Qmz,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Others"}),"google-drive":g(g({},h.kM["google-drive"]),{},{icon:d.mfL,iconBgColor:"#FDF7E5",landingDesciption:"Mount Google Drive directories in your projects to read and edit its files.",landingLink:"/integrations/drive",usageType:"Built-in",category:"Files"}),local:g(g({},h.kM.local),{},{icon:d.rG2,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Files"}),s3:g(g({},h.kM.s3),{},{icon:d.Lrn,iconBgColor:"#F1E5E2",landingDesciption:"Attach a bucket to your project and read, edit or upload files to the bucket.",landingLink:"/integrations/s3",usageType:"Built-in",category:"Files"}),mysql:g(g({},h.kM.mysql),{},{icon:d.Em1,iconBgColor:"#E7F5FF",landingDesciption:"Connect to a MySQL instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Database"}),mariadb:g(g({},h.kM.mariadb),{},{icon:d.kG7,iconBgColor:"#E7F5FF",landingDesciption:"Connect to a MariaDB instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Database"}),mindsdb:g(g({},h.kM.mindsdb),{},{icon:d.PZJ,iconBgColor:"#00B06D20",usageType:"Built-in",category:"Files"}),"big-query":g(g({},h.kM["big-query"]),{},{icon:d.pn3,iconBgColor:"rgba(67, 135, 250, 0.1)",landingDesciption:"Connect to your BigQuery warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/bigquery",usageType:"Built-in",category:"Data warehouse"}),gcs:g(g({},h.kM.gcs),{},{icon:d.C0D,iconBgColor:"#E5F1FD",landingDesciption:"Mount both public and private buckets directly to the project filesystem.",usageType:"Built-in",category:"Data processing"}),snowflake:g(g({},h.kM.snowflake),{},{icon:d.jeN,iconBgColor:"#E6F9FE",landingDesciption:"Connect to a Snowflake warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/snowflake",usageType:"Built-in",category:"Data warehouse"}),dbt:g(g({},h.kM.dbt),{},{icon:d.TvS,iconBgColor:"#E6F9FE",landingDesciption:"Connect to a Snowflake warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/snowflake",usageType:"Built-in",category:"Data warehouse"}),dropbox:g(g({},h.kM.dropbox),{},{icon:d.Xwr,iconBgColor:"#EBF2FE",landingDesciption:"Read and write to your Dropbox files directly from a notebook."}),arize:g(g({},h.kM.arize),{},{icon:d.Lj3,iconBgColor:"rgba(238, 51, 138, 0.1)"}),slack:g(g({},h.kM.slack),{},{icon:d.mUE,iconBgColor:"rgba(236, 178, 46, 0.1)"}),wandb:g(g({},h.kM.wandb),{},{icon:d.DZE,iconBgColor:"#000"}),ecr:g(g({},h.kM.ecr),{},{icon:d._qN,iconBgColor:"#FC6D261A",landingDesciption:"Authenticate and use your private Docker images from AWS ECR as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),gcr:g(g({},h.kM.gcr),{},{icon:d.Kyf,iconBgColor:"#FDF7E5",landingDesciption:"Authenticate and use your private Docker images from GCR as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),dockerhub:g(g({},h.kM.dockerhub),{},{icon:d.y3m,iconBgColor:"#E7F5FF",landingDesciption:"Authenticate and use your private Docker images from DockerHub as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),"pandas-dataframe":g(g({},h.kM["pandas-dataframe"]),{},{icon:d.VHe,iconBgColor:"rgba(0, 0, 0, 0.05)"}),"ssh-key":g(g({},h.kM["ssh-key"]),{},{icon:d.BKe,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Other"}),python:g(g({},h.kM.python),{},{icon:d.gxY,iconBgColor:"#0277BD"}),"sql-server":g(g({},h.kM["sql-server"]),{},{icon:d.HwW,iconBgColor:"rgba(0, 0, 0, 0.05)",landingDesciption:"Connect to a Azure SQL or Microsoft SQL Server instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Data warehouse"}),julia:g(g({},h.kM.dbt),{},{icon:d.e7x,iconBgColor:"#9259a3"}),rlang:g(g({},h.kM.dbt),{},{icon:d.JWN,iconBgColor:"#276DC3"}),javascript:g(g({},h.kM.dbt),{},{icon:d.r3e,iconBgColor:"#f7df1e"}),pytorch:g(g({},h.kM.dbt),{},{icon:d.BjK,iconBgColor:"#EE4C2C"}),tensorflow:g(g({},h.kM.dbt),{},{icon:d.RPH,iconBgColor:"#FFA800"}),plotly:g(g({},h.kM.dbt),{},{icon:d.P9k,iconBgColor:"#25fefd"}),pandas:g(g({},h.kM.dbt),{},{icon:d.FhJ,iconBgColor:"#130754"}),spark:g(g({},h.kM.dbt),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),notion:g(g({},h.kM.notion),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),airtable:g(g({},h.kM.airtable),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),telegram:g(g({},h.kM.telegram),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),supabase:g(g({},h.kM.supabase),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),influxdb:g(g({},h.kM.influxdb),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),onedrive:g(g({},h.kM.onedrive),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"azure-blob-storage":g(g({},h.kM["azure-blob-storage"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"deepnote-api":g(g({},h.kM["deepnote-api"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"snowflake-snowpark":g(g({},h.kM["snowflake-snowpark"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"great-expectations":g(g({},h.kM["great-expectations"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"weights-and-biases":g(g({},h.kM["weights-and-biases"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),comet:g(g({},h.kM.comet),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),neptune_ai:g(g({},h.kM.neptune_ai),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),trino:g(g({},h.kM.trino),{},{icon:d.h90,iconBgColor:"#e25a1c"}),dremio:g(g({},h.kM.dremio),{},{icon:d.$UR,iconBgColor:"#e25a1c"}),"google-sheets":g(g({},h.kM["google-sheets"]),{},{icon:d.K55,iconBgColor:"#e25a1c"}),box:g(g({},h.kM.box),{},{icon:d.O5d,iconBgColor:"#e25a1c"}),ssh_tunnel:g(g({},h.kM.ssh_tunnel),{},{icon:d.BKe,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Other"}),github_package:g(g({},h.kM.github_package),{},{icon:d.ETn,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Files"})}},25941:(e,t,r)=>{"use strict";r.d(t,{n:()=>i});var o=r(88451),n=r.n(o);function i(e){n()(e)}},8587:(e,t,r)=>{"use strict";r.d(t,{P:()=>i});var o=r(38318),n=r(42218);const i=e=>{const t=(0,o.parse)(e,{includeComments:!1}).map((e=>e.raw)).join("");return(0,n.sha224)(t)}},98744:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});let o=function(e){return e.PAY_AS_YOU_GO_MACHINES="pay_as_you_go_machines",e.BLOCK_API="block_api",e.GITHUB_IN_FOLDERS="github_in_folders",e.LOCAL_DOCKERFILE="local_dockerfile",e.CUSTOM_AVATARS_DISABLED="custom_avatars_disabled",e.SQL_CACHING="sql_caching",e.GITHUB_PACKAGE="github_package",e.HCAPTCHA="hcaptcha",e.CODEIUM_CODE_COMPLETIONS="codeium_code_completions",e.GIT_EXPORT="git_export",e.DAG="dag",e.TESTING_FLAG_FALSE="testingFlagFalse",e.TESTING_FLAG="testingFlag",e.PRODUCT_TOUR="productTour",e.VERSIONING_IN_S3="versioningInS3",e.FULL_TEXT_SEARCH="full_text_search",e.ANNUAL_PLAN="annualPlan",e}({})},19133:(e,t,r)=>{"use strict";r.d(t,{Fd:()=>o,oH:()=>n});const o="/init.ipynb",n="/Dockerfile"},71267:(e,t,r)=>{"use strict";function o(e){return!!e&&"directory"===e.type}function n(e){return!!e&&"file"===e.type}r.d(t,{IQ:()=>o,zE:()=>n})},95781:(e,t,r)=>{"use strict";r.d(t,{d:()=>o,R:()=>n});const o=["snowflake","s3","sql-server","big-query","mysql","athena","pgsql","redshift","google-drive","mongodb"],n={GET_INTRODUCED:"GET_INTRODUCED",GET_INTRODUCED_SUBSTEP_WELCOME_NOTEBOOK:"GET_INTRODUCED_SUBSTEP_WELCOME_NOTEBOOK",GET_INTRODUCED_SUBSTEP_PRODUCT_DEMO:"GET_INTRODUCED_SUBSTEP_PRODUCT_DEMO",DATA_CONNECTION_SUBSTEP_CSV_UPLOADED:"DATA_CONNECTION_SUBSTEP_CSV_UPLOADED",DATA_CONNECTION:"DATA_CONNECTION",CREATE_FIRST_PROJECT:"CREATE_FIRST_PROJECT",INVITE_COLLABORATORS:"INVITE_COLLABORATORS"}},32037:(e,t,r)=>{"use strict";r.d(t,{js:()=>o.js,yC:()=>o.yC,vQ:()=>n,aR:()=>o.aR});r(87196),r(3766),r(73909);var o=r(54195);function n(e){const t="/"===e[0]?e.substring(1):e;return t.substring(0,t.lastIndexOf(".ipynb"))||t}},54195:(e,t,r)=>{"use strict";r.d(t,{AX:()=>i,aR:()=>n,js:()=>s,yC:()=>a});var o=r(52424);function n(e){return{id:e.substring(e.length-o.wZ,e.length),name:e.substring(0,e.length-o.wZ-1)}}function i(e,t){return`${encodeURIComponent(t)}-${e}`}function a(e,t){return!e.find((e=>e.name===t))}function s(e,t,r={}){var o;const n=null!==(o=null==r?void 0:r.separator)&&void 0!==o?o:"-";let i=void 0===r.startingNumber?1:r.startingNumber,s=t+(r.startWithNumber?n+i:""),c=a(e,s);for(;!c;)i+=1,s=t+n+i,c=a(e,s);return s}},67665:(e,t,r)=>{"use strict";r.d(t,{MT:()=>o.MT,Pd:()=>o.Pd,Rq:()=>o.Rq});var o=r(73909)},73909:(e,t,r)=>{"use strict";r.d(t,{MT:()=>c,Pd:()=>i,Rq:()=>a});var o=r(79638),n=r(36047);function i(e){return o.Li(e)||o.Xg(e)}function a(e){return i(e)&&Boolean(e.data[n.Sn])}const s=[n.PW];function c(e){if(!i(e))return!0;return!Object.keys(e.data).every((e=>s.includes(e)))}},79683:(e,t,r)=>{"use strict";r.d(t,{gC:()=>s,jD:()=>a,o8:()=>u,Wn:()=>d});var o=r(80542),n=r(54195),i=r(56370);function a({serverUrl:e,project:t,author:r}){const o=(0,i.qi)(t.id,t.name),n=function(e){return e?`@${e.slug}`:"publish"}(r),a=`/${n}/${o}`;return{publishedProjectPath:a,publishedProjectUrl:`${e}${a}`}}function s({serverUrl:e,project:t,workspace:r,filePath:a,urlHash:s,notebookInDB:c}){const l=function(e){var t,r;if(e)return`/workspace/${(0,o.B)(e.id,e.name)}/project`;const n=null!==(t=null===(r=("undefined"!=typeof window?window.location.pathname:"/").match(/^\/workspace\/([^/]+)/))||void 0===r?void 0:r[0])&&void 0!==t?t:null;return`${null!=n?n:""}/project`}(r),u=(0,i.qi)(t.id,t.name),d=`${l}/${u}`,p=`${e}${d}`,h=s?`#${s}`:"";if(c){const e=`/notebook/${(0,n.AX)(c.id,c.name)}${h}`;return{projectSlug:u,projectUrl:d,fullProjectUrl:p,relativeUrlWithFile:d+e,fullUrlWithFile:p+e}}const f=a?`/${encodeURIComponent(a)}${h}`:`${h}`;return{projectSlug:u,projectUrl:d,fullProjectUrl:p,relativeUrlWithFile:d+f,fullUrlWithFile:p+f}}var c=r(61669),l=r.n(c);const u=e=>{if(!e)return null;let t;if(e.startsWith("https://raw.githubusercontent.com/")){const r=/^https:\/\/raw\.githubusercontent\.com\/([^/]+)\/([^/]+)(?:\/([^/]+)\/(.+)?)?/.exec(e);if(!r)return null;t={owner:r[1],repository:r[2],ref:r[3]?r[3]:"master",filePath:r[4]?r[4]:"/"}}const r=l()(e);if(r&&"github.com"===r.source&&(t={owner:r.owner,repository:r.name,ref:r.ref,filePath:r.filepath||"/"}),!t)return null;return/^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,60}$/i.test(t.owner)&&/^[A-Za-z0-9_.-]{0,100}$/.test(t.repository)?t:null};function d(e){if(!e)return null;const{full_name:t}=l()(e),r=t.split("/"),o=r[0],n=r.slice(1),i=/^[A-Za-z0-9_.-]{0,100}$/;if(!/^[a-z_\d](?:[a-z_\d]|-(?=[a-z_\d])){0,60}$/i.test(o))return null;for(const e of n)if(!i.test(e))return null;return{owner:o,repository:n.join("/")}}},52424:(e,t,r)=>{"use strict";r.d(t,{EL:()=>n,wZ:()=>i});var o=r(33161);const n=()=>(0,o.Z)().replace(/-/g,""),i=32},15999:(e,t,r)=>{var o={"./en-au":13417,"./en-au.js":13417,"./en-ca":38075,"./en-ca.js":38075,"./en-gb":62005,"./en-gb.js":62005,"./en-ie":31543,"./en-ie.js":31543,"./en-il":38594,"./en-il.js":38594,"./en-in":6240,"./en-in.js":6240,"./en-nz":76588,"./en-nz.js":76588,"./en-sg":51015,"./en-sg.js":51015};function n(e){var t=i(e);return r(t)}function i(e){if(!r.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=i,e.exports=n,n.id=15999},31469:()=>{}}]);
//# sourceMappingURL=8505.bundle.1ecfefe3.js.map